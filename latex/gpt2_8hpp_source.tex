\doxysection{gpt2.\+hpp}
\hypertarget{gpt2_8hpp_source}{}\label{gpt2_8hpp_source}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ LLM\_CPP\_\_GPT2\_HPP\_}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ LLM\_CPP\_\_GPT2\_HPP\_}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{comment}{//\#include\ "{}absl/strings/string\_view.h"{}\ //"{}absl/strings/string\_view.h"{}\ This\ was\ the\ orginal\ way\ it\ was\ setup\ but\ I\ just\ copied\ the\ folder.\ Would\ like\ to\ find\ the\ file\ needed\ alone}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}nano.hpp"{}}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\#include\ "{}llmc/utils.h"{}}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{keyword}{namespace\ }gpt2\ \{}
\DoxyCodeLine{00009\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structgpt2_1_1GPT2Config}{GPT2Config}}\ \{}
\DoxyCodeLine{00010\ \ \ \textcolor{keywordtype}{int}\ max\_seq\_len;\ \ \ \ \ \ \ \ \textcolor{comment}{//\ max\ sequence\ length,\ e.g.\ 1024}}
\DoxyCodeLine{00011\ \ \ \textcolor{keywordtype}{int}\ vocab\_size;\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ vocab\ size,\ e.g.\ 50257}}
\DoxyCodeLine{00012\ \ \ \textcolor{keywordtype}{int}\ padded\_vocab\_size;\ \ \textcolor{comment}{//\ padded\ to\ e.g.\ \%128==0,\ 50304}}
\DoxyCodeLine{00013\ \ \ \textcolor{keywordtype}{int}\ num\_layers;\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ number\ of\ layers,\ e.g.\ 12}}
\DoxyCodeLine{00014\ \ \ \textcolor{keywordtype}{int}\ num\_heads;\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ number\ of\ heads\ in\ attention,\ e.g.\ 12}}
\DoxyCodeLine{00015\ \ \ \textcolor{keywordtype}{int}\ channels;\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ number\ of\ channels,\ e.g.\ 768}}
\DoxyCodeLine{00016\ \};}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structgpt2_1_1GPT2}{GPT2}}\ \{}
\DoxyCodeLine{00019\ \ \ \textcolor{keyword}{using\ }Type\ =\ floatX;}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \ \ \textcolor{keywordtype}{void}\ BuildFromCheckpoint(absl::string\_view\ checkpoint\_path)\ \{}
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{comment}{//\ read\ in\ model\ from\ a\ checkpoint\ file}}
\DoxyCodeLine{00023\ \ \ \ \ FILE*\ model\_file\ =\ fopenCheck(checkpoint\_path.data(),\ \textcolor{stringliteral}{"{}rb"{}});}
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{keywordflow}{if}\ (model\_file\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00025\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error\ opening\ model\ file\(\backslash\)n"{}});}
\DoxyCodeLine{00026\ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00027\ \ \ \ \ \}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{keywordtype}{int}\ model\_header[256];}
\DoxyCodeLine{00030\ \ \ \ \ freadCheck(model\_header,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),\ 256,\ model\_file);}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keywordflow}{if}\ (model\_header[0]\ !=\ 20240326)\ \{}
\DoxyCodeLine{00032\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Bad\ magic\ model\ file\(\backslash\)n"{}});}
\DoxyCodeLine{00033\ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00034\ \ \ \ \ \}}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keywordflow}{if}\ (model\_header[1]\ !=\ 3)\ \{}
\DoxyCodeLine{00036\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Bad\ version\ in\ model\ file\(\backslash\)n"{}});}
\DoxyCodeLine{00037\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}-\/-\/-\/>\ HINT:\ try\ to\ re-\/run\ \`{}python\ train\_gpt2.py`\(\backslash\)n"{}});}
\DoxyCodeLine{00038\ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00039\ \ \ \ \ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{comment}{//\ read\ in\ hyperparameters}}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordtype}{int}\ maxT,\ V,\ Vp,\ L,\ NH,\ C;}
\DoxyCodeLine{00043\ \ \ \ \ config.max\_seq\_len\ =\ maxT\ =\ model\_header[2];}
\DoxyCodeLine{00044\ \ \ \ \ config.vocab\_size\ =\ V\ =\ model\_header[3];}
\DoxyCodeLine{00045\ \ \ \ \ config.num\_layers\ =\ L\ =\ model\_header[4];}
\DoxyCodeLine{00046\ \ \ \ \ config.num\_heads\ =\ NH\ =\ model\_header[5];}
\DoxyCodeLine{00047\ \ \ \ \ config.channels\ =\ C\ =\ model\_header[6];}
\DoxyCodeLine{00048\ \ \ \ \ config.padded\_vocab\_size\ =\ Vp\ =\ model\_header[7];}
\DoxyCodeLine{00049\ \ \ \ \ printf(\textcolor{stringliteral}{"{}[GPT-\/2]\(\backslash\)n"{}});}
\DoxyCodeLine{00050\ \ \ \ \ printf(\textcolor{stringliteral}{"{}max\_seq\_len:\ \%zu\(\backslash\)n"{}},\ maxT);}
\DoxyCodeLine{00051\ \ \ \ \ printf(\textcolor{stringliteral}{"{}vocab\_size:\ \%zu\(\backslash\)n"{}},\ V);}
\DoxyCodeLine{00052\ \ \ \ \ printf(\textcolor{stringliteral}{"{}padded\_vocab\_size:\ \%zu\(\backslash\)n"{}},\ Vp);}
\DoxyCodeLine{00053\ \ \ \ \ printf(\textcolor{stringliteral}{"{}num\_layers:\ \%zu\(\backslash\)n"{}},\ L);}
\DoxyCodeLine{00054\ \ \ \ \ printf(\textcolor{stringliteral}{"{}num\_heads:\ \%zu\(\backslash\)n"{}},\ NH);}
\DoxyCodeLine{00055\ \ \ \ \ printf(\textcolor{stringliteral}{"{}channels:\ \%zu\(\backslash\)n"{}},\ C);}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ gpt2\_\ =\ std::make\_unique<gpt::GPT>(}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ config.max\_seq\_len,\ config.vocab\_size,\ config.padded\_vocab\_size,}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ config.num\_layers,\ config.num\_heads,\ config.channels);}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{comment}{//\ allocate\ space\ for\ all\ the\ parameters\ and\ read\ them\ in}}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ num\_parameters\ =\ gpt2\_-\/>NumParameters();}
\DoxyCodeLine{00062\ \ \ \ \ printf(\textcolor{stringliteral}{"{}num\_parameters:\ \%zu(\%zu\ MB)\(\backslash\)n"{}},\ num\_parameters,}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ num\_parameters\ *\ \textcolor{keyword}{sizeof}(floatX)\ /\ 1024\ /\ 1024);}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keyword}{auto}\ restore\_fn\ =\ [\&](nn::Parameter*\ p,\ \textcolor{keyword}{const}\ std::string\&\ name)\ \{}
\DoxyCodeLine{00066\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_USE\_GPU}}
\DoxyCodeLine{00067\ \ \ \ \ \ \ std::vector<Type>\ cpu\_data(p-\/>size());}
\DoxyCodeLine{00068\ \ \ \ \ \ \ freadCheck(cpu\_data.data(),\ \textcolor{keyword}{sizeof}(Type),\ p-\/>size(),\ model\_file);}
\DoxyCodeLine{00069\ \ \ \ \ \ \ nn::g\_device.memcpyHostToDevice(p-\/>data<Type>(),\ cpu\_data.data(),}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(Type)\ *\ p-\/>size());}
\DoxyCodeLine{00071\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ freadCheck(p-\/>data<Type>(),\ \textcolor{keyword}{sizeof}(Type),\ p-\/>size(),\ model\_file);}
\DoxyCodeLine{00073\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00074\ \ \ \ \ \};}
\DoxyCodeLine{00075\ \ \ \ \ ApplyFn(restore\_fn,\ L);}
\DoxyCodeLine{00076\ \ \ \ \ fcloseCheck(model\_file);}
\DoxyCodeLine{00077\ \ \ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \textcolor{keywordtype}{void}\ Parameters(std::vector<nn::Parameter*>*\ parameters)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keyword}{auto}\ collect\_fn\ =\ [\&](nn::Parameter*\ p,\ \textcolor{keyword}{const}\ std::string\&\ name)\ \{}
\DoxyCodeLine{00081\ \ \ \ \ \ \ parameters-\/>push\_back(p);}
\DoxyCodeLine{00082\ \ \ \ \ \};}
\DoxyCodeLine{00083\ \ \ \ \ ApplyFn(collect\_fn,\ config.num\_layers);}
\DoxyCodeLine{00084\ \ \ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \textcolor{keywordtype}{void}\ Parameters(}
\DoxyCodeLine{00087\ \ \ \ \ \ \ std::unordered\_map<std::string,\ nn::Parameter*>*\ parameters)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keyword}{auto}\ collect\_fn\ =\ [\&](nn::Parameter*\ p,\ \textcolor{keyword}{const}\ std::string\&\ name)\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \ \ parameters-\/>insert(\{name,\ p\});}
\DoxyCodeLine{00090\ \ \ \ \ \};}
\DoxyCodeLine{00091\ \ \ \ \ ApplyFn(collect\_fn,\ config.num\_layers);}
\DoxyCodeLine{00092\ \ \ \}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \textcolor{keywordtype}{void}\ ApplyFn(}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::function<\textcolor{keywordtype}{void}(nn::Parameter*,\ \textcolor{keyword}{const}\ std::string\&)>\&\ apply\_fn,}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ L)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00097\ \ \ \ \ apply\_fn(gpt2\_-\/>wte\_-\/>weight\_.get(),\ \textcolor{stringliteral}{"{}wte"{}});}
\DoxyCodeLine{00098\ \ \ \ \ apply\_fn(gpt2\_-\/>wpe\_-\/>weight\_.get(),\ \textcolor{stringliteral}{"{}wpe"{}});}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keyword}{auto}\ name\_with\_layer\ =\ [](\textcolor{keyword}{const}\ std::string\&\ name,\ \textcolor{keywordtype}{int}\ l)\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ name\ +\ \textcolor{stringliteral}{"{}-\/L"{}}\ +\ std::to\_string(l);}
\DoxyCodeLine{00102\ \ \ \ \ \};}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{comment}{//\ ln1w}}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ block\ =\ gpt2\_-\/>h\_[l];}
\DoxyCodeLine{00107\ \ \ \ \ \ \ nn::Parameter*\ p\ =\ block-\/>ln1\_-\/>weight\_.get();}
\DoxyCodeLine{00108\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}ln1w"{}},\ l));}
\DoxyCodeLine{00109\ \ \ \ \ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{comment}{//\ ln1b}}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ block\ =\ gpt2\_-\/>h\_[l];}
\DoxyCodeLine{00114\ \ \ \ \ \ \ nn::Parameter*\ p\ =\ block-\/>ln1\_-\/>bias\_.get();}
\DoxyCodeLine{00115\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}ln1b"{}},\ l));}
\DoxyCodeLine{00116\ \ \ \ \ \}}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{comment}{//\ qkvw}}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ block\ =\ gpt2\_-\/>h\_[l];}
\DoxyCodeLine{00121\ \ \ \ \ \ \ nn::Parameter*\ p\ =\ block-\/>attn\_-\/>c\_attn\_-\/>weight\_.get();}
\DoxyCodeLine{00122\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}qkvw"{}},\ l));}
\DoxyCodeLine{00123\ \ \ \ \ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{comment}{//\ qkvb}}
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ block\ =\ gpt2\_-\/>h\_[l];}
\DoxyCodeLine{00128\ \ \ \ \ \ \ nn::Parameter*\ p\ =\ block-\/>attn\_-\/>c\_attn\_-\/>bias\_.get();}
\DoxyCodeLine{00129\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}qkvb"{}},\ l));}
\DoxyCodeLine{00130\ \ \ \ \ \}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{comment}{//\ attprojw}}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ block\ =\ gpt2\_-\/>h\_[l];}
\DoxyCodeLine{00135\ \ \ \ \ \ \ nn::Parameter*\ p\ =\ block-\/>attn\_-\/>c\_proj\_-\/>weight\_.get();}
\DoxyCodeLine{00136\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}attprojw"{}},\ l));}
\DoxyCodeLine{00137\ \ \ \ \ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{comment}{//\ attprojb}}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ block\ =\ gpt2\_-\/>h\_[l];}
\DoxyCodeLine{00142\ \ \ \ \ \ \ nn::Parameter*\ p\ =\ block-\/>attn\_-\/>c\_proj\_-\/>bias\_.get();}
\DoxyCodeLine{00143\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}attprojb"{}},\ l));}
\DoxyCodeLine{00144\ \ \ \ \ \}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{comment}{//\ ln2w}}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ block\ =\ gpt2\_-\/>h\_[l];}
\DoxyCodeLine{00149\ \ \ \ \ \ \ nn::Parameter*\ p\ =\ block-\/>ln2\_-\/>weight\_.get();}
\DoxyCodeLine{00150\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}ln2w"{}},\ l));}
\DoxyCodeLine{00151\ \ \ \ \ \}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{comment}{//\ ln2b}}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ block\ =\ gpt2\_-\/>h\_[l];}
\DoxyCodeLine{00156\ \ \ \ \ \ \ nn::Parameter*\ p\ =\ block-\/>ln2\_-\/>bias\_.get();}
\DoxyCodeLine{00157\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}ln2b"{}},\ l));}
\DoxyCodeLine{00158\ \ \ \ \ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{comment}{//\ fcw}}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ block\ =\ gpt2\_-\/>h\_[l];}
\DoxyCodeLine{00163\ \ \ \ \ \ \ nn::Parameter*\ p\ =\ block-\/>mlp\_-\/>c\_fc\_-\/>weight\_.get();}
\DoxyCodeLine{00164\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}fcw"{}},\ l));}
\DoxyCodeLine{00165\ \ \ \ \ \}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{comment}{//\ fcb}}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ block\ =\ gpt2\_-\/>h\_[l];}
\DoxyCodeLine{00170\ \ \ \ \ \ \ nn::Parameter*\ p\ =\ block-\/>mlp\_-\/>c\_fc\_-\/>bias\_.get();}
\DoxyCodeLine{00171\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}fcb"{}},\ l));}
\DoxyCodeLine{00172\ \ \ \ \ \}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{comment}{//\ fcprojw}}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ block\ =\ gpt2\_-\/>h\_[l];}
\DoxyCodeLine{00177\ \ \ \ \ \ \ nn::Parameter*\ p\ =\ block-\/>mlp\_-\/>c\_proj\_-\/>weight\_.get();}
\DoxyCodeLine{00178\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}fcprojw"{}},\ l));}
\DoxyCodeLine{00179\ \ \ \ \ \}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{comment}{//\ fcprojb}}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ block\ =\ gpt2\_-\/>h\_[l];}
\DoxyCodeLine{00184\ \ \ \ \ \ \ nn::Parameter*\ p\ =\ block-\/>mlp\_-\/>c\_proj\_-\/>bias\_.get();}
\DoxyCodeLine{00185\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}fcprojb"{}},\ l));}
\DoxyCodeLine{00186\ \ \ \ \ \}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{comment}{//\ lnfw}}
\DoxyCodeLine{00189\ \ \ \ \ apply\_fn(gpt2\_-\/>lnf\_-\/>weight\_.get(),\ \textcolor{stringliteral}{"{}lnfw"{}});}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{comment}{//\ lnfb}}
\DoxyCodeLine{00191\ \ \ \ \ apply\_fn(gpt2\_-\/>lnf\_-\/>bias\_.get(),\ \textcolor{stringliteral}{"{}lnfb"{}});}
\DoxyCodeLine{00192\ \ \ \}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \mbox{\hyperlink{structgpt2_1_1GPT2Config}{GPT2Config}}\ config;}
\DoxyCodeLine{00195\ \ \ std::unique\_ptr<gpt::GPT>\ gpt2\_;}
\DoxyCodeLine{00196\ \};}
\DoxyCodeLine{00197\ \}\ \ \textcolor{comment}{//\ namespace\ gpt2}}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ LLM\_CPP\_\_GPT2\_HPP\_}}

\end{DoxyCode}
