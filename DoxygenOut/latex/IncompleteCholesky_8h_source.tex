\doxysection{Incomplete\+Cholesky.\+h}
\hypertarget{IncompleteCholesky_8h_source}{}\label{IncompleteCholesky_8h_source}\index{eigen/Eigen/src/IterativeLinearSolvers/IncompleteCholesky.h@{eigen/Eigen/src/IterativeLinearSolvers/IncompleteCholesky.h}}
\mbox{\hyperlink{IncompleteCholesky_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ This\ file\ is\ part\ of\ Eigen,\ a\ lightweight\ C++\ template\ library}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ for\ linear\ algebra.}}
\DoxyCodeLine{00003\ \textcolor{comment}{//}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ Copyright\ (C)\ 2012\ Désiré\ Nuentsa-\/Wakam\ <desire.nuentsa\_wakam@inria.fr>}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ Copyright\ (C)\ 2015\ Gael\ Guennebaud\ <gael.guennebaud@inria.fr>}}
\DoxyCodeLine{00006\ \textcolor{comment}{//}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ This\ Source\ Code\ Form\ is\ subject\ to\ the\ terms\ of\ the\ Mozilla}}
\DoxyCodeLine{00008\ \textcolor{comment}{//\ Public\ License\ v.\ 2.0.\ If\ a\ copy\ of\ the\ MPL\ was\ not\ distributed}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ with\ this\ file,\ You\ can\ obtain\ one\ at\ http://mozilla.org/MPL/2.0/.}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#ifndef\ EIGEN\_INCOMPLETE\_CHOlESKY\_H}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#define\ EIGEN\_INCOMPLETE\_CHOlESKY\_H}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <list>}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceEigen}{Eigen}}\ \{}
\DoxyCodeLine{00044\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Scalar,\ \textcolor{keywordtype}{int}\ \_UpLo\ =\ Lower,\ \textcolor{keyword}{typename}\ \_OrderingType\ =\ AMDOrdering<\textcolor{keywordtype}{int}>\ >}
\DoxyCodeLine{00045\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classEigen_1_1IncompleteCholesky}{IncompleteCholesky}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classEigen_1_1SparseSolverBase}{SparseSolverBase}}<IncompleteCholesky<Scalar,\_UpLo,\_OrderingType>\ >}
\DoxyCodeLine{00046\ \{}
\DoxyCodeLine{00047\ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1SparseSolverBase}{SparseSolverBase<IncompleteCholesky<Scalar,\_UpLo,\_OrderingType>}}\ >\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ae0dc0c2ea9f836958cd320a3e37aa445}{Base}};}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1SparseSolverBase_ac52101f69d048d5c4b036eadf1f13673}{Base::m\_isInitialized}};}
\DoxyCodeLine{00050\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{structEigen_1_1GenericNumTraits_a6e9ee9306607a1a0b4f79be74dca97bb}{NumTraits<Scalar>::Real}}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ad519c4e96542b2c9cf4a3817bfaadcd3}{RealScalar}};}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keyword}{typedef}\ \_OrderingType\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a0b0040b0cf1503f3ae36f961528204fa}{OrderingType}};}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ OrderingType::PermutationType\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a20f264f32b88b0b95bd3602a733fad82}{PermutationType}};}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ PermutationType::StorageIndex\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a949ea5200a53ee39d9695044f4f79ae3}{StorageIndex}};}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1SparseMatrix}{SparseMatrix<Scalar,ColMajor,StorageIndex>}}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a27db7b913dd3b8faf1d6e3ac50b8ff9f}{FactorType}};}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1Matrix}{Matrix<Scalar,Dynamic,1>}}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a51aa9a62d0b43311b06a26eb864a271e}{VectorSx}};}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1Matrix}{Matrix<RealScalar,Dynamic,1>}}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a2f76b5d74c3b8e130e9720aad1437b22}{VectorRx}};}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1Matrix}{Matrix<StorageIndex,Dynamic,\ 1>}}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a239b5ce8e2d6b07caaa1da613e4a3cca}{VectorIx}};}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keyword}{typedef}\ std::vector<std::list<StorageIndex>\ >\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a56c7cbdfdbf7952a54e87ae7852947a8}{VectorList}};}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keyword}{enum}\ \{\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ad9b9be260fb03fd7f1a21e3821500217ad6c19f6c3a9314c44b77510c88631e6e}{UpLo}}\ =\ \_UpLo\ \};}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ab1d86f555f7f09636b7ea4bf98ec527aa839702a09ba67e4d019a9685fb9d4218}{ColsAtCompileTime}}\ =\ \mbox{\hyperlink{namespaceEigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic}},}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ab1d86f555f7f09636b7ea4bf98ec527aa34de452309f33073cf71e346ba13916f}{MaxColsAtCompileTime}}\ =\ Dynamic}
\DoxyCodeLine{00064\ \ \ \ \ \};}
\DoxyCodeLine{00065\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00073\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_adaaa3975b8cf53f910d6a3344af92379}{IncompleteCholesky}}()\ :\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a3a42e45e865228d446a3c6b49f474e87}{m\_initialShift}}(1e-\/3),\mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a5f034fe49d026dfef22a97a403d8aa4c}{m\_analysisIsOk}}(false),\mbox{\hyperlink{classEigen_1_1IncompleteCholesky_aab7215c08a43657abdaef848c3b90947}{m\_factorizationIsOk}}(false)\ \{\}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00078\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a757499fc814988a5b112b1f34d0295e1}{IncompleteCholesky}}(\textcolor{keyword}{const}\ MatrixType\&\ matrix)\ :\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a3a42e45e865228d446a3c6b49f474e87}{m\_initialShift}}(1e-\/3),\mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a5f034fe49d026dfef22a97a403d8aa4c}{m\_analysisIsOk}}(false),\mbox{\hyperlink{classEigen_1_1IncompleteCholesky_aab7215c08a43657abdaef848c3b90947}{m\_factorizationIsOk}}(false)}
\DoxyCodeLine{00079\ \ \ \ \ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a7966bedeebbeaa7a8fe4dd1da3797a0b}{compute}}(matrix);}
\DoxyCodeLine{00081\ \ \ \ \ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00084\ \ \ \ \ \mbox{\hyperlink{Macros_8h_a62a0d46d3d76fff438aec3b57f29c90c}{EIGEN\_CONSTEXPR}}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a773e54c9ac272b998430bd27d2889277}{rows}}()\ const\ \mbox{\hyperlink{Macros_8h_a532c42c61426cc18d84097e29577acf8}{EIGEN\_NOEXCEPT}}\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ac9bb29d22c7a1ecbb32212d9ea228b40}{m\_L}}.\mbox{\hyperlink{classEigen_1_1SparseMatrix_a0796a8adefc3c976877bd32621587424}{rows}}();\ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00087\ \ \ \ \ \mbox{\hyperlink{Macros_8h_a62a0d46d3d76fff438aec3b57f29c90c}{EIGEN\_CONSTEXPR}}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ac78d2b46d4071963d3cab4a762de6129}{cols}}()\ const\ \mbox{\hyperlink{Macros_8h_a532c42c61426cc18d84097e29577acf8}{EIGEN\_NOEXCEPT}}\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ac9bb29d22c7a1ecbb32212d9ea228b40}{m\_L}}.\mbox{\hyperlink{classEigen_1_1SparseMatrix_a02f9cfa31e16953a24968698b216c604}{cols}}();\ \}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00098\ \ \ \ \ \mbox{\hyperlink{group__enums_ga85fad7b87587764e5cf6b513a9e0ee5e}{ComputationInfo}}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ada0e68cb22601849464506f5986a88c1}{info}}()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00099\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \mbox{\hyperlink{Macros_8h_acaa7ba89800cfe18d5fd6eed620aea9c}{eigen\_assert}}(\mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ac52101f69d048d5c4b036eadf1f13673}{m\_isInitialized}}\ \&\&\ \textcolor{stringliteral}{"{}IncompleteCholesky\ is\ not\ initialized."{}});}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_abe5b6ad3c0a85dcd824a00697b490eac}{m\_info}};}
\DoxyCodeLine{00102\ \ \ \ \ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a409c9586e7d29566dda2c8f5e38a1228}{setInitialShift}}(\mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ad519c4e96542b2c9cf4a3817bfaadcd3}{RealScalar}}\ shift)\ \{\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a3a42e45e865228d446a3c6b49f474e87}{m\_initialShift}}\ =\ shift;\ \}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a702560ecdddef77dc51d20ab22bd974e}{analyzePattern}}(\textcolor{keyword}{const}\ MatrixType\&\ mat)}
\DoxyCodeLine{00112\ \ \ \ \ \{}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a0b0040b0cf1503f3ae36f961528204fa}{OrderingType}}\ ord;}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a20f264f32b88b0b95bd3602a733fad82}{PermutationType}}\ pinv;}
\DoxyCodeLine{00115\ \ \ \ \ \ \ ord(mat.template\ selfadjointView<UpLo>(),\ pinv);}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(pinv.size()>0)\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_acf5b562033401cd9b308259cd91a663e}{m\_perm}}\ =\ pinv.inverse();}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_acf5b562033401cd9b308259cd91a663e}{m\_perm}}.resize(0);}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ac9bb29d22c7a1ecbb32212d9ea228b40}{m\_L}}.\mbox{\hyperlink{classEigen_1_1SparseMatrix_a15dcd27320636526be90d60b1912e895}{resize}}(mat.rows(),\ mat.cols());}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a5f034fe49d026dfef22a97a403d8aa4c}{m\_analysisIsOk}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ac52101f69d048d5c4b036eadf1f13673}{m\_isInitialized}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_abe5b6ad3c0a85dcd824a00697b490eac}{m\_info}}\ =\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea671a2aeb0f527802806a441d58a80fcf}{Success}};}
\DoxyCodeLine{00122\ \ \ \ \ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ac39c75ff7ca5d2db9a9f03b937e12601}{factorize}}(\textcolor{keyword}{const}\ MatrixType\&\ mat);}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a7966bedeebbeaa7a8fe4dd1da3797a0b}{compute}}(\textcolor{keyword}{const}\ MatrixType\&\ mat)}
\DoxyCodeLine{00142\ \ \ \ \ \{}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a702560ecdddef77dc51d20ab22bd974e}{analyzePattern}}(mat);}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ac39c75ff7ca5d2db9a9f03b937e12601}{factorize}}(mat);}
\DoxyCodeLine{00145\ \ \ \ \ \}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{comment}{//\ internal}}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Rhs,\ \textcolor{keyword}{typename}\ Dest>}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a7df2a13e73f1ac4a2fc7a6524bd93f84}{\_solve\_impl}}(\textcolor{keyword}{const}\ Rhs\&\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2layout__test_8cc_ad66453096871179e6c6effe0df4b483b}{b}},\ Dest\&\ x)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00150\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \mbox{\hyperlink{Macros_8h_acaa7ba89800cfe18d5fd6eed620aea9c}{eigen\_assert}}(\mbox{\hyperlink{classEigen_1_1IncompleteCholesky_aab7215c08a43657abdaef848c3b90947}{m\_factorizationIsOk}}\ \&\&\ \textcolor{stringliteral}{"{}factorize()\ should\ be\ called\ first"{}});}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classEigen_1_1IncompleteCholesky_acf5b562033401cd9b308259cd91a663e}{m\_perm}}.rows()\ ==\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2layout__test_8cc_ad66453096871179e6c6effe0df4b483b}{b}}.rows())\ \ x\ =\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_acf5b562033401cd9b308259cd91a663e}{m\_perm}}\ *\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2layout__test_8cc_ad66453096871179e6c6effe0df4b483b}{b}};}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ x\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2layout__test_8cc_ad66453096871179e6c6effe0df4b483b}{b}};}
\DoxyCodeLine{00154\ \ \ \ \ \ \ x\ =\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_aa4281d82edea96d9b2c7f696140c7401}{m\_scale}}.asDiagonal()\ *\ x;}
\DoxyCodeLine{00155\ \ \ \ \ \ \ x\ =\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ac9bb29d22c7a1ecbb32212d9ea228b40}{m\_L}}.template\ triangularView<Lower>().solve(x);}
\DoxyCodeLine{00156\ \ \ \ \ \ \ x\ =\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ac9bb29d22c7a1ecbb32212d9ea228b40}{m\_L}}.\mbox{\hyperlink{classEigen_1_1SparseMatrixBase_adab34202f9694f1085b78850ea3dcb44}{adjoint}}().template\ triangularView<Upper>().solve(x);}
\DoxyCodeLine{00157\ \ \ \ \ \ \ x\ =\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_aa4281d82edea96d9b2c7f696140c7401}{m\_scale}}.asDiagonal()\ *\ x;}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classEigen_1_1IncompleteCholesky_acf5b562033401cd9b308259cd91a663e}{m\_perm}}.rows()\ ==\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2layout__test_8cc_ad66453096871179e6c6effe0df4b483b}{b}}.rows())}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ x\ =\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_acf5b562033401cd9b308259cd91a663e}{m\_perm}}.inverse()\ *\ x;}
\DoxyCodeLine{00160\ \ \ \ \ \}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1SparseMatrix}{FactorType}}\&\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ae731a1e5b3e8d86b4eb87fd07a4e3532}{matrixL}}()\textcolor{keyword}{\ const\ }\{\ \mbox{\hyperlink{Macros_8h_acaa7ba89800cfe18d5fd6eed620aea9c}{eigen\_assert}}(\textcolor{stringliteral}{"{}m\_factorizationIsOk"{}});\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ac9bb29d22c7a1ecbb32212d9ea228b40}{m\_L}};\ \}}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1Matrix}{VectorRx}}\&\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a781d291f3dc3cb5fd339ab99a18cddd0}{scalingS}}()\textcolor{keyword}{\ const\ }\{\ \mbox{\hyperlink{Macros_8h_acaa7ba89800cfe18d5fd6eed620aea9c}{eigen\_assert}}(\textcolor{stringliteral}{"{}m\_factorizationIsOk"{}});\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_aa4281d82edea96d9b2c7f696140c7401}{m\_scale}};\ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a20f264f32b88b0b95bd3602a733fad82}{PermutationType}}\&\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_abd97f2b0c2463f009edbe8f9f7e6599a}{permutationP}}()\textcolor{keyword}{\ const\ }\{\ \mbox{\hyperlink{Macros_8h_acaa7ba89800cfe18d5fd6eed620aea9c}{eigen\_assert}}(\textcolor{stringliteral}{"{}m\_analysisIsOk"{}});\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_acf5b562033401cd9b308259cd91a663e}{m\_perm}};\ \}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00172\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1SparseMatrix}{FactorType}}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ac9bb29d22c7a1ecbb32212d9ea228b40}{m\_L}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ lower\ part\ stored\ in\ CSC}}
\DoxyCodeLine{00173\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{VectorRx}}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_aa4281d82edea96d9b2c7f696140c7401}{m\_scale}};\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ vector\ for\ scaling\ the\ matrix}}
\DoxyCodeLine{00174\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ad519c4e96542b2c9cf4a3817bfaadcd3}{RealScalar}}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a3a42e45e865228d446a3c6b49f474e87}{m\_initialShift}};\ \ \ \textcolor{comment}{//\ The\ initial\ shift\ parameter}}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a5f034fe49d026dfef22a97a403d8aa4c}{m\_analysisIsOk}};}
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_aab7215c08a43657abdaef848c3b90947}{m\_factorizationIsOk}};}
\DoxyCodeLine{00177\ \ \ \ \ \mbox{\hyperlink{group__enums_ga85fad7b87587764e5cf6b513a9e0ee5e}{ComputationInfo}}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_abe5b6ad3c0a85dcd824a00697b490eac}{m\_info}};}
\DoxyCodeLine{00178\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a20f264f32b88b0b95bd3602a733fad82}{PermutationType}}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_acf5b562033401cd9b308259cd91a663e}{m\_perm}};}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ updateList(\mbox{\hyperlink{classEigen_1_1Ref}{Ref<const\ VectorIx>}}\ colPtr,\ \mbox{\hyperlink{classEigen_1_1Ref}{Ref<VectorIx>}}\ rowIdx,\ \mbox{\hyperlink{classEigen_1_1Ref}{Ref<VectorSx>}}\ vals,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\&\ \mbox{\hyperlink{BlockMethods_8h_a00a58bf5d6022e451612db73ffbf4aef}{col}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\&\ jk,\ \mbox{\hyperlink{classEigen_1_1Matrix}{VectorIx}}\&\ firstElt,\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a56c7cbdfdbf7952a54e87ae7852947a8}{VectorList}}\&\ listCol);}
\DoxyCodeLine{00182\ \};}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \textcolor{comment}{//\ Based\ on\ the\ following\ paper:}}
\DoxyCodeLine{00185\ \textcolor{comment}{//\ \ \ C-\/J.\ Lin\ and\ J.\ J.\ Moré,\ Incomplete\ Cholesky\ Factorizations\ with}}
\DoxyCodeLine{00186\ \textcolor{comment}{//\ \ \ Limited\ memory,\ SIAM\ J.\ Sci.\ Comput.\ \ 21(1),\ pp.\ 24-\/45,\ 1999}}
\DoxyCodeLine{00187\ \textcolor{comment}{//\ \ \ http://ftp.mcs.anl.gov/pub/tech\_reports/reports/P682.pdf}}
\DoxyCodeLine{00188\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Scalar,\ \textcolor{keywordtype}{int}\ \_UpLo,\ \textcolor{keyword}{typename}\ OrderingType>}
\DoxyCodeLine{00189\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ \_MatrixType>}
\DoxyCodeLine{00190\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ac39c75ff7ca5d2db9a9f03b937e12601}{IncompleteCholesky<Scalar,\_UpLo,\ OrderingType>::factorize}}(\textcolor{keyword}{const}\ \_MatrixType\&\ mat)}
\DoxyCodeLine{00191\ \{}
\DoxyCodeLine{00192\ \ \ \textcolor{keyword}{using\ }std::sqrt;}
\DoxyCodeLine{00193\ \ \ \mbox{\hyperlink{Macros_8h_acaa7ba89800cfe18d5fd6eed620aea9c}{eigen\_assert}}(m\_analysisIsOk\ \&\&\ \textcolor{stringliteral}{"{}analyzePattern()\ should\ be\ called\ first"{}});}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \textcolor{comment}{//\ Dropping\ strategy\ :\ Keep\ only\ the\ p\ largest\ elements\ per\ column,\ where\ p\ is\ the\ number\ of\ elements\ in\ the\ column\ of\ the\ original\ matrix.\ Other\ strategies\ will\ be\ added}}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \textcolor{comment}{//\ Apply\ the\ fill-\/reducing\ permutation\ computed\ in\ analyzePattern()}}
\DoxyCodeLine{00198\ \ \ \textcolor{keywordflow}{if}\ (m\_perm.rows()\ ==\ mat.rows()\ )\ \textcolor{comment}{//\ To\ detect\ the\ null\ permutation}}
\DoxyCodeLine{00199\ \ \ \{}
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{comment}{//\ The\ temporary\ is\ needed\ to\ make\ sure\ that\ the\ diagonal\ entry\ is\ properly\ sorted}}
\DoxyCodeLine{00201\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1SparseMatrix}{FactorType}}\ tmp(mat.rows(),\ mat.cols());}
\DoxyCodeLine{00202\ \ \ \ \ tmp\ =\ mat.template\ selfadjointView<\_UpLo>().\mbox{\hyperlink{classEigen_1_1SparseMatrixBase_ad244a709f56230a8030b078a7ee889c6}{twistedBy}}(m\_perm);}
\DoxyCodeLine{00203\ \ \ \ \ m\_L.template\ selfadjointView<Lower>()\ =\ tmp.template\ selfadjointView<Lower>();}
\DoxyCodeLine{00204\ \ \ \}}
\DoxyCodeLine{00205\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00206\ \ \ \{}
\DoxyCodeLine{00207\ \ \ \ \ m\_L.template\ selfadjointView<Lower>()\ =\ mat.template\ selfadjointView<\_UpLo>();}
\DoxyCodeLine{00208\ \ \ \}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ =\ m\_L.cols();}
\DoxyCodeLine{00211\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ nnz\ =\ m\_L.nonZeros();}
\DoxyCodeLine{00212\ \ \ \mbox{\hyperlink{classEigen_1_1Map}{Map<VectorSx>}}\ vals(m\_L.valuePtr(),\ nnz);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//values}}
\DoxyCodeLine{00213\ \ \ \mbox{\hyperlink{classEigen_1_1Map}{Map<VectorIx>}}\ rowIdx(m\_L.innerIndexPtr(),\ nnz);\ \ \textcolor{comment}{//Row\ indices}}
\DoxyCodeLine{00214\ \ \ \mbox{\hyperlink{classEigen_1_1Map}{Map<VectorIx>}}\ colPtr(\ m\_L.outerIndexPtr(),\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}+1);\ \textcolor{comment}{//\ Pointer\ to\ the\ beginning\ of\ each\ row}}
\DoxyCodeLine{00215\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{VectorIx}}\ firstElt(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}-\/1);\ \textcolor{comment}{//\ for\ each\ j,\ points\ to\ the\ next\ entry\ in\ vals\ that\ will\ be\ used\ in\ the\ factorization}}
\DoxyCodeLine{00216\ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a56c7cbdfdbf7952a54e87ae7852947a8}{VectorList}}\ listCol(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});\ \ \textcolor{comment}{//\ listCol(j)\ is\ a\ linked\ list\ of\ columns\ to\ update\ column\ j}}
\DoxyCodeLine{00217\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{VectorSx}}\ col\_vals(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});\ \ \ \textcolor{comment}{//\ Store\ a\ \ nonzero\ values\ in\ each\ column}}
\DoxyCodeLine{00218\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{VectorIx}}\ col\_irow(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});\ \ \ \textcolor{comment}{//\ Row\ indices\ of\ nonzero\ elements\ in\ each\ column}}
\DoxyCodeLine{00219\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{VectorIx}}\ col\_pattern(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00220\ \ \ col\_pattern.fill(-\/1);}
\DoxyCodeLine{00221\ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a949ea5200a53ee39d9695044f4f79ae3}{StorageIndex}}\ col\_nnz;}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \textcolor{comment}{//\ Computes\ the\ scaling\ factors}}
\DoxyCodeLine{00225\ \ \ m\_scale.\mbox{\hyperlink{classEigen_1_1PlainObjectBase_a99d9054ee2d5a40c6e00ded0265e9cea}{resize}}(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00226\ \ \ m\_scale.setZero();}
\DoxyCodeLine{00227\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ j\ =\ 0;\ j\ <\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}};\ j++)}
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ k\ =\ colPtr[j];\ k\ <\ colPtr[j+1];\ k++)}
\DoxyCodeLine{00229\ \ \ \ \ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ m\_scale(j)\ +=\ \mbox{\hyperlink{namespaceEigen_1_1numext_ad59216129a430099e97b4c4b1e2f2984}{numext::abs2}}(vals(k));}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(rowIdx[k]!=j)}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ m\_scale(rowIdx[k])\ +=\ \mbox{\hyperlink{namespaceEigen_1_1numext_ad59216129a430099e97b4c4b1e2f2984}{numext::abs2}}(vals(k));}
\DoxyCodeLine{00233\ \ \ \ \ \}}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ m\_scale\ =\ m\_scale.cwiseSqrt().cwiseSqrt();}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ j\ =\ 0;\ j\ <\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}};\ ++j)}
\DoxyCodeLine{00238\ \ \ \ \ \textcolor{keywordflow}{if}(m\_scale(j)>(std::numeric\_limits<RealScalar>::min)())}
\DoxyCodeLine{00239\ \ \ \ \ \ \ m\_scale(j)\ =\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ad519c4e96542b2c9cf4a3817bfaadcd3}{RealScalar}}(1)/m\_scale(j);}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00241\ \ \ \ \ \ \ m\_scale(j)\ =\ 1;}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \textcolor{comment}{//\ TODO\ disable\ scaling\ if\ not\ needed,\ i.e.,\ if\ it\ is\ roughly\ uniform?\ (this\ will\ make\ solve()\ faster)}}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \textcolor{comment}{//\ Scale\ and\ compute\ the\ shift\ for\ the\ matrix}}
\DoxyCodeLine{00246\ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ad519c4e96542b2c9cf4a3817bfaadcd3}{RealScalar}}\ mindiag\ =\ \mbox{\hyperlink{structEigen_1_1GenericNumTraits_ac8509669719a15051e933e0dc7efd3b6}{NumTraits<RealScalar>::highest}}();}
\DoxyCodeLine{00247\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ j\ =\ 0;\ j\ <\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}};\ j++)}
\DoxyCodeLine{00248\ \ \ \{}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ k\ =\ colPtr[j];\ k\ <\ colPtr[j+1];\ k++)}
\DoxyCodeLine{00250\ \ \ \ \ \ \ vals[k]\ *=\ (m\_scale(j)*m\_scale(rowIdx[k]));}
\DoxyCodeLine{00251\ \ \ \ \ \mbox{\hyperlink{Macros_8h_a4e742b5a08636a61784c0e173b61e710}{eigen\_internal\_assert}}(rowIdx[colPtr[j]]==j\ \&\&\ \textcolor{stringliteral}{"{}IncompleteCholesky:\ only\ the\ lower\ triangular\ part\ must\ be\ stored"{}});}
\DoxyCodeLine{00252\ \ \ \ \ mindiag\ =\ \mbox{\hyperlink{namespaceEigen_1_1numext_ab3b30bf0bcfa1ad91dbec75fabb3bea0}{numext::mini}}(numext::real(vals[colPtr[j]]),\ mindiag);}
\DoxyCodeLine{00253\ \ \ \}}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \mbox{\hyperlink{classEigen_1_1SparseMatrix}{FactorType}}\ L\_save\ =\ m\_L;}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ad519c4e96542b2c9cf4a3817bfaadcd3}{RealScalar}}\ shift\ =\ 0;}
\DoxyCodeLine{00258\ \ \ \textcolor{keywordflow}{if}(mindiag\ <=\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ad519c4e96542b2c9cf4a3817bfaadcd3}{RealScalar}}(0.))}
\DoxyCodeLine{00259\ \ \ \ \ shift\ =\ m\_initialShift\ -\/\ mindiag;}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ m\_info\ =\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea1c6e20706575a629b27a105f07f1883b}{NumericalIssue}};}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \ \ \textcolor{comment}{//\ Try\ to\ perform\ the\ incomplete\ factorization\ using\ the\ current\ shift}}
\DoxyCodeLine{00264\ \ \ \textcolor{keywordtype}{int}\ iter\ =\ 0;}
\DoxyCodeLine{00265\ \ \ \textcolor{keywordflow}{do}}
\DoxyCodeLine{00266\ \ \ \{}
\DoxyCodeLine{00267\ \ \ \ \ \textcolor{comment}{//\ Apply\ the\ shift\ to\ the\ diagonal\ elements\ of\ the\ matrix}}
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ j\ =\ 0;\ j\ <\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}};\ j++)}
\DoxyCodeLine{00269\ \ \ \ \ \ \ vals[colPtr[j]]\ +=\ shift;}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{comment}{//\ jki\ version\ of\ the\ Cholesky\ factorization}}
\DoxyCodeLine{00272\ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ j=0;}
\DoxyCodeLine{00273\ \ \ \ \ \textcolor{keywordflow}{for}\ (;\ j\ <\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}};\ ++j)}
\DoxyCodeLine{00274\ \ \ \ \ \{}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \textcolor{comment}{//\ Left-\/looking\ factorization\ of\ the\ j-\/th\ column}}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \textcolor{comment}{//\ First,\ load\ the\ j-\/th\ column\ into\ col\_vals}}
\DoxyCodeLine{00277\ \ \ \ \ \ \ Scalar\ diag\ =\ vals[colPtr[j]];\ \ \textcolor{comment}{//\ It\ is\ assumed\ that\ only\ the\ lower\ part\ is\ stored}}
\DoxyCodeLine{00278\ \ \ \ \ \ \ col\_nnz\ =\ 0;}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ =\ colPtr[j]\ +\ 1;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ <\ colPtr[j+1];\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}++)}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a949ea5200a53ee39d9695044f4f79ae3}{StorageIndex}}\ l\ =\ rowIdx[\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}];}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ col\_vals(col\_nnz)\ =\ vals[\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}];}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ col\_irow(col\_nnz)\ =\ l;}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ col\_pattern(l)\ =\ col\_nnz;}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ col\_nnz++;}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ std::list<StorageIndex>::iterator\ k;}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Browse\ all\ previous\ columns\ that\ will\ update\ column\ j}}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(k\ =\ listCol[j].\mbox{\hyperlink{abseil-cpp_2absl_2strings_2internal_2str__format_2float__conversion_8cc_aa9f974458dc400bd897fe724a13dcd47}{begin}}();\ k\ !=\ listCol[j].end();\ k++)}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ jk\ =\ firstElt(*k);\ \textcolor{comment}{//\ First\ element\ to\ use\ in\ the\ column}}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{Macros_8h_a4e742b5a08636a61784c0e173b61e710}{eigen\_internal\_assert}}(rowIdx[jk]==j);}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ Scalar\ v\_j\_jk\ =\ numext::conj(vals[jk]);}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ jk\ +=\ 1;}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ =\ jk;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ <\ colPtr[*k+1];\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}++)}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_a949ea5200a53ee39d9695044f4f79ae3}{StorageIndex}}\ l\ =\ rowIdx[\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}];}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(col\_pattern[l]<0)}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ col\_vals(col\_nnz)\ =\ vals[\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}]\ *\ v\_j\_jk;}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ col\_irow[col\_nnz]\ =\ l;}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ col\_pattern(l)\ =\ col\_nnz;}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ col\_nnz++;}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ col\_vals(col\_pattern[l])\ -\/=\ vals[\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}]\ *\ v\_j\_jk;}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \ \ updateList(colPtr,rowIdx,vals,\ *k,\ jk,\ firstElt,\ listCol);}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \ \ \ \ \textcolor{comment}{//\ Scale\ the\ current\ column}}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(numext::real(diag)\ <=\ 0)}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(++iter>=10)}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ increase\ shift}}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ shift\ =\ \mbox{\hyperlink{namespaceEigen_1_1numext_a29d502349f2ec9897c808e65e0f96eb4}{numext::maxi}}(m\_initialShift,\mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ad519c4e96542b2c9cf4a3817bfaadcd3}{RealScalar}}(2)*shift);}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ restore\ m\_L,\ col\_pattern,\ and\ listCol}}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ vals\ =\ \mbox{\hyperlink{classEigen_1_1Map}{Map<const\ VectorSx>}}(L\_save.\mbox{\hyperlink{classEigen_1_1SparseMatrix_ad8a7af29605af66a62e5d7bba9eae97c}{valuePtr}}(),\ nnz);}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ rowIdx\ =\ \mbox{\hyperlink{classEigen_1_1Map}{Map<const\ VectorIx>}}(L\_save.\mbox{\hyperlink{classEigen_1_1SparseMatrix_af17559adab8204bccaa2ec1e2e484193}{innerIndexPtr}}(),\ nnz);}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ colPtr\ =\ \mbox{\hyperlink{classEigen_1_1Map}{Map<const\ VectorIx>}}(L\_save.\mbox{\hyperlink{classEigen_1_1SparseMatrix_aed8b6c615736294a1a5d56880c27e2b6}{outerIndexPtr}}(),\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}+1);}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ col\_pattern.fill(-\/1);}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}=0;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}<\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}};\ ++\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ listCol[\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}].clear();}
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky_ad519c4e96542b2c9cf4a3817bfaadcd3}{RealScalar}}\ rdiag\ =\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a656b9217a2fcb6de59dc8d1eb3079cc7}{sqrt}}(numext::real(diag));}
\DoxyCodeLine{00334\ \ \ \ \ \ \ vals[colPtr[j]]\ =\ rdiag;}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ k\ =\ 0;\ k<col\_nnz;\ ++k)}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ =\ col\_irow[k];}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \textcolor{comment}{//Scale}}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ col\_vals(k)\ /=\ rdiag;}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \textcolor{comment}{//Update\ the\ remaining\ diagonals\ with\ col\_vals}}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ vals[colPtr[\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}]]\ -\/=\ \mbox{\hyperlink{namespaceEigen_1_1numext_ad59216129a430099e97b4c4b1e2f2984}{numext::abs2}}(col\_vals(k));}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \textcolor{comment}{//\ Select\ the\ largest\ p\ elements}}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \textcolor{comment}{//\ p\ is\ the\ original\ number\ of\ elements\ in\ the\ column\ (without\ the\ diagonal)}}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ p\ =\ colPtr[j+1]\ -\/\ colPtr[j]\ -\/\ 1\ ;}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1Ref}{Ref<VectorSx>}}\ cvals\ =\ col\_vals.head(col\_nnz);}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \mbox{\hyperlink{classEigen_1_1Ref}{Ref<VectorIx>}}\ cirow\ =\ col\_irow.head(col\_nnz);}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \mbox{\hyperlink{namespaceEigen_1_1internal_a78664f5a9fe806690984dc3a31738a6b}{internal::QuickSplit}}(cvals,cirow,\ p);}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \textcolor{comment}{//\ Insert\ the\ largest\ p\ elements\ in\ the\ matrix}}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ cpt\ =\ 0;}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ =\ colPtr[j]+1;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ <\ colPtr[j+1];\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}++)}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ vals[\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}]\ =\ col\_vals(cpt);}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ rowIdx[\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}]\ =\ col\_irow(cpt);}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ restore\ col\_pattern:}}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ col\_pattern(col\_irow(cpt))\ =\ -\/1;}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ cpt++;}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ first\ smallest\ row\ index\ and\ put\ it\ after\ the\ diagonal\ element}}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ jk\ =\ colPtr(j)+1;}
\DoxyCodeLine{00361\ \ \ \ \ \ \ updateList(colPtr,rowIdx,vals,j,jk,firstElt,listCol);}
\DoxyCodeLine{00362\ \ \ \ \ \}}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{keywordflow}{if}(j==\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}})}
\DoxyCodeLine{00365\ \ \ \ \ \{}
\DoxyCodeLine{00366\ \ \ \ \ \ \ m\_factorizationIsOk\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00367\ \ \ \ \ \ \ m\_info\ =\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea671a2aeb0f527802806a441d58a80fcf}{Success}};}
\DoxyCodeLine{00368\ \ \ \ \ \}}
\DoxyCodeLine{00369\ \ \ \}\ \textcolor{keywordflow}{while}(m\_info!=\mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea671a2aeb0f527802806a441d58a80fcf}{Success}});}
\DoxyCodeLine{00370\ \}}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00372\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Scalar,\ \textcolor{keywordtype}{int}\ \_UpLo,\ \textcolor{keyword}{typename}\ OrderingType>}
\DoxyCodeLine{00373\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1IncompleteCholesky}{IncompleteCholesky<Scalar,\_UpLo,\ OrderingType>::updateList}}(\mbox{\hyperlink{classEigen_1_1Ref}{Ref<const\ VectorIx>}}\ colPtr,\ \mbox{\hyperlink{classEigen_1_1Ref}{Ref<VectorIx>}}\ rowIdx,\ \mbox{\hyperlink{classEigen_1_1Ref}{Ref<VectorSx>}}\ vals,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\&\ \mbox{\hyperlink{BlockMethods_8h_a00a58bf5d6022e451612db73ffbf4aef}{col}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\&\ jk,\ VectorIx\&\ firstElt,\ VectorList\&\ listCol)}
\DoxyCodeLine{00374\ \{}
\DoxyCodeLine{00375\ \ \ \textcolor{keywordflow}{if}\ (jk\ <\ colPtr(\mbox{\hyperlink{BlockMethods_8h_a00a58bf5d6022e451612db73ffbf4aef}{col}}+1)\ )}
\DoxyCodeLine{00376\ \ \ \{}
\DoxyCodeLine{00377\ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ p\ =\ colPtr(\mbox{\hyperlink{BlockMethods_8h_a00a58bf5d6022e451612db73ffbf4aef}{col}}+1)\ -\/\ jk;}
\DoxyCodeLine{00378\ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ minpos;}
\DoxyCodeLine{00379\ \ \ \ \ rowIdx.segment(jk,p).minCoeff(\&minpos);}
\DoxyCodeLine{00380\ \ \ \ \ minpos\ +=\ jk;}
\DoxyCodeLine{00381\ \ \ \ \ \textcolor{keywordflow}{if}\ (rowIdx(minpos)\ !=\ rowIdx(jk))}
\DoxyCodeLine{00382\ \ \ \ \ \{}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \textcolor{comment}{//Swap}}
\DoxyCodeLine{00384\ \ \ \ \ \ \ std::swap(rowIdx(jk),rowIdx(minpos));}
\DoxyCodeLine{00385\ \ \ \ \ \ \ std::swap(vals(jk),vals(minpos));}
\DoxyCodeLine{00386\ \ \ \ \ \}}
\DoxyCodeLine{00387\ \ \ \ \ firstElt(\mbox{\hyperlink{BlockMethods_8h_a00a58bf5d6022e451612db73ffbf4aef}{col}})\ =\ \mbox{\hyperlink{namespaceEigen_1_1internal_a66f17ef65b1821965dcb8ad9a660b064}{internal::convert\_index<StorageIndex,Index>}}(jk);}
\DoxyCodeLine{00388\ \ \ \ \ listCol[rowIdx(jk)].push\_back(\mbox{\hyperlink{namespaceEigen_1_1internal_a66f17ef65b1821965dcb8ad9a660b064}{internal::convert\_index<StorageIndex,Index>}}(\mbox{\hyperlink{BlockMethods_8h_a00a58bf5d6022e451612db73ffbf4aef}{col}}));}
\DoxyCodeLine{00389\ \ \ \}}
\DoxyCodeLine{00390\ \}}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00392\ \}\ \textcolor{comment}{//\ end\ namespace\ Eigen}}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
