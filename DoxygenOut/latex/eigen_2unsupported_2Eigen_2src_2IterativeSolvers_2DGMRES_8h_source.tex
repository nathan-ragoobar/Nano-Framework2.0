\doxysection{DGMRES.\+h}
\hypertarget{eigen_2unsupported_2Eigen_2src_2IterativeSolvers_2DGMRES_8h_source}{}\label{eigen_2unsupported_2Eigen_2src_2IterativeSolvers_2DGMRES_8h_source}\index{eigen/unsupported/Eigen/src/IterativeSolvers/DGMRES.h@{eigen/unsupported/Eigen/src/IterativeSolvers/DGMRES.h}}
\mbox{\hyperlink{eigen_2unsupported_2Eigen_2src_2IterativeSolvers_2DGMRES_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ This\ file\ is\ part\ of\ Eigen,\ a\ lightweight\ C++\ template\ library}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ for\ linear\ algebra.}}
\DoxyCodeLine{00003\ \textcolor{comment}{//}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ Copyright\ (C)\ 2012\ Désiré\ Nuentsa-\/Wakam\ <desire.nuentsa\_wakam@inria.fr>}}
\DoxyCodeLine{00005\ \textcolor{comment}{//}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ This\ Source\ Code\ Form\ is\ subject\ to\ the\ terms\ of\ the\ Mozilla}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ Public\ License\ v.\ 2.0.\ If\ a\ copy\ of\ the\ MPL\ was\ not\ distributed}}
\DoxyCodeLine{00008\ \textcolor{comment}{//\ with\ this\ file,\ You\ can\ obtain\ one\ at\ http://mozilla.org/MPL/2.0/.}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#ifndef\ EIGEN\_DGMRES\_H}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#define\ EIGEN\_DGMRES\_H}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}../../../../Eigen/Eigenvalues"{}}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceEigen}{Eigen}}\ \{\ }
\DoxyCodeLine{00016\ \ \ }
\DoxyCodeLine{00017\ \textcolor{keyword}{template}<\ \textcolor{keyword}{typename}\ \_MatrixType,}
\DoxyCodeLine{00018\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ \_Preconditioner\ =\ DiagonalPreconditioner<typename\ \_MatrixType::Scalar>\ >}
\DoxyCodeLine{00019\ \textcolor{keyword}{class\ }DGMRES;}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceinternal}{internal}}\ \{}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{template}<\ \textcolor{keyword}{typename}\ \_MatrixType,\ \textcolor{keyword}{typename}\ \_Preconditioner>}
\DoxyCodeLine{00024\ \textcolor{keyword}{struct\ }traits<DGMRES<\_MatrixType,\_Preconditioner>\ >}
\DoxyCodeLine{00025\ \{}
\DoxyCodeLine{00026\ \ \ \textcolor{keyword}{typedef}\ \_MatrixType\ \mbox{\hyperlink{structEigen_1_1internal_1_1traits_3_01DGMRES_3_01__MatrixType_00_01__Preconditioner_01_4_01_4_ac484f53f4a4d6333189bc3eea934fe70}{MatrixType}};}
\DoxyCodeLine{00027\ \ \ \textcolor{keyword}{typedef}\ \_Preconditioner\ \mbox{\hyperlink{structEigen_1_1internal_1_1traits_3_01DGMRES_3_01__MatrixType_00_01__Preconditioner_01_4_01_4_a9202fcd39a676b35549434edb6680877}{Preconditioner}};}
\DoxyCodeLine{00028\ \};}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00038\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ VectorType,\ \textcolor{keyword}{typename}\ IndexType>}
\DoxyCodeLine{00039\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceEigen_1_1internal_afe2a11c61eff70f7f68681a557fa21e7}{sortWithPermutation}}\ (VectorType\&\ vec,\ IndexType\&\ perm,\ \textcolor{keyword}{typename}\ IndexType::Scalar\&\ ncut)}
\DoxyCodeLine{00040\ \{}
\DoxyCodeLine{00041\ \ \ \mbox{\hyperlink{eigen_2Eigen_2src_2Core_2util_2Macros_8h_acaa7ba89800cfe18d5fd6eed620aea9c}{eigen\_assert}}(vec.size()\ ==\ perm.size());}
\DoxyCodeLine{00042\ \ \ \textcolor{keywordtype}{bool}\ flag;\ }
\DoxyCodeLine{00043\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ k\ \ =\ 0;\ k\ <\ ncut;\ k++)}
\DoxyCodeLine{00044\ \ \ \{}
\DoxyCodeLine{00045\ \ \ \ \ flag\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ j\ =\ 0;\ j\ <\ vec.size()-\/1;\ j++)}
\DoxyCodeLine{00047\ \ \ \ \ \{}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ vec(perm(j))\ <\ vec(perm(j+1))\ )}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ std::swap(perm(j),perm(j+1));\ }
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ flag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!flag)\ \textcolor{keywordflow}{break};\ \textcolor{comment}{//\ The\ vector\ is\ in\ sorted\ order}}
\DoxyCodeLine{00054\ \ \ \ \ \}}
\DoxyCodeLine{00055\ \ \ \}}
\DoxyCodeLine{00056\ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \}}
\DoxyCodeLine{00100\ \textcolor{keyword}{template}<\ \textcolor{keyword}{typename}\ \_MatrixType,\ \textcolor{keyword}{typename}\ \_Preconditioner>}
\DoxyCodeLine{00101\ \textcolor{keyword}{class\ }DGMRES\ :\ \textcolor{keyword}{public}\ IterativeSolverBase<DGMRES<\_MatrixType,\_Preconditioner>\ >}
\DoxyCodeLine{00102\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1IterativeSolverBase_a0922f2be45082690d7734aa6732fc493}{IterativeSolverBase<DGMRES>}}\ Base;}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1IterativeSolverBase_af24f53813d56a98491957dabc1d2f7eb}{Base::matrix}};}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1IterativeSolverBase_a9140af00eb517cb5677dd6e1a60fab80}{Base::m\_error}};}
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1IterativeSolverBase_aa1e43c88482d7d73394ec3229f6e8a4a}{Base::m\_iterations}};}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1IterativeSolverBase_a283a3c6136f76e77ac29184352c3e940}{Base::m\_info}};}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1IterativeSolverBase_ac52101f69d048d5c4b036eadf1f13673}{Base::m\_isInitialized}};}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1IterativeSolverBase_acf34fdb3eb17a876810b9d6c5031e175}{Base::m\_tolerance}};\ }
\DoxyCodeLine{00110\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1IterativeSolverBase_a946a3c9598afbc6f93fbd4ac2742f6e2}{Base::\_solve\_impl}};}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1IterativeSolverBase_a9f2403e90106dcff20966cbc54ea38ff}{Base::\_solve\_with\_guess\_impl}};}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keyword}{typedef}\ \_MatrixType\ \mbox{\hyperlink{classEigen_1_1DGMRES_abebf2c0dc490d410fbf5f24dedc60712}{MatrixType}};}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ MatrixType::Scalar\ \mbox{\hyperlink{classEigen_1_1DGMRES_aa2172314b09dbddeb3661ca9c809b371}{Scalar}};}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ MatrixType::StorageIndex\ \mbox{\hyperlink{classEigen_1_1DGMRES_a5e96d9b5ca6098272003550ef87c32d2}{StorageIndex}};}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ MatrixType::RealScalar\ \mbox{\hyperlink{classEigen_1_1DGMRES_a7e47d437b590be8af0e9972e60adbe34}{RealScalar}};}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keyword}{typedef}\ \_Preconditioner\ \mbox{\hyperlink{classEigen_1_1DGMRES_acae98b6f30d350a136ed4bc3a270834b}{Preconditioner}};}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1Matrix}{Matrix<Scalar,Dynamic,Dynamic>}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a05308c7955a9b46de0c1db3313de4a13}{DenseMatrix}};\ }
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1Matrix}{Matrix<RealScalar,Dynamic,Dynamic>}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_ae344e5f211d9b6ba11bd775e91364938}{DenseRealMatrix}};\ }
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1Matrix}{Matrix<Scalar,Dynamic,1>}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a3e13a69524ae16bb352e2ee99f8e2a25}{DenseVector}};}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1Matrix}{Matrix<RealScalar,Dynamic,1>}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_ab7cd43fdffd538521e881dfd393a6a96}{DenseRealVector}};\ }
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1Matrix}{Matrix<std::complex<RealScalar>}},\ \mbox{\hyperlink{namespaceEigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic}},\ 1>\ \mbox{\hyperlink{classEigen_1_1DGMRES_a82456cdcdc4cea5fc8482837143830a5}{ComplexVector}};}
\DoxyCodeLine{00123\ \ }
\DoxyCodeLine{00124\ \ \ \ \ }
\DoxyCodeLine{00126\ \ \ \mbox{\hyperlink{classEigen_1_1DGMRES_a17bd25826b56c39bc7cc4ce8fbf8a848}{DGMRES}}()\ :\ \mbox{\hyperlink{classEigen_1_1IterativeSolverBase}{Base}}(),\mbox{\hyperlink{classEigen_1_1DGMRES_ab5f0105c1ff3d035054a12624f69181b}{m\_restart}}(30),\mbox{\hyperlink{classEigen_1_1DGMRES_a30674252b8ac12e303f0ec114e574492}{m\_neig}}(0),\mbox{\hyperlink{classEigen_1_1DGMRES_a5a3ef71312bce5745aaeaced22b48d91}{m\_r}}(0),\mbox{\hyperlink{classEigen_1_1DGMRES_a08debe5d30604a03a674d4ba3f7a3bbc}{m\_maxNeig}}(5),\mbox{\hyperlink{classEigen_1_1DGMRES_a38beee7707cc020cb666061bdd7c6f7e}{m\_isDeflAllocated}}(false),\mbox{\hyperlink{classEigen_1_1DGMRES_afc8a3fc0175e8a0905cb6870703ef2f9}{m\_isDeflInitialized}}(false)\ \{\}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00138\ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixDerived>}
\DoxyCodeLine{00139\ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a800fcf37c0ac66f76d5c070e4aeae2a7}{DGMRES}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structEigen_1_1EigenBase}{EigenBase<MatrixDerived>}}\&\ A)\ :\ \mbox{\hyperlink{classEigen_1_1IterativeSolverBase}{Base}}(A.\mbox{\hyperlink{classEigen_1_1IterativeSolverBase_ac8c149c121511c2f7e00a4b83d8b6791}{derived}}()),\ \mbox{\hyperlink{classEigen_1_1DGMRES_ab5f0105c1ff3d035054a12624f69181b}{m\_restart}}(30),\mbox{\hyperlink{classEigen_1_1DGMRES_a30674252b8ac12e303f0ec114e574492}{m\_neig}}(0),\mbox{\hyperlink{classEigen_1_1DGMRES_a5a3ef71312bce5745aaeaced22b48d91}{m\_r}}(0),\mbox{\hyperlink{classEigen_1_1DGMRES_a08debe5d30604a03a674d4ba3f7a3bbc}{m\_maxNeig}}(5),\mbox{\hyperlink{classEigen_1_1DGMRES_a38beee7707cc020cb666061bdd7c6f7e}{m\_isDeflAllocated}}(false),\mbox{\hyperlink{classEigen_1_1DGMRES_afc8a3fc0175e8a0905cb6870703ef2f9}{m\_isDeflInitialized}}(false)\ \{\}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \mbox{\hyperlink{classEigen_1_1DGMRES_a3cb89704ebc2dd5ed042aebeb7df7753}{\string~DGMRES}}()\ \{\}}
\DoxyCodeLine{00142\ \ \ }
\DoxyCodeLine{00144\ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Rhs,\textcolor{keyword}{typename}\ Dest>}
\DoxyCodeLine{00145\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a0c5213adf74452ce6e018d709764b1e7}{\_solve\_vector\_with\_guess\_impl}}(\textcolor{keyword}{const}\ Rhs\&\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2layout__test_8cc_ad66453096871179e6c6effe0df4b483b}{b}},\ Dest\&\ x)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00146\ \textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{00147\ \ \ \ \ \mbox{\hyperlink{eigen_2Eigen_2src_2Core_2util_2StaticAssert_8h_ac95cf960f4a8395b28af90edfda755f0}{EIGEN\_STATIC\_ASSERT}}(Rhs::ColsAtCompileTime==1\ ||\ Dest::ColsAtCompileTime==1,\ YOU\_TRIED\_CALLING\_A\_VECTOR\_METHOD\_ON\_A\_MATRIX);}
\DoxyCodeLine{00148\ \ \ \ \ }
\DoxyCodeLine{00149\ \ \ \ \ m\_iterations\ =\ \mbox{\hyperlink{classEigen_1_1IterativeSolverBase_a168a74c8dceb6233b220031fdd756ba0}{Base::maxIterations}}();}
\DoxyCodeLine{00150\ \ \ \ \ m\_error\ =\ \mbox{\hyperlink{classEigen_1_1IterativeSolverBase_acf34fdb3eb17a876810b9d6c5031e175}{Base::m\_tolerance}};}
\DoxyCodeLine{00151\ \ \ \ \ }
\DoxyCodeLine{00152\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1DGMRES_a1b06062ec16932d3a20ea4767d9de51d}{dgmres}}(matrix(),\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2layout__test_8cc_ad66453096871179e6c6effe0df4b483b}{b}},\ x,\ \mbox{\hyperlink{classEigen_1_1IterativeSolverBase_a965e3600bc2a59bc24af0bdf8e7f4dd4}{Base::m\_preconditioner}});}
\DoxyCodeLine{00153\ \ \ \}}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00158\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_afba35ad9e10dba460a9658075ade4d57}{restart}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classEigen_1_1DGMRES_ab5f0105c1ff3d035054a12624f69181b}{m\_restart}};\ \}}
\DoxyCodeLine{00159\ \ \ }
\DoxyCodeLine{00163\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1DGMRES_abc4c4e02112c861b122a19a2742319f0}{set\_restart}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_afba35ad9e10dba460a9658075ade4d57}{restart}})\ \{\ \mbox{\hyperlink{classEigen_1_1DGMRES_ab5f0105c1ff3d035054a12624f69181b}{m\_restart}}=\mbox{\hyperlink{classEigen_1_1DGMRES_afba35ad9e10dba460a9658075ade4d57}{restart}};\ \}}
\DoxyCodeLine{00164\ \ \ }
\DoxyCodeLine{00168\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1DGMRES_ae74eb1faaaf3559bcf73b4d7703ea629}{setEigenv}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ neig)\ }
\DoxyCodeLine{00169\ \ \ \{}
\DoxyCodeLine{00170\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1DGMRES_a30674252b8ac12e303f0ec114e574492}{m\_neig}}\ =\ neig;}
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keywordflow}{if}\ (neig+1\ >\ \mbox{\hyperlink{classEigen_1_1DGMRES_a08debe5d30604a03a674d4ba3f7a3bbc}{m\_maxNeig}})\ \mbox{\hyperlink{classEigen_1_1DGMRES_a08debe5d30604a03a674d4ba3f7a3bbc}{m\_maxNeig}}\ =\ neig+1;\ \textcolor{comment}{//\ To\ allow\ for\ complex\ conjugates}}
\DoxyCodeLine{00172\ \ \ \}}
\DoxyCodeLine{00173\ \ \ }
\DoxyCodeLine{00177\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_ab80013fc06926d2067b677a021367363}{deflSize}}()\ \{\textcolor{keywordflow}{return}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a5a3ef71312bce5745aaeaced22b48d91}{m\_r}};\ \}}
\DoxyCodeLine{00178\ \ \ }
\DoxyCodeLine{00182\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a6e715bd5199a6a4474a9bc9e8481f9bd}{setMaxEigenv}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ maxNeig)\ \{\ \mbox{\hyperlink{classEigen_1_1DGMRES_a08debe5d30604a03a674d4ba3f7a3bbc}{m\_maxNeig}}\ =\ maxNeig;\ \}}
\DoxyCodeLine{00183\ \ \ }
\DoxyCodeLine{00184\ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{comment}{//\ DGMRES\ algorithm\ }}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Rhs,\ \textcolor{keyword}{typename}\ Dest>}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a1b06062ec16932d3a20ea4767d9de51d}{dgmres}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1DGMRES_abebf2c0dc490d410fbf5f24dedc60712}{MatrixType}}\&\ mat,\textcolor{keyword}{const}\ Rhs\&\ rhs,\ Dest\&\ x,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1DGMRES_acae98b6f30d350a136ed4bc3a270834b}{Preconditioner}}\&\ precond)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{comment}{//\ Perform\ one\ cycle\ of\ GMRES}}
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Dest>}
\DoxyCodeLine{00190\ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_ab77d66ef7f84ff15b6bd55fb76619218}{dgmresCycle}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1DGMRES_abebf2c0dc490d410fbf5f24dedc60712}{MatrixType}}\&\ mat,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1DGMRES_acae98b6f30d350a136ed4bc3a270834b}{Preconditioner}}\&\ precond,\ Dest\&\ x,\ \mbox{\hyperlink{classEigen_1_1DGMRES_a3e13a69524ae16bb352e2ee99f8e2a25}{DenseVector}}\&\ r0,\ \mbox{\hyperlink{classEigen_1_1DGMRES_a7e47d437b590be8af0e9972e60adbe34}{RealScalar}}\&\ beta,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a7e47d437b590be8af0e9972e60adbe34}{RealScalar}}\&\ normRhs,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\&\ nbIts)\ \textcolor{keyword}{const};\ }
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{comment}{//\ Compute\ data\ to\ use\ for\ deflation\ }}
\DoxyCodeLine{00192\ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a7bada6df49a235ad404802bc4e04b598}{dgmresComputeDeflationData}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1DGMRES_abebf2c0dc490d410fbf5f24dedc60712}{MatrixType}}\&\ mat,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1DGMRES_acae98b6f30d350a136ed4bc3a270834b}{Preconditioner}}\&\ precond,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\&\ it,\ \mbox{\hyperlink{classEigen_1_1DGMRES_a5e96d9b5ca6098272003550ef87c32d2}{StorageIndex}}\&\ neig)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{comment}{//\ Apply\ deflation\ to\ a\ vector}}
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ RhsType,\ \textcolor{keyword}{typename}\ DestType>}
\DoxyCodeLine{00195\ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_af0cb72e1c8fa37895d1543b1bb09f9d2}{dgmresApplyDeflation}}(\textcolor{keyword}{const}\ RhsType\&\ In,\ DestType\&\ Out)\ \textcolor{keyword}{const};\ }
\DoxyCodeLine{00196\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1DGMRES_a82456cdcdc4cea5fc8482837143830a5}{ComplexVector}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a92363374b8dbe7832b2b7560362c47e7}{schurValues}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1ComplexSchur}{ComplexSchur<DenseMatrix>}}\&\ schurofH)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00197\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1DGMRES_a82456cdcdc4cea5fc8482837143830a5}{ComplexVector}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a92363374b8dbe7832b2b7560362c47e7}{schurValues}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1RealSchur}{RealSchur<DenseMatrix>}}\&\ schurofH)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{comment}{//\ Init\ data\ for\ deflation}}
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a505c49553b8df373734e1a02e1c5ca70}{dgmresInitDeflation}}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\&\ \mbox{\hyperlink{classEigen_1_1IterativeSolverBase_a3f172c95041d588715d7193f528f43a0}{rows}})\ \textcolor{keyword}{const};\ }
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseMatrix}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a0fc43b2cca1d84701f629466d39d52b6}{m\_V}};\ \textcolor{comment}{//\ Krylov\ basis\ vectors}}
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseMatrix}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_abaa2292705aa731d5051b01c1be41dfb}{m\_H}};\ \textcolor{comment}{//\ Hessenberg\ matrix\ }}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseMatrix}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a3a611fc8ad4380f552d8ee7080b27c04}{m\_Hes}};\ \textcolor{comment}{//\ Initial\ hessenberg\ matrix\ without\ Givens\ rotations\ applied}}
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_ab5f0105c1ff3d035054a12624f69181b}{m\_restart}};\ \textcolor{comment}{//\ Maximum\ size\ of\ the\ Krylov\ subspace}}
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseMatrix}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a42caf1bb06f1833c434a1b169db79ac3}{m\_U}};\ \textcolor{comment}{//\ Vectors\ that\ form\ the\ basis\ of\ the\ invariant\ subspace\ }}
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseMatrix}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a19258f96b65369998943d21b5487cf56}{m\_MU}};\ \textcolor{comment}{//\ matrix\ operator\ applied\ to\ m\_U\ (for\ next\ cycles)}}
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseMatrix}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_ad37060ad7b0dd4136bc217fa6078965a}{m\_T}};\ \textcolor{comment}{/*\ T=U\string^T*M\string^\{-\/1\}*A*U\ */}}
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{classEigen_1_1PartialPivLU}{PartialPivLU<DenseMatrix>}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_ab7bd11bd69b89ec0c04d9f1107058694}{m\_luT}};\ \textcolor{comment}{//\ LU\ factorization\ of\ m\_T}}
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a5e96d9b5ca6098272003550ef87c32d2}{StorageIndex}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a30674252b8ac12e303f0ec114e574492}{m\_neig}};\ \textcolor{comment}{//Number\ of\ eigenvalues\ to\ extract\ at\ each\ restart}}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a5a3ef71312bce5745aaeaced22b48d91}{m\_r}};\ \textcolor{comment}{//\ Current\ number\ of\ deflated\ eigenvalues,\ size\ of\ m\_U}}
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a08debe5d30604a03a674d4ba3f7a3bbc}{m\_maxNeig}};\ \textcolor{comment}{//\ Maximum\ number\ of\ eigenvalues\ to\ deflate}}
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a7e47d437b590be8af0e9972e60adbe34}{RealScalar}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a1df5e45bd1aeef2c34a0d4777fd3f95b}{m\_lambdaN}};\ \textcolor{comment}{//Modulus\ of\ the\ largest\ eigenvalue\ of\ A}}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keyword}{mutable}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a38beee7707cc020cb666061bdd7c6f7e}{m\_isDeflAllocated}};}
\DoxyCodeLine{00213\ \ \ \ \ \textcolor{keyword}{mutable}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEigen_1_1DGMRES_afc8a3fc0175e8a0905cb6870703ef2f9}{m\_isDeflInitialized}};}
\DoxyCodeLine{00214\ \ \ \ \ }
\DoxyCodeLine{00215\ \ \ \ \ \textcolor{comment}{//Adaptive\ strategy\ }}
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a7e47d437b590be8af0e9972e60adbe34}{RealScalar}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_abb458f4403c029af772bfe4ff13843e4}{m\_smv}};\ \textcolor{comment}{//\ Smaller\ multiple\ of\ the\ remaining\ number\ of\ steps\ allowed}}
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{keyword}{mutable}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a168ad0062ed979171817bf7cce9d6a64}{m\_force}};\ \textcolor{comment}{//\ Force\ the\ use\ of\ deflation\ at\ each\ restart}}
\DoxyCodeLine{00218\ \ \ \ \ }
\DoxyCodeLine{00219\ \};\ }
\DoxyCodeLine{00226\ \textcolor{keyword}{template}<\ \textcolor{keyword}{typename}\ \_MatrixType,\ \textcolor{keyword}{typename}\ \_Preconditioner>}
\DoxyCodeLine{00227\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Rhs,\ \textcolor{keyword}{typename}\ Dest>}
\DoxyCodeLine{00228\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a1b06062ec16932d3a20ea4767d9de51d}{DGMRES<\_MatrixType,\ \_Preconditioner>::dgmres}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1DGMRES_abebf2c0dc490d410fbf5f24dedc60712}{MatrixType}}\&\ mat,\textcolor{keyword}{const}\ Rhs\&\ rhs,\ Dest\&\ x,}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1DGMRES_acae98b6f30d350a136ed4bc3a270834b}{Preconditioner}}\&\ precond)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00230\ \textcolor{keyword}{}\{}
\DoxyCodeLine{00231\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a7e47d437b590be8af0e9972e60adbe34}{RealScalar}}\ considerAsZero\ =\ (std::numeric\_limits<RealScalar>::min)();}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \mbox{\hyperlink{classEigen_1_1DGMRES_a7e47d437b590be8af0e9972e60adbe34}{RealScalar}}\ normRhs\ =\ rhs.norm();}
\DoxyCodeLine{00234\ \ \ \textcolor{keywordflow}{if}(normRhs\ <=\ considerAsZero)\ }
\DoxyCodeLine{00235\ \ \ \{}
\DoxyCodeLine{00236\ \ \ \ \ x.setZero();}
\DoxyCodeLine{00237\ \ \ \ \ m\_error\ =\ 0;}
\DoxyCodeLine{00238\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00239\ \ \ \}}
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00241\ \ \ \textcolor{comment}{//Initialization}}
\DoxyCodeLine{00242\ \ \ m\_isDeflInitialized\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00243\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ =\ mat.rows();\ }
\DoxyCodeLine{00244\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseVector}}\ r0(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});\ }
\DoxyCodeLine{00245\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ nbIts\ =\ 0;\ }
\DoxyCodeLine{00246\ \ \ m\_H.resize(m\_restart+1,\ m\_restart);}
\DoxyCodeLine{00247\ \ \ m\_Hes.resize(m\_restart,\ m\_restart);}
\DoxyCodeLine{00248\ \ \ m\_V.resize(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},m\_restart+1);}
\DoxyCodeLine{00249\ \ \ \textcolor{comment}{//Initial\ residual\ vector\ and\ initial\ norm}}
\DoxyCodeLine{00250\ \ \ \textcolor{keywordflow}{if}(x.squaredNorm()==0)\ }
\DoxyCodeLine{00251\ \ \ \ \ x\ =\ precond.solve(rhs);}
\DoxyCodeLine{00252\ \ \ r0\ =\ rhs\ -\/\ mat\ *\ x;\ }
\DoxyCodeLine{00253\ \ \ \mbox{\hyperlink{classEigen_1_1DGMRES_a7e47d437b590be8af0e9972e60adbe34}{RealScalar}}\ beta\ =\ r0.norm();\ }
\DoxyCodeLine{00254\ \ \ }
\DoxyCodeLine{00255\ \ \ m\_error\ =\ beta/normRhs;\ }
\DoxyCodeLine{00256\ \ \ \textcolor{keywordflow}{if}(m\_error\ <\ m\_tolerance)}
\DoxyCodeLine{00257\ \ \ \ \ m\_info\ =\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success}};\ }
\DoxyCodeLine{00258\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00259\ \ \ \ \ m\_info\ =\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5eaba1c8763d1179778070f365ecc4157a8}{NoConvergence}};}
\DoxyCodeLine{00260\ \ \ }
\DoxyCodeLine{00261\ \ \ \textcolor{comment}{//\ Iterative\ process}}
\DoxyCodeLine{00262\ \ \ \textcolor{keywordflow}{while}\ (nbIts\ <\ m\_iterations\ \&\&\ m\_info\ ==\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5eaba1c8763d1179778070f365ecc4157a8}{NoConvergence}})}
\DoxyCodeLine{00263\ \ \ \{}
\DoxyCodeLine{00264\ \ \ \ \ dgmresCycle(mat,\ precond,\ x,\ r0,\ beta,\ normRhs,\ nbIts);\ }
\DoxyCodeLine{00265\ \ \ \ \ }
\DoxyCodeLine{00266\ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ new\ residual\ vector\ for\ the\ restart\ }}
\DoxyCodeLine{00267\ \ \ \ \ \textcolor{keywordflow}{if}\ (nbIts\ <\ m\_iterations\ \&\&\ m\_info\ ==\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5eaba1c8763d1179778070f365ecc4157a8}{NoConvergence}})\ \{}
\DoxyCodeLine{00268\ \ \ \ \ \ \ r0\ =\ rhs\ -\/\ mat\ *\ x;}
\DoxyCodeLine{00269\ \ \ \ \ \ \ beta\ =\ r0.norm();}
\DoxyCodeLine{00270\ \ \ \ \ \}}
\DoxyCodeLine{00271\ \ \ \}}
\DoxyCodeLine{00272\ \}\ }
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00284\ \textcolor{keyword}{template}<\ \textcolor{keyword}{typename}\ \_MatrixType,\ \textcolor{keyword}{typename}\ \_Preconditioner>}
\DoxyCodeLine{00285\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Dest>}
\DoxyCodeLine{00286\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_ab77d66ef7f84ff15b6bd55fb76619218}{DGMRES<\_MatrixType,\ \_Preconditioner>::dgmresCycle}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1DGMRES_abebf2c0dc490d410fbf5f24dedc60712}{MatrixType}}\&\ mat,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1DGMRES_acae98b6f30d350a136ed4bc3a270834b}{Preconditioner}}\&\ precond,\ Dest\&\ x,\ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseVector}}\&\ r0,\ \mbox{\hyperlink{classEigen_1_1DGMRES_a7e47d437b590be8af0e9972e60adbe34}{RealScalar}}\&\ beta,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a7e47d437b590be8af0e9972e60adbe34}{RealScalar}}\&\ normRhs,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\&\ nbIts)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00287\ \textcolor{keyword}{}\{}
\DoxyCodeLine{00288\ \ \ \textcolor{comment}{//Initialization\ }}
\DoxyCodeLine{00289\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseVector}}\ g(m\_restart+1);\ \textcolor{comment}{//\ Right\ hand\ side\ of\ the\ least\ square\ problem}}
\DoxyCodeLine{00290\ \ \ g.setZero();\ \ }
\DoxyCodeLine{00291\ \ \ g(0)\ =\ \mbox{\hyperlink{classEigen_1_1DGMRES_aa2172314b09dbddeb3661ca9c809b371}{Scalar}}(beta);\ }
\DoxyCodeLine{00292\ \ \ m\_V.col(0)\ =\ r0/beta;\ }
\DoxyCodeLine{00293\ \ \ m\_info\ =\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5eaba1c8763d1179778070f365ecc4157a8}{NoConvergence}};\ }
\DoxyCodeLine{00294\ \ \ std::vector<JacobiRotation<Scalar>\ >gr(m\_restart);\ \textcolor{comment}{//\ Givens\ rotations}}
\DoxyCodeLine{00295\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ it\ =\ 0;\ \textcolor{comment}{//\ Number\ of\ inner\ iterations\ }}
\DoxyCodeLine{00296\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ =\ mat.rows();}
\DoxyCodeLine{00297\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseVector}}\ tv1(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}),\ tv2(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});\ \ \textcolor{comment}{//Temporary\ vectors}}
\DoxyCodeLine{00298\ \ \ \textcolor{keywordflow}{while}\ (m\_info\ ==\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5eaba1c8763d1179778070f365ecc4157a8}{NoConvergence}}\ \&\&\ it\ <\ m\_restart\ \&\&\ nbIts\ <\ m\_iterations)}
\DoxyCodeLine{00299\ \ \ \{\ \ \ \ }
\DoxyCodeLine{00300\ \ \ \ \ \textcolor{comment}{//\ Apply\ preconditioner(s)\ at\ right}}
\DoxyCodeLine{00301\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_isDeflInitialized\ )}
\DoxyCodeLine{00302\ \ \ \ \ \{}
\DoxyCodeLine{00303\ \ \ \ \ \ \ dgmresApplyDeflation(m\_V.col(it),\ tv1);\ \textcolor{comment}{//\ Deflation}}
\DoxyCodeLine{00304\ \ \ \ \ \ \ tv2\ =\ precond.solve(tv1);\ }
\DoxyCodeLine{00305\ \ \ \ \ \}}
\DoxyCodeLine{00306\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00307\ \ \ \ \ \{}
\DoxyCodeLine{00308\ \ \ \ \ \ \ tv2\ =\ precond.solve(m\_V.col(it));\ \textcolor{comment}{//\ User's\ selected\ preconditioner}}
\DoxyCodeLine{00309\ \ \ \ \ \}}
\DoxyCodeLine{00310\ \ \ \ \ tv1\ =\ mat\ *\ tv2;\ }
\DoxyCodeLine{00311\ \ \ \ }
\DoxyCodeLine{00312\ \ \ \ \ \textcolor{comment}{//\ Orthogonalize\ it\ with\ the\ previous\ basis\ in\ the\ basis\ using\ modified\ Gram-\/Schmidt}}
\DoxyCodeLine{00313\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1DGMRES_aa2172314b09dbddeb3661ca9c809b371}{Scalar}}\ coef;\ }
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ =\ 0;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ <=\ it;\ ++\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})}
\DoxyCodeLine{00315\ \ \ \ \ \{\ }
\DoxyCodeLine{00316\ \ \ \ \ \ \ coef\ =\ tv1.dot(m\_V.col(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}));}
\DoxyCodeLine{00317\ \ \ \ \ \ \ tv1\ =\ tv1\ -\/\ coef\ *\ m\_V.col(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}});\ }
\DoxyCodeLine{00318\ \ \ \ \ \ \ m\_H(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},it)\ =\ coef;\ }
\DoxyCodeLine{00319\ \ \ \ \ \ \ m\_Hes(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},it)\ =\ coef;\ }
\DoxyCodeLine{00320\ \ \ \ \ \}}
\DoxyCodeLine{00321\ \ \ \ \ \textcolor{comment}{//\ Normalize\ the\ vector\ }}
\DoxyCodeLine{00322\ \ \ \ \ coef\ =\ tv1.norm();\ }
\DoxyCodeLine{00323\ \ \ \ \ m\_V.col(it+1)\ =\ tv1/coef;}
\DoxyCodeLine{00324\ \ \ \ \ m\_H(it+1,\ it)\ =\ coef;}
\DoxyCodeLine{00325\ \textcolor{comment}{//\ \ \ \ \ m\_Hes(it+1,it)\ =\ coef;\ }}
\DoxyCodeLine{00326\ \ \ \ \ }
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{comment}{//\ FIXME\ Check\ for\ happy\ breakdown\ }}
\DoxyCodeLine{00328\ \ \ \ \ }
\DoxyCodeLine{00329\ \ \ \ \ \textcolor{comment}{//\ Update\ Hessenberg\ matrix\ with\ Givens\ rotations}}
\DoxyCodeLine{00330\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ =\ 1;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ <=\ it;\ ++\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ }
\DoxyCodeLine{00331\ \ \ \ \ \{}
\DoxyCodeLine{00332\ \ \ \ \ \ \ m\_H.col(it).applyOnTheLeft(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}-\/1,\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},gr[\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}-\/1].adjoint());}
\DoxyCodeLine{00333\ \ \ \ \ \}}
\DoxyCodeLine{00334\ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ new\ plane\ rotation\ }}
\DoxyCodeLine{00335\ \ \ \ \ gr[it].makeGivens(m\_H(it,\ it),\ m\_H(it+1,it));\ }
\DoxyCodeLine{00336\ \ \ \ \ \textcolor{comment}{//\ Apply\ the\ new\ rotation}}
\DoxyCodeLine{00337\ \ \ \ \ m\_H.col(it).applyOnTheLeft(it,it+1,gr[it].adjoint());}
\DoxyCodeLine{00338\ \ \ \ \ g.applyOnTheLeft(it,it+1,\ gr[it].adjoint());\ }
\DoxyCodeLine{00339\ \ \ \ \ }
\DoxyCodeLine{00340\ \ \ \ \ beta\ =\ std::abs(g(it+1));}
\DoxyCodeLine{00341\ \ \ \ \ m\_error\ =\ beta/normRhs;\ }
\DoxyCodeLine{00342\ \ \ \ \ \textcolor{comment}{//\ std::cerr\ <<\ nbIts\ <<\ "{}\ Relative\ Residual\ Norm\ "{}\ <<\ m\_error\ <<\ std::endl;}}
\DoxyCodeLine{00343\ \ \ \ \ it++;\ nbIts++;\ }
\DoxyCodeLine{00344\ \ \ \ \ }
\DoxyCodeLine{00345\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_error\ <\ m\_tolerance)}
\DoxyCodeLine{00346\ \ \ \ \ \{}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ method\ has\ converged}}
\DoxyCodeLine{00348\ \ \ \ \ \ \ m\_info\ =\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success}};}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00350\ \ \ \ \ \}}
\DoxyCodeLine{00351\ \ \ \}}
\DoxyCodeLine{00352\ \ \ }
\DoxyCodeLine{00353\ \ \ \textcolor{comment}{//\ Compute\ the\ new\ coefficients\ by\ solving\ the\ least\ square\ problem}}
\DoxyCodeLine{00354\ \textcolor{comment}{//\ \ \ it++;}}
\DoxyCodeLine{00355\ \ \ \textcolor{comment}{//FIXME\ \ Check\ first\ if\ the\ matrix\ is\ singular\ ...\ zero\ diagonal}}
\DoxyCodeLine{00356\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseVector}}\ nrs(m\_restart);\ }
\DoxyCodeLine{00357\ \ \ nrs\ =\ m\_H.topLeftCorner(it,it).template\ triangularView<Upper>().solve(g.head(it));\ }
\DoxyCodeLine{00358\ \ \ }
\DoxyCodeLine{00359\ \ \ \textcolor{comment}{//\ Form\ the\ new\ solution}}
\DoxyCodeLine{00360\ \ \ \textcolor{keywordflow}{if}\ (m\_isDeflInitialized)}
\DoxyCodeLine{00361\ \ \ \{}
\DoxyCodeLine{00362\ \ \ \ \ tv1\ =\ m\_V.leftCols(it)\ *\ nrs;\ }
\DoxyCodeLine{00363\ \ \ \ \ dgmresApplyDeflation(tv1,\ tv2);\ }
\DoxyCodeLine{00364\ \ \ \ \ x\ =\ x\ +\ precond.solve(tv2);}
\DoxyCodeLine{00365\ \ \ \}}
\DoxyCodeLine{00366\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00367\ \ \ \ \ x\ =\ x\ +\ precond.solve(m\_V.leftCols(it)\ *\ nrs);\ }
\DoxyCodeLine{00368\ \ \ }
\DoxyCodeLine{00369\ \ \ \textcolor{comment}{//\ Go\ for\ a\ new\ cycle\ and\ compute\ data\ for\ deflation}}
\DoxyCodeLine{00370\ \ \ \textcolor{keywordflow}{if}(nbIts\ <\ m\_iterations\ \&\&\ m\_info\ ==\ NoConvergence\ \&\&\ m\_neig\ >\ 0\ \&\&\ (m\_r+m\_neig)\ <\ m\_maxNeig)}
\DoxyCodeLine{00371\ \ \ \ \ dgmresComputeDeflationData(mat,\ precond,\ it,\ m\_neig);\ }
\DoxyCodeLine{00372\ \ \ \textcolor{keywordflow}{return}\ 0;\ }
\DoxyCodeLine{00373\ \ \ }
\DoxyCodeLine{00374\ \}}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ }
\DoxyCodeLine{00377\ \textcolor{keyword}{template}<\ \textcolor{keyword}{typename}\ \_MatrixType,\ \textcolor{keyword}{typename}\ \_Preconditioner>}
\DoxyCodeLine{00378\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a505c49553b8df373734e1a02e1c5ca70}{DGMRES<\_MatrixType,\ \_Preconditioner>::dgmresInitDeflation}}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\&\ rows)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00379\ \textcolor{keyword}{}\{}
\DoxyCodeLine{00380\ \ \ m\_U.resize(rows,\ m\_maxNeig);}
\DoxyCodeLine{00381\ \ \ m\_MU.resize(rows,\ m\_maxNeig);\ }
\DoxyCodeLine{00382\ \ \ m\_T.resize(m\_maxNeig,\ m\_maxNeig);}
\DoxyCodeLine{00383\ \ \ m\_lambdaN\ =\ 0.0;\ }
\DoxyCodeLine{00384\ \ \ m\_isDeflAllocated\ =\ \textcolor{keyword}{true};\ }
\DoxyCodeLine{00385\ \}}
\DoxyCodeLine{00386\ }
\DoxyCodeLine{00387\ \textcolor{keyword}{template}<\ \textcolor{keyword}{typename}\ \_MatrixType,\ \textcolor{keyword}{typename}\ \_Preconditioner>}
\DoxyCodeLine{00388\ \textcolor{keyword}{inline}\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{classEigen_1_1Matrix}{DGMRES<\_MatrixType,\ \_Preconditioner>::ComplexVector}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a92363374b8dbe7832b2b7560362c47e7}{DGMRES<\_MatrixType,\ \_Preconditioner>::schurValues}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1ComplexSchur}{ComplexSchur<DenseMatrix>}}\&\ schurofH)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00389\ \textcolor{keyword}{}\{}
\DoxyCodeLine{00390\ \ \ \textcolor{keywordflow}{return}\ schurofH.\mbox{\hyperlink{classEigen_1_1ComplexSchur_a210b9d7e6c26fdde18aa5720da1d3e3c}{matrixT}}().diagonal();}
\DoxyCodeLine{00391\ \}}
\DoxyCodeLine{00392\ }
\DoxyCodeLine{00393\ \textcolor{keyword}{template}<\ \textcolor{keyword}{typename}\ \_MatrixType,\ \textcolor{keyword}{typename}\ \_Preconditioner>}
\DoxyCodeLine{00394\ \textcolor{keyword}{inline}\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{classEigen_1_1Matrix}{DGMRES<\_MatrixType,\ \_Preconditioner>::ComplexVector}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a92363374b8dbe7832b2b7560362c47e7}{DGMRES<\_MatrixType,\ \_Preconditioner>::schurValues}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1RealSchur}{RealSchur<DenseMatrix>}}\&\ schurofH)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00395\ \textcolor{keyword}{}\{}
\DoxyCodeLine{00396\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseMatrix}}\&\ T\ =\ schurofH.\mbox{\hyperlink{classEigen_1_1RealSchur_a8d900b181760973d894d71e32597e998}{matrixT}}();}
\DoxyCodeLine{00397\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ it\ =\ T.rows();}
\DoxyCodeLine{00398\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{ComplexVector}}\ eig(it);}
\DoxyCodeLine{00399\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ j\ =\ 0;}
\DoxyCodeLine{00400\ \ \ \textcolor{keywordflow}{while}\ (j\ <\ it-\/1)}
\DoxyCodeLine{00401\ \ \ \{}
\DoxyCodeLine{00402\ \ \ \ \ \textcolor{keywordflow}{if}\ (T(j+1,j)\ ==\mbox{\hyperlink{classEigen_1_1DGMRES_aa2172314b09dbddeb3661ca9c809b371}{Scalar}}(0))}
\DoxyCodeLine{00403\ \ \ \ \ \{}
\DoxyCodeLine{00404\ \ \ \ \ \ \ eig(j)\ =\ std::complex<RealScalar>(T(j,j),\mbox{\hyperlink{classEigen_1_1DGMRES_a7e47d437b590be8af0e9972e60adbe34}{RealScalar}}(0));\ }
\DoxyCodeLine{00405\ \ \ \ \ \ \ j++;\ }
\DoxyCodeLine{00406\ \ \ \ \ \}}
\DoxyCodeLine{00407\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00408\ \ \ \ \ \{}
\DoxyCodeLine{00409\ \ \ \ \ \ \ eig(j)\ =\ std::complex<RealScalar>(T(j,j),T(j+1,j));\ }
\DoxyCodeLine{00410\ \ \ \ \ \ \ eig(j+1)\ =\ std::complex<RealScalar>(T(j,j+1),T(j+1,j+1));}
\DoxyCodeLine{00411\ \ \ \ \ \ \ j++;}
\DoxyCodeLine{00412\ \ \ \ \ \}}
\DoxyCodeLine{00413\ \ \ \}}
\DoxyCodeLine{00414\ \ \ \textcolor{keywordflow}{if}\ (j\ <\ it-\/1)\ eig(j)\ =\ std::complex<RealScalar>(T(j,j),\mbox{\hyperlink{classEigen_1_1DGMRES_a7e47d437b590be8af0e9972e60adbe34}{RealScalar}}(0));}
\DoxyCodeLine{00415\ \ \ \textcolor{keywordflow}{return}\ eig;}
\DoxyCodeLine{00416\ \}}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \textcolor{keyword}{template}<\ \textcolor{keyword}{typename}\ \_MatrixType,\ \textcolor{keyword}{typename}\ \_Preconditioner>}
\DoxyCodeLine{00419\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_a7bada6df49a235ad404802bc4e04b598}{DGMRES<\_MatrixType,\ \_Preconditioner>::dgmresComputeDeflationData}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1DGMRES_abebf2c0dc490d410fbf5f24dedc60712}{MatrixType}}\&\ mat,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1DGMRES_acae98b6f30d350a136ed4bc3a270834b}{Preconditioner}}\&\ precond,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\&\ it,\ \mbox{\hyperlink{classEigen_1_1DGMRES_a5e96d9b5ca6098272003550ef87c32d2}{StorageIndex}}\&\ neig)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00420\ \textcolor{keyword}{}\{}
\DoxyCodeLine{00421\ \ \ \textcolor{comment}{//\ First,\ find\ the\ Schur\ form\ of\ the\ Hessenberg\ matrix\ H}}
\DoxyCodeLine{00422\ \ \ \textcolor{keyword}{typename}\ \mbox{\hyperlink{structEigen_1_1internal_1_1conditional}{internal::conditional<NumTraits<Scalar>::IsComplex}},\ \mbox{\hyperlink{classEigen_1_1ComplexSchur}{ComplexSchur<DenseMatrix>}},\ \mbox{\hyperlink{classEigen_1_1RealSchur}{RealSchur<DenseMatrix>}}\ >::type\ schurofH;\ }
\DoxyCodeLine{00423\ \ \ \textcolor{keywordtype}{bool}\ computeU\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00424\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseMatrix}}\ matrixQ(it,it);\ }
\DoxyCodeLine{00425\ \ \ matrixQ.setIdentity();}
\DoxyCodeLine{00426\ \ \ schurofH.computeFromHessenberg(m\_Hes.topLeftCorner(it,it),\ matrixQ,\ computeU);\ }
\DoxyCodeLine{00427\ \ \ }
\DoxyCodeLine{00428\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{ComplexVector}}\ eig(it);}
\DoxyCodeLine{00429\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{Matrix<StorageIndex,Dynamic,1>}}perm(it);}
\DoxyCodeLine{00430\ \ \ eig\ =\ this-\/>schurValues(schurofH);}
\DoxyCodeLine{00431\ \ \ }
\DoxyCodeLine{00432\ \ \ \textcolor{comment}{//\ Reorder\ the\ absolute\ values\ of\ Schur\ values}}
\DoxyCodeLine{00433\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseRealVector}}\ modulEig(it);\ }
\DoxyCodeLine{00434\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ j=0;\ j<it;\ ++j)\ modulEig(j)\ =\ std::abs(eig(j));\ }
\DoxyCodeLine{00435\ \ \ perm.setLinSpaced(it,0,\mbox{\hyperlink{namespaceEigen_1_1internal_a66f17ef65b1821965dcb8ad9a660b064}{internal::convert\_index<StorageIndex>}}(it-\/1));}
\DoxyCodeLine{00436\ \ \ \mbox{\hyperlink{namespaceEigen_1_1internal_afe2a11c61eff70f7f68681a557fa21e7}{internal::sortWithPermutation}}(modulEig,\ perm,\ neig);}
\DoxyCodeLine{00437\ \ \ }
\DoxyCodeLine{00438\ \ \ \textcolor{keywordflow}{if}\ (!m\_lambdaN)}
\DoxyCodeLine{00439\ \ \ \{}
\DoxyCodeLine{00440\ \ \ \ \ m\_lambdaN\ =\ (std::max)(modulEig.maxCoeff(),\ m\_lambdaN);}
\DoxyCodeLine{00441\ \ \ \}}
\DoxyCodeLine{00442\ \ \ \textcolor{comment}{//Count\ the\ real\ number\ of\ extracted\ eigenvalues\ (with\ complex\ conjugates)}}
\DoxyCodeLine{00443\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ nbrEig\ =\ 0;\ }
\DoxyCodeLine{00444\ \ \ \textcolor{keywordflow}{while}\ (nbrEig\ <\ neig)}
\DoxyCodeLine{00445\ \ \ \{}
\DoxyCodeLine{00446\ \ \ \ \ \textcolor{keywordflow}{if}(eig(perm(it-\/nbrEig-\/1)).\mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2CommonCwiseUnaryOps_8h_a8cc3d2f4413a156b2ec6a3097efd3aa4}{imag}}()\ ==\ \mbox{\hyperlink{classEigen_1_1DGMRES_a7e47d437b590be8af0e9972e60adbe34}{RealScalar}}(0))\ nbrEig++;\ }
\DoxyCodeLine{00447\ \ \ \ \ \textcolor{keywordflow}{else}\ nbrEig\ +=\ 2;\ }
\DoxyCodeLine{00448\ \ \ \}}
\DoxyCodeLine{00449\ \ \ \textcolor{comment}{//\ Extract\ the\ \ Schur\ vectors\ corresponding\ to\ the\ smallest\ Ritz\ values}}
\DoxyCodeLine{00450\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseMatrix}}\ Sr(it,\ nbrEig);\ }
\DoxyCodeLine{00451\ \ \ Sr.\mbox{\hyperlink{classEigen_1_1PlainObjectBase_ac21ad5f989f320e46958b75ac8d9a1da}{setZero}}();}
\DoxyCodeLine{00452\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ j\ =\ 0;\ j\ <\ nbrEig;\ j++)}
\DoxyCodeLine{00453\ \ \ \{}
\DoxyCodeLine{00454\ \ \ \ \ Sr.col(j)\ =\ schurofH.matrixU().col(perm(it-\/j-\/1));}
\DoxyCodeLine{00455\ \ \ \}}
\DoxyCodeLine{00456\ \ \ }
\DoxyCodeLine{00457\ \ \ \textcolor{comment}{//\ Form\ the\ Schur\ vectors\ of\ the\ initial\ matrix\ using\ the\ Krylov\ basis}}
\DoxyCodeLine{00458\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseMatrix}}\ \mbox{\hyperlink{abseil-cpp_2absl_2strings_2internal_2str__format_2parser__test_8cc_ad6254e80d17335001dac03b6e8e15a25}{X}};\ }
\DoxyCodeLine{00459\ \ \ \mbox{\hyperlink{abseil-cpp_2absl_2strings_2internal_2str__format_2parser__test_8cc_ad6254e80d17335001dac03b6e8e15a25}{X}}\ =\ m\_V.leftCols(it)\ *\ Sr;}
\DoxyCodeLine{00460\ \ \ \textcolor{keywordflow}{if}\ (m\_r)}
\DoxyCodeLine{00461\ \ \ \{}
\DoxyCodeLine{00462\ \ \ \ \textcolor{comment}{//\ Orthogonalize\ X\ against\ m\_U\ using\ modified\ Gram-\/Schmidt}}
\DoxyCodeLine{00463\ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ j\ =\ 0;\ j\ <\ nbrEig;\ j++)}
\DoxyCodeLine{00464\ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ k\ =0;\ k\ <\ m\_r;\ k++)}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \mbox{\hyperlink{abseil-cpp_2absl_2strings_2internal_2str__format_2parser__test_8cc_ad6254e80d17335001dac03b6e8e15a25}{X}}.col(j)\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2strings_2internal_2str__format_2parser__test_8cc_ad6254e80d17335001dac03b6e8e15a25}{X}}.col(j)\ -\/\ (m\_U.col(k).dot(\mbox{\hyperlink{abseil-cpp_2absl_2strings_2internal_2str__format_2parser__test_8cc_ad6254e80d17335001dac03b6e8e15a25}{X}}.col(j)))*m\_U.col(k);\ }
\DoxyCodeLine{00466\ \ \ \}}
\DoxyCodeLine{00467\ \ \ }
\DoxyCodeLine{00468\ \ \ \textcolor{comment}{//\ Compute\ m\_MX\ =\ A\ *\ M\string^-\/1\ *\ X}}
\DoxyCodeLine{00469\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ m\ =\ m\_V.\mbox{\hyperlink{classEigen_1_1PlainObjectBase_afbc668abdcb3bda3bc4c58c4d88e9603}{rows}}();}
\DoxyCodeLine{00470\ \ \ \textcolor{keywordflow}{if}\ (!m\_isDeflAllocated)\ }
\DoxyCodeLine{00471\ \ \ \ \ dgmresInitDeflation(m);\ }
\DoxyCodeLine{00472\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseMatrix}}\ MX(m,\ nbrEig);}
\DoxyCodeLine{00473\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseVector}}\ tv1(m);}
\DoxyCodeLine{00474\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ j\ =\ 0;\ j\ <\ nbrEig;\ j++)}
\DoxyCodeLine{00475\ \ \ \{}
\DoxyCodeLine{00476\ \ \ \ \ tv1\ =\ mat\ *\ \mbox{\hyperlink{abseil-cpp_2absl_2strings_2internal_2str__format_2parser__test_8cc_ad6254e80d17335001dac03b6e8e15a25}{X}}.col(j);}
\DoxyCodeLine{00477\ \ \ \ \ MX.col(j)\ =\ precond.solve(tv1);}
\DoxyCodeLine{00478\ \ \ \}}
\DoxyCodeLine{00479\ \ \ }
\DoxyCodeLine{00480\ \ \ \textcolor{comment}{//Update\ m\_T\ =\ [U'MU\ U'MX;\ X'MU\ X'MX]}}
\DoxyCodeLine{00481\ \ \ m\_T.block(m\_r,\ m\_r,\ nbrEig,\ nbrEig)\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2strings_2internal_2str__format_2parser__test_8cc_ad6254e80d17335001dac03b6e8e15a25}{X}}.transpose()\ *\ MX;\ }
\DoxyCodeLine{00482\ \ \ \textcolor{keywordflow}{if}(m\_r)}
\DoxyCodeLine{00483\ \ \ \{}
\DoxyCodeLine{00484\ \ \ \ \ m\_T.block(0,\ m\_r,\ m\_r,\ nbrEig)\ =\ m\_U.leftCols(m\_r).transpose()\ *\ MX;\ }
\DoxyCodeLine{00485\ \ \ \ \ m\_T.block(m\_r,\ 0,\ nbrEig,\ m\_r)\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2strings_2internal_2str__format_2parser__test_8cc_ad6254e80d17335001dac03b6e8e15a25}{X}}.transpose()\ *\ m\_MU.leftCols(m\_r);}
\DoxyCodeLine{00486\ \ \ \}}
\DoxyCodeLine{00487\ \ \ }
\DoxyCodeLine{00488\ \ \ \textcolor{comment}{//\ Save\ X\ into\ m\_U\ and\ m\_MX\ in\ m\_MU}}
\DoxyCodeLine{00489\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ j\ =\ 0;\ j\ <\ nbrEig;\ j++)\ m\_U.col(m\_r+j)\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2strings_2internal_2str__format_2parser__test_8cc_ad6254e80d17335001dac03b6e8e15a25}{X}}.col(j);}
\DoxyCodeLine{00490\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ j\ =\ 0;\ j\ <\ nbrEig;\ j++)\ m\_MU.col(m\_r+j)\ =\ MX.col(j);}
\DoxyCodeLine{00491\ \ \ \textcolor{comment}{//\ Increase\ the\ size\ of\ the\ invariant\ subspace}}
\DoxyCodeLine{00492\ \ \ m\_r\ +=\ nbrEig;\ }
\DoxyCodeLine{00493\ \ \ }
\DoxyCodeLine{00494\ \ \ \textcolor{comment}{//\ Factorize\ m\_T\ into\ m\_luT}}
\DoxyCodeLine{00495\ \ \ m\_luT.compute(m\_T.topLeftCorner(m\_r,\ m\_r));}
\DoxyCodeLine{00496\ \ \ }
\DoxyCodeLine{00497\ \ \ \textcolor{comment}{//FIXME\ CHeck\ if\ the\ factorization\ was\ correctly\ done\ (nonsingular\ matrix)}}
\DoxyCodeLine{00498\ \ \ m\_isDeflInitialized\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00499\ \ \ \textcolor{keywordflow}{return}\ 0;\ }
\DoxyCodeLine{00500\ \}}
\DoxyCodeLine{00501\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ \_MatrixType,\ \textcolor{keyword}{typename}\ \_Preconditioner>}
\DoxyCodeLine{00502\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ RhsType,\ \textcolor{keyword}{typename}\ DestType>}
\DoxyCodeLine{00503\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{classEigen_1_1DGMRES_af0cb72e1c8fa37895d1543b1bb09f9d2}{DGMRES<\_MatrixType,\ \_Preconditioner>::dgmresApplyDeflation}}(\textcolor{keyword}{const}\ RhsType\ \&x,\ DestType\ \&y)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00504\ \textcolor{keyword}{}\{}
\DoxyCodeLine{00505\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{DenseVector}}\ x1\ =\ m\_U.leftCols(m\_r).transpose()\ *\ x;\ }
\DoxyCodeLine{00506\ \ \ y\ =\ x\ +\ m\_U.leftCols(m\_r)\ *\ (\ m\_lambdaN\ *\ m\_luT.solve(x1)\ -\/\ x1);}
\DoxyCodeLine{00507\ \ \ \textcolor{keywordflow}{return}\ 0;\ }
\DoxyCodeLine{00508\ \}}
\DoxyCodeLine{00509\ }
\DoxyCodeLine{00510\ \}\ \textcolor{comment}{//\ end\ namespace\ Eigen}}
\DoxyCodeLine{00511\ \textcolor{preprocessor}{\#endif\ }}

\end{DoxyCode}
