\doxysection{gpt2.\+hpp}
\hypertarget{OriginalStuff_2gpt2_8hpp_source}{}\label{OriginalStuff_2gpt2_8hpp_source}\index{OriginalStuff/gpt2.hpp@{OriginalStuff/gpt2.hpp}}
\mbox{\hyperlink{OriginalStuff_2gpt2_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ LLM\_CPP\_\_GPT2\_HPP\_}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ LLM\_CPP\_\_GPT2\_HPP\_}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{OriginalStuff_2abseil-cpp_2absl_2strings_2string__view_8h}{abseil-\/cpp/absl/strings/string\_view.h}}"{}}\ \textcolor{comment}{//"{}absl/strings/string\_view.h"{}\ This\ was\ the\ orginal\ way\ it\ was\ setup\ but\ I\ just\ copied\ the\ folder.\ Would\ like\ to\ find\ the\ file\ needed\ alone}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{OriginalStuff_2gpt_8hpp}{gpt.hpp}}"{}}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{OriginalStuff_2llmc_2utils_8h}{llmc/utils.h}}"{}}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacegpt2}{gpt2}}\ \{}
\DoxyCodeLine{00009\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structgpt2_1_1GPT2Config}{GPT2Config}}\ \{}
\DoxyCodeLine{00010\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structgpt2_1_1GPT2Config_ace3b24aa885b7ef4f8dd1d8f24f1cba0}{max\_seq\_len}};\ \ \ \ \ \ \ \ \textcolor{comment}{//\ max\ sequence\ length,\ e.g.\ 1024}}
\DoxyCodeLine{00011\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structgpt2_1_1GPT2Config_a9aeedf99e76437e8dcc3eda1d16f1d75}{vocab\_size}};\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ vocab\ size,\ e.g.\ 50257}}
\DoxyCodeLine{00012\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structgpt2_1_1GPT2Config_af403209ec3f6f616a6d1ca2e27944edd}{padded\_vocab\_size}};\ \ \textcolor{comment}{//\ padded\ to\ e.g.\ \%128==0,\ 50304}}
\DoxyCodeLine{00013\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structgpt2_1_1GPT2Config_a042b16107579c39b33e368686122daff}{num\_layers}};\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ number\ of\ layers,\ e.g.\ 12}}
\DoxyCodeLine{00014\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structgpt2_1_1GPT2Config_a1894171eaf5129b96af87f2879562157}{num\_heads}};\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ number\ of\ heads\ in\ attention,\ e.g.\ 12}}
\DoxyCodeLine{00015\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structgpt2_1_1GPT2Config_a9955ce74e167897dde1500539600831b}{channels}};\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ number\ of\ channels,\ e.g.\ 768}}
\DoxyCodeLine{00016\ \};}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structgpt2_1_1GPT2}{GPT2}}\ \{}
\DoxyCodeLine{00019\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structgpt2_1_1GPT2_a97aa64291d43e23b82325d4116f7073d}{Type}}\ =\ \mbox{\hyperlink{dev_2cuda_2common_8h_a73bc90d2e378d172e206b528b3756c5a}{floatX}};}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structgpt2_1_1GPT2_a0cc068cf99be6c136943064bf92a4deb}{BuildFromCheckpoint}}(\mbox{\hyperlink{classabsl_1_1string__view}{absl::string\_view}}\ checkpoint\_path)\ \{}
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{comment}{//\ read\ in\ model\ from\ a\ checkpoint\ file}}
\DoxyCodeLine{00023\ \ \ \ \ FILE*\ model\_file\ =\ \mbox{\hyperlink{llmc_2utils_8h_a4d8fc8875786ef36e2c339e79f8b250b}{fopenCheck}}(checkpoint\_path.\mbox{\hyperlink{classabsl_1_1string__view_acdd63d87adecc9cb89e3bb2c4efedf47}{data}}(),\ \textcolor{stringliteral}{"{}rb"{}});}
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{keywordflow}{if}\ (model\_file\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00025\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error\ opening\ model\ file\(\backslash\)n"{}});}
\DoxyCodeLine{00026\ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00027\ \ \ \ \ \}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{keywordtype}{int}\ model\_header[256];}
\DoxyCodeLine{00030\ \ \ \ \ \mbox{\hyperlink{llmc_2utils_8h_aeaeb423fa1a9bddb0cf4c1e0120b09ee}{freadCheck}}(model\_header,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),\ 256,\ model\_file);}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keywordflow}{if}\ (model\_header[0]\ !=\ 20240326)\ \{}
\DoxyCodeLine{00032\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Bad\ magic\ model\ file\(\backslash\)n"{}});}
\DoxyCodeLine{00033\ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00034\ \ \ \ \ \}}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keywordflow}{if}\ (model\_header[1]\ !=\ 3)\ \{}
\DoxyCodeLine{00036\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Bad\ version\ in\ model\ file\(\backslash\)n"{}});}
\DoxyCodeLine{00037\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}-\/-\/-\/>\ HINT:\ try\ to\ re-\/run\ \`{}python\ train\_gpt2.py`\(\backslash\)n"{}});}
\DoxyCodeLine{00038\ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00039\ \ \ \ \ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{comment}{//\ read\ in\ hyperparameters}}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordtype}{int}\ maxT,\ V,\ Vp,\ L,\ NH,\ \mbox{\hyperlink{abseil-cpp_2absl_2hash_2internal_2city__test_8cc_ac54ae397901fe700628cafadea3c5208}{C}};}
\DoxyCodeLine{00043\ \ \ \ \ \mbox{\hyperlink{structgpt2_1_1GPT2_ac31a23335e94f5f6c834060707bf741c}{config}}.\mbox{\hyperlink{structgpt2_1_1GPT2Config_ace3b24aa885b7ef4f8dd1d8f24f1cba0}{max\_seq\_len}}\ =\ maxT\ =\ model\_header[2];}
\DoxyCodeLine{00044\ \ \ \ \ \mbox{\hyperlink{structgpt2_1_1GPT2_ac31a23335e94f5f6c834060707bf741c}{config}}.\mbox{\hyperlink{structgpt2_1_1GPT2Config_a9aeedf99e76437e8dcc3eda1d16f1d75}{vocab\_size}}\ =\ V\ =\ model\_header[3];}
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{structgpt2_1_1GPT2_ac31a23335e94f5f6c834060707bf741c}{config}}.\mbox{\hyperlink{structgpt2_1_1GPT2Config_a042b16107579c39b33e368686122daff}{num\_layers}}\ =\ L\ =\ model\_header[4];}
\DoxyCodeLine{00046\ \ \ \ \ \mbox{\hyperlink{structgpt2_1_1GPT2_ac31a23335e94f5f6c834060707bf741c}{config}}.\mbox{\hyperlink{structgpt2_1_1GPT2Config_a1894171eaf5129b96af87f2879562157}{num\_heads}}\ =\ NH\ =\ model\_header[5];}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{structgpt2_1_1GPT2_ac31a23335e94f5f6c834060707bf741c}{config}}.\mbox{\hyperlink{structgpt2_1_1GPT2Config_a9955ce74e167897dde1500539600831b}{channels}}\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2hash_2internal_2city__test_8cc_ac54ae397901fe700628cafadea3c5208}{C}}\ =\ model\_header[6];}
\DoxyCodeLine{00048\ \ \ \ \ \mbox{\hyperlink{structgpt2_1_1GPT2_ac31a23335e94f5f6c834060707bf741c}{config}}.\mbox{\hyperlink{structgpt2_1_1GPT2Config_af403209ec3f6f616a6d1ca2e27944edd}{padded\_vocab\_size}}\ =\ Vp\ =\ model\_header[7];}
\DoxyCodeLine{00049\ \ \ \ \ printf(\textcolor{stringliteral}{"{}[GPT-\/2]\(\backslash\)n"{}});}
\DoxyCodeLine{00050\ \ \ \ \ printf(\textcolor{stringliteral}{"{}max\_seq\_len:\ \%zu\(\backslash\)n"{}},\ maxT);}
\DoxyCodeLine{00051\ \ \ \ \ printf(\textcolor{stringliteral}{"{}vocab\_size:\ \%zu\(\backslash\)n"{}},\ V);}
\DoxyCodeLine{00052\ \ \ \ \ printf(\textcolor{stringliteral}{"{}padded\_vocab\_size:\ \%zu\(\backslash\)n"{}},\ Vp);}
\DoxyCodeLine{00053\ \ \ \ \ printf(\textcolor{stringliteral}{"{}num\_layers:\ \%zu\(\backslash\)n"{}},\ L);}
\DoxyCodeLine{00054\ \ \ \ \ printf(\textcolor{stringliteral}{"{}num\_heads:\ \%zu\(\backslash\)n"{}},\ NH);}
\DoxyCodeLine{00055\ \ \ \ \ printf(\textcolor{stringliteral}{"{}channels:\ \%zu\(\backslash\)n"{}},\ \mbox{\hyperlink{abseil-cpp_2absl_2hash_2internal_2city__test_8cc_ac54ae397901fe700628cafadea3c5208}{C}});}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}\ =\ std::make\_unique<gpt::GPT>(}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structgpt2_1_1GPT2_ac31a23335e94f5f6c834060707bf741c}{config}}.\mbox{\hyperlink{structgpt2_1_1GPT2Config_ace3b24aa885b7ef4f8dd1d8f24f1cba0}{max\_seq\_len}},\ \mbox{\hyperlink{structgpt2_1_1GPT2_ac31a23335e94f5f6c834060707bf741c}{config}}.\mbox{\hyperlink{structgpt2_1_1GPT2Config_a9aeedf99e76437e8dcc3eda1d16f1d75}{vocab\_size}},\ \mbox{\hyperlink{structgpt2_1_1GPT2_ac31a23335e94f5f6c834060707bf741c}{config}}.\mbox{\hyperlink{structgpt2_1_1GPT2Config_af403209ec3f6f616a6d1ca2e27944edd}{padded\_vocab\_size}},}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structgpt2_1_1GPT2_ac31a23335e94f5f6c834060707bf741c}{config}}.\mbox{\hyperlink{structgpt2_1_1GPT2Config_a042b16107579c39b33e368686122daff}{num\_layers}},\ \mbox{\hyperlink{structgpt2_1_1GPT2_ac31a23335e94f5f6c834060707bf741c}{config}}.\mbox{\hyperlink{structgpt2_1_1GPT2Config_a1894171eaf5129b96af87f2879562157}{num\_heads}},\ \mbox{\hyperlink{structgpt2_1_1GPT2_ac31a23335e94f5f6c834060707bf741c}{config}}.\mbox{\hyperlink{structgpt2_1_1GPT2Config_a9955ce74e167897dde1500539600831b}{channels}});}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{comment}{//\ allocate\ space\ for\ all\ the\ parameters\ and\ read\ them\ in}}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ num\_parameters\ =\ \mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>NumParameters();}
\DoxyCodeLine{00062\ \ \ \ \ printf(\textcolor{stringliteral}{"{}num\_parameters:\ \%zu(\%zu\ MB)\(\backslash\)n"{}},\ num\_parameters,}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ num\_parameters\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{dev_2cuda_2common_8h_a73bc90d2e378d172e206b528b3756c5a}{floatX}})\ /\ 1024\ /\ 1024);}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keyword}{auto}\ restore\_fn\ =\ [\&](\mbox{\hyperlink{structnn_1_1Parameter}{nn::Parameter}}*\ p,\ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{abseil-cpp_2absl_2synchronization_2mutex_8cc_ac8b44a387cf3da062c4a32316b43962c}{name}})\ \{}
\DoxyCodeLine{00066\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_USE\_GPU}}
\DoxyCodeLine{00067\ \ \ \ \ \ \ std::vector<Type>\ cpu\_data(p-\/>size());}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \mbox{\hyperlink{llmc_2utils_8h_aeaeb423fa1a9bddb0cf4c1e0120b09ee}{freadCheck}}(cpu\_data.data(),\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structgpt2_1_1GPT2_a97aa64291d43e23b82325d4116f7073d}{Type}}),\ p-\/>size(),\ model\_file);}
\DoxyCodeLine{00069\ \ \ \ \ \ \ nn::g\_device.memcpyHostToDevice(p-\/>data<\mbox{\hyperlink{structgpt2_1_1GPT2_a97aa64291d43e23b82325d4116f7073d}{Type}}>(),\ cpu\_data.data(),}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structgpt2_1_1GPT2_a97aa64291d43e23b82325d4116f7073d}{Type}})\ *\ p-\/>size());}
\DoxyCodeLine{00071\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \mbox{\hyperlink{llmc_2utils_8h_aeaeb423fa1a9bddb0cf4c1e0120b09ee}{freadCheck}}(p-\/>data<\mbox{\hyperlink{structgpt2_1_1GPT2_a97aa64291d43e23b82325d4116f7073d}{Type}}>(),\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structgpt2_1_1GPT2_a97aa64291d43e23b82325d4116f7073d}{Type}}),\ p-\/>size(),\ model\_file);}
\DoxyCodeLine{00073\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00074\ \ \ \ \ \};}
\DoxyCodeLine{00075\ \ \ \ \ \mbox{\hyperlink{structgpt2_1_1GPT2_a61b73543695c62c95aa37b27ee2ae3f5}{ApplyFn}}(restore\_fn,\ L);}
\DoxyCodeLine{00076\ \ \ \ \ \mbox{\hyperlink{llmc_2utils_8h_ae094d98ede0500b8f5acba043487a5c1}{fcloseCheck}}(model\_file);}
\DoxyCodeLine{00077\ \ \ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structgpt2_1_1GPT2_ac5a2c49fe2a169e4d36026965308a4cc}{Parameters}}(std::vector<nn::Parameter*>*\ parameters)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keyword}{auto}\ collect\_fn\ =\ [\&](\mbox{\hyperlink{structnn_1_1Parameter}{nn::Parameter}}*\ p,\ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{abseil-cpp_2absl_2synchronization_2mutex_8cc_ac8b44a387cf3da062c4a32316b43962c}{name}})\ \{}
\DoxyCodeLine{00081\ \ \ \ \ \ \ parameters-\/>push\_back(p);}
\DoxyCodeLine{00082\ \ \ \ \ \};}
\DoxyCodeLine{00083\ \ \ \ \ \mbox{\hyperlink{structgpt2_1_1GPT2_a61b73543695c62c95aa37b27ee2ae3f5}{ApplyFn}}(collect\_fn,\ \mbox{\hyperlink{structgpt2_1_1GPT2_ac31a23335e94f5f6c834060707bf741c}{config}}.\mbox{\hyperlink{structgpt2_1_1GPT2Config_a042b16107579c39b33e368686122daff}{num\_layers}});}
\DoxyCodeLine{00084\ \ \ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structgpt2_1_1GPT2_ab8a1a3aa306c9f6dcff92f3b736628f3}{Parameters}}(}
\DoxyCodeLine{00087\ \ \ \ \ \ \ std::unordered\_map<std::string,\ nn::Parameter*>*\ parameters)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keyword}{auto}\ collect\_fn\ =\ [\&](\mbox{\hyperlink{structnn_1_1Parameter}{nn::Parameter}}*\ p,\ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{abseil-cpp_2absl_2synchronization_2mutex_8cc_ac8b44a387cf3da062c4a32316b43962c}{name}})\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \ \ parameters-\/>insert(\{\mbox{\hyperlink{abseil-cpp_2absl_2synchronization_2mutex_8cc_ac8b44a387cf3da062c4a32316b43962c}{name}},\ p\});}
\DoxyCodeLine{00090\ \ \ \ \ \};}
\DoxyCodeLine{00091\ \ \ \ \ \mbox{\hyperlink{structgpt2_1_1GPT2_a61b73543695c62c95aa37b27ee2ae3f5}{ApplyFn}}(collect\_fn,\ \mbox{\hyperlink{structgpt2_1_1GPT2_ac31a23335e94f5f6c834060707bf741c}{config}}.\mbox{\hyperlink{structgpt2_1_1GPT2Config_a042b16107579c39b33e368686122daff}{num\_layers}});}
\DoxyCodeLine{00092\ \ \ \}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structgpt2_1_1GPT2_a61b73543695c62c95aa37b27ee2ae3f5}{ApplyFn}}(}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::function<\textcolor{keywordtype}{void}(\mbox{\hyperlink{structnn_1_1Parameter}{nn::Parameter}}*,\ \textcolor{keyword}{const}\ std::string\&)>\&\ apply\_fn,}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ L)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00097\ \ \ \ \ apply\_fn(\mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>wte\_-\/>weight\_.get(),\ \textcolor{stringliteral}{"{}wte"{}});}
\DoxyCodeLine{00098\ \ \ \ \ apply\_fn(\mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>wpe\_-\/>weight\_.get(),\ \textcolor{stringliteral}{"{}wpe"{}});}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keyword}{auto}\ name\_with\_layer\ =\ [](\textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{abseil-cpp_2absl_2synchronization_2mutex_8cc_ac8b44a387cf3da062c4a32316b43962c}{name}},\ \textcolor{keywordtype}{int}\ l)\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{abseil-cpp_2absl_2synchronization_2mutex_8cc_ac8b44a387cf3da062c4a32316b43962c}{name}}\ +\ \textcolor{stringliteral}{"{}-\/L"{}}\ +\ std::to\_string(l);}
\DoxyCodeLine{00102\ \ \ \ \ \};}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{comment}{//\ ln1w}}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}\ =\ \mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>h\_[l];}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \mbox{\hyperlink{structnn_1_1Parameter}{nn::Parameter}}*\ p\ =\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}-\/>ln1\_-\/>weight\_.get();}
\DoxyCodeLine{00108\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}ln1w"{}},\ l));}
\DoxyCodeLine{00109\ \ \ \ \ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{comment}{//\ ln1b}}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}\ =\ \mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>h\_[l];}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \mbox{\hyperlink{structnn_1_1Parameter}{nn::Parameter}}*\ p\ =\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}-\/>ln1\_-\/>bias\_.get();}
\DoxyCodeLine{00115\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}ln1b"{}},\ l));}
\DoxyCodeLine{00116\ \ \ \ \ \}}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{comment}{//\ qkvw}}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}\ =\ \mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>h\_[l];}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \mbox{\hyperlink{structnn_1_1Parameter}{nn::Parameter}}*\ p\ =\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}-\/>attn\_-\/>c\_attn\_-\/>weight\_.get();}
\DoxyCodeLine{00122\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}qkvw"{}},\ l));}
\DoxyCodeLine{00123\ \ \ \ \ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{comment}{//\ qkvb}}
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}\ =\ \mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>h\_[l];}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \mbox{\hyperlink{structnn_1_1Parameter}{nn::Parameter}}*\ p\ =\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}-\/>attn\_-\/>c\_attn\_-\/>bias\_.get();}
\DoxyCodeLine{00129\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}qkvb"{}},\ l));}
\DoxyCodeLine{00130\ \ \ \ \ \}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{comment}{//\ attprojw}}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}\ =\ \mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>h\_[l];}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \mbox{\hyperlink{structnn_1_1Parameter}{nn::Parameter}}*\ p\ =\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}-\/>attn\_-\/>c\_proj\_-\/>weight\_.get();}
\DoxyCodeLine{00136\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}attprojw"{}},\ l));}
\DoxyCodeLine{00137\ \ \ \ \ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{comment}{//\ attprojb}}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}\ =\ \mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>h\_[l];}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \mbox{\hyperlink{structnn_1_1Parameter}{nn::Parameter}}*\ p\ =\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}-\/>attn\_-\/>c\_proj\_-\/>bias\_.get();}
\DoxyCodeLine{00143\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}attprojb"{}},\ l));}
\DoxyCodeLine{00144\ \ \ \ \ \}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{comment}{//\ ln2w}}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}\ =\ \mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>h\_[l];}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \mbox{\hyperlink{structnn_1_1Parameter}{nn::Parameter}}*\ p\ =\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}-\/>ln2\_-\/>weight\_.get();}
\DoxyCodeLine{00150\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}ln2w"{}},\ l));}
\DoxyCodeLine{00151\ \ \ \ \ \}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{comment}{//\ ln2b}}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}\ =\ \mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>h\_[l];}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \mbox{\hyperlink{structnn_1_1Parameter}{nn::Parameter}}*\ p\ =\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}-\/>ln2\_-\/>bias\_.get();}
\DoxyCodeLine{00157\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}ln2b"{}},\ l));}
\DoxyCodeLine{00158\ \ \ \ \ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{comment}{//\ fcw}}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}\ =\ \mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>h\_[l];}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \mbox{\hyperlink{structnn_1_1Parameter}{nn::Parameter}}*\ p\ =\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}-\/>mlp\_-\/>c\_fc\_-\/>weight\_.get();}
\DoxyCodeLine{00164\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}fcw"{}},\ l));}
\DoxyCodeLine{00165\ \ \ \ \ \}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{comment}{//\ fcb}}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}\ =\ \mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>h\_[l];}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \mbox{\hyperlink{structnn_1_1Parameter}{nn::Parameter}}*\ p\ =\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}-\/>mlp\_-\/>c\_fc\_-\/>bias\_.get();}
\DoxyCodeLine{00171\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}fcb"{}},\ l));}
\DoxyCodeLine{00172\ \ \ \ \ \}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{comment}{//\ fcprojw}}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}\ =\ \mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>h\_[l];}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \mbox{\hyperlink{structnn_1_1Parameter}{nn::Parameter}}*\ p\ =\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}-\/>mlp\_-\/>c\_proj\_-\/>weight\_.get();}
\DoxyCodeLine{00178\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}fcprojw"{}},\ l));}
\DoxyCodeLine{00179\ \ \ \ \ \}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{comment}{//\ fcprojb}}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ L;\ ++l)\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}\ =\ \mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>h\_[l];}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \mbox{\hyperlink{structnn_1_1Parameter}{nn::Parameter}}*\ p\ =\ \mbox{\hyperlink{eigen_2Eigen_2src_2plugins_2BlockMethods_8h_ad90ae68615512ea2a9c7056ef1b34f13}{block}}-\/>mlp\_-\/>c\_proj\_-\/>bias\_.get();}
\DoxyCodeLine{00185\ \ \ \ \ \ \ apply\_fn(p,\ name\_with\_layer(\textcolor{stringliteral}{"{}fcprojb"{}},\ l));}
\DoxyCodeLine{00186\ \ \ \ \ \}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{comment}{//\ lnfw}}
\DoxyCodeLine{00189\ \ \ \ \ apply\_fn(\mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>lnf\_-\/>weight\_.get(),\ \textcolor{stringliteral}{"{}lnfw"{}});}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{comment}{//\ lnfb}}
\DoxyCodeLine{00191\ \ \ \ \ apply\_fn(\mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}}-\/>lnf\_-\/>bias\_.get(),\ \textcolor{stringliteral}{"{}lnfb"{}});}
\DoxyCodeLine{00192\ \ \ \}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \mbox{\hyperlink{structgpt2_1_1GPT2Config}{GPT2Config}}\ \mbox{\hyperlink{structgpt2_1_1GPT2_ac31a23335e94f5f6c834060707bf741c}{config}};}
\DoxyCodeLine{00195\ \ \ std::unique\_ptr<gpt::GPT>\ \mbox{\hyperlink{structgpt2_1_1GPT2_a30e5a78fb8de624a23f9ebab1c374fd4}{gpt2\_}};}
\DoxyCodeLine{00196\ \};}
\DoxyCodeLine{00197\ \}\ \ \textcolor{comment}{//\ namespace\ gpt2}}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ LLM\_CPP\_\_GPT2\_HPP\_}}

\end{DoxyCode}
