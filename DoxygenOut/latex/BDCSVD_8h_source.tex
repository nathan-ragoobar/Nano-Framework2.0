\doxysection{BDCSVD.\+h}
\hypertarget{BDCSVD_8h_source}{}\label{BDCSVD_8h_source}\index{eigen/Eigen/src/SVD/BDCSVD.h@{eigen/Eigen/src/SVD/BDCSVD.h}}
\mbox{\hyperlink{BDCSVD_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ This\ file\ is\ part\ of\ Eigen,\ a\ lightweight\ C++\ template\ library}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ for\ linear\ algebra.}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ }}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ We\ used\ the\ "{}A\ Divide-\/And-\/Conquer\ Algorithm\ for\ the\ Bidiagonal\ SVD"{}}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ research\ report\ written\ by\ Ming\ Gu\ and\ Stanley\ C.Eisenstat}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ The\ code\ variable\ names\ correspond\ to\ the\ names\ they\ used\ in\ their\ }}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ report}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ Copyright\ (C)\ 2013\ Gauthier\ Brun\ <brun.gauthier@gmail.com>}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ Copyright\ (C)\ 2013\ Nicolas\ Carre\ <nicolas.carre@ensimag.fr>}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Copyright\ (C)\ 2013\ Jean\ Ceccato\ <jean.ceccato@ensimag.fr>}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ Copyright\ (C)\ 2013\ Pierre\ Zoppitelli\ <pierre.zoppitelli@ensimag.fr>}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ Copyright\ (C)\ 2013\ Jitse\ Niesen\ <jitse@maths.leeds.ac.uk>}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ Copyright\ (C)\ 2014-\/2017\ Gael\ Guennebaud\ <gael.guennebaud@inria.fr>}}
\DoxyCodeLine{00015\ \textcolor{comment}{//}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ Source\ Code\ Form\ is\ subject\ to\ the\ terms\ of\ the\ Mozilla}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ Public\ License\ v.\ 2.0.\ If\ a\ copy\ of\ the\ MPL\ was\ not\ distributed}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ with\ this\ file,\ You\ can\ obtain\ one\ at\ http://mozilla.org/MPL/2.0/.}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#ifndef\ EIGEN\_BDCSVD\_H}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#define\ EIGEN\_BDCSVD\_H}}
\DoxyCodeLine{00022\ \textcolor{comment}{//\ \#define\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00023\ \textcolor{comment}{//\ \#define\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#undef\ eigen\_internal\_assert}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#define\ eigen\_internal\_assert(X)\ assert(X);}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceEigen}{Eigen}}\ \{}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00033\ IOFormat\ bdcsvdfmt(8,\ 0,\ \textcolor{stringliteral}{"{},\ "{}},\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \textcolor{stringliteral}{"{}\ \ ["{}},\ \textcolor{stringliteral}{"{}]"{}});}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00035\ \ \ }
\DoxyCodeLine{00036\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ \_MatrixType>\ \textcolor{keyword}{class\ }BDCSVD;}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceinternal}{internal}}\ \{}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ \_MatrixType>\ }
\DoxyCodeLine{00041\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structEigen_1_1internal_1_1traits}{traits}}<\mbox{\hyperlink{classEigen_1_1BDCSVD}{BDCSVD}}<\_MatrixType>\ >}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{structEigen_1_1internal_1_1traits}{traits}}<\_MatrixType>}
\DoxyCodeLine{00043\ \{}
\DoxyCodeLine{00044\ \ \ \textcolor{keyword}{typedef}\ \_MatrixType\ \mbox{\hyperlink{structEigen_1_1internal_1_1traits_3_01BDCSVD_3_01__MatrixType_01_4_01_4_a271424941144f1b0477b7a9fde020c51}{MatrixType}};}
\DoxyCodeLine{00045\ \};\ \ }
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \}\ \textcolor{comment}{//\ end\ namespace\ internal}}
\DoxyCodeLine{00048\ \ \ }
\DoxyCodeLine{00049\ \ \ }
\DoxyCodeLine{00072\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ \_MatrixType>\ }
\DoxyCodeLine{00073\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classEigen_1_1BDCSVD}{BDCSVD}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classEigen_1_1SVDBase}{SVDBase}}<BDCSVD<\_MatrixType>\ >}
\DoxyCodeLine{00074\ \{}
\DoxyCodeLine{00075\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1SVDBase}{SVDBase<BDCSVD>}}\ \mbox{\hyperlink{classEigen_1_1SVDBase}{Base}};}
\DoxyCodeLine{00076\ \ \ \ \ }
\DoxyCodeLine{00077\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00078\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1SVDBase_ab1a0d1fcc818a876c3cb2b32887604be}{Base::rows}};}
\DoxyCodeLine{00079\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1SVDBase_a083d99e05949bab974bbff2966606b7f}{Base::cols}};}
\DoxyCodeLine{00080\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1SVDBase_a705a7c2709e1624ccc19aa748a78d473}{Base::computeU}};}
\DoxyCodeLine{00081\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1SVDBase_a5f12efcb791eb007d4a4890ac5255ac4}{Base::computeV}};}
\DoxyCodeLine{00082\ \ \ }
\DoxyCodeLine{00083\ \ \ \textcolor{keyword}{typedef}\ \_MatrixType\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a1b28eca73985365c0facc1edcc655cee}{MatrixType}};}
\DoxyCodeLine{00084\ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ MatrixType::Scalar\ \mbox{\hyperlink{classEigen_1_1BDCSVD_ae576be3d1f51f5e38e257dac1bb7bf97}{Scalar}};}
\DoxyCodeLine{00085\ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{structEigen_1_1GenericNumTraits_a6e9ee9306607a1a0b4f79be74dca97bb}{NumTraits<typename\ MatrixType::Scalar>::Real}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a8ae322ae4a50070fbc9dcee8e3ad1d91}{RealScalar}};}
\DoxyCodeLine{00086\ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{structEigen_1_1GenericNumTraits_a7c9d4a813fbf4c107d20bfc74a88da59}{NumTraits<RealScalar>::Literal}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_ab7eab3906206f386f12b7f8c94e643af}{Literal}};}
\DoxyCodeLine{00087\ \ \ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{00088\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD_a44400b85e20c092b35de54411a026f02aa0222fb3be5089e2f7ca67e1e2882954}{RowsAtCompileTime}}\ =\ MatrixType::RowsAtCompileTime,\ }
\DoxyCodeLine{00089\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD_a44400b85e20c092b35de54411a026f02af0a020e5fd77a8f6f2cfb7145c8da295}{ColsAtCompileTime}}\ =\ MatrixType::ColsAtCompileTime,\ }
\DoxyCodeLine{00090\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD_a44400b85e20c092b35de54411a026f02a135cfd5fd712f17e50bdc0efa61cc366}{DiagSizeAtCompileTime}}\ =\ \mbox{\hyperlink{Macros_8h_a2a07ba221d47a7d636fd13678c8c75b3}{EIGEN\_SIZE\_MIN\_PREFER\_DYNAMIC}}(\mbox{\hyperlink{classEigen_1_1BDCSVD_a44400b85e20c092b35de54411a026f02aa0222fb3be5089e2f7ca67e1e2882954}{RowsAtCompileTime}},\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a44400b85e20c092b35de54411a026f02af0a020e5fd77a8f6f2cfb7145c8da295}{ColsAtCompileTime}}),\ }
\DoxyCodeLine{00091\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD_a44400b85e20c092b35de54411a026f02a75ab90cba2fd1bdc327e07d349be1fd9}{MaxRowsAtCompileTime}}\ =\ MatrixType::MaxRowsAtCompileTime,\ }
\DoxyCodeLine{00092\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD_a44400b85e20c092b35de54411a026f02a0d30a3a19367ab871e64a980aea219f0}{MaxColsAtCompileTime}}\ =\ MatrixType::MaxColsAtCompileTime,\ }
\DoxyCodeLine{00093\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD_a44400b85e20c092b35de54411a026f02ab37c73c7ace3196b7a9b799a33492116}{MaxDiagSizeAtCompileTime}}\ =\ \mbox{\hyperlink{Macros_8h_af2d58514e6156c4da2d4af66fafd0b12}{EIGEN\_SIZE\_MIN\_PREFER\_FIXED}}(\mbox{\hyperlink{classEigen_1_1BDCSVD_a44400b85e20c092b35de54411a026f02a75ab90cba2fd1bdc327e07d349be1fd9}{MaxRowsAtCompileTime}},\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a44400b85e20c092b35de54411a026f02a0d30a3a19367ab871e64a980aea219f0}{MaxColsAtCompileTime}}),\ }
\DoxyCodeLine{00094\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD_a44400b85e20c092b35de54411a026f02aaac5b9fa1cd1464ae3ec6ffa7b86a95d}{MatrixOptions}}\ =\ MatrixType::Options}
\DoxyCodeLine{00095\ \ \ \};}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{classEigen_1_1Matrix}{Base::MatrixUType}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a37c1d9a4ce64c4d76b0a61e55d1947dd}{MatrixUType}};}
\DoxyCodeLine{00098\ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{classEigen_1_1Matrix}{Base::MatrixVType}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a05fe0c976f6b85b82a75902b02f2613a}{MatrixVType}};}
\DoxyCodeLine{00099\ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{classEigen_1_1internal_1_1TensorLazyEvaluatorWritable}{Base::SingularValuesType}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_aa1436a0db87d8da574a219be2a73c5ba}{SingularValuesType}};}
\DoxyCodeLine{00100\ \ \ }
\DoxyCodeLine{00101\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1Matrix}{Matrix<Scalar,\ Dynamic,\ Dynamic,\ ColMajor>}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a1a823ac550e2e1a996b383b799da7b97}{MatrixX}};}
\DoxyCodeLine{00102\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1Matrix}{Matrix<RealScalar,\ Dynamic,\ Dynamic,\ ColMajor>}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_af45905f717efda742faf4922bade2342}{MatrixXr}};}
\DoxyCodeLine{00103\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1Matrix}{Matrix<RealScalar,\ Dynamic,\ 1>}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_ae67a8cc131dc38aa4c5f9ce2766f1411}{VectorType}};}
\DoxyCodeLine{00104\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1Array}{Array<RealScalar,\ Dynamic,\ 1>}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a9c5397fdb8cc987e99297762d1db978c}{ArrayXr}};}
\DoxyCodeLine{00105\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1Array}{Array<Index,1,Dynamic>}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a38d6e3bc6f97b2acefed7ffe75e3a74d}{ArrayXi}};}
\DoxyCodeLine{00106\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1Ref}{Ref<ArrayXr>}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}};}
\DoxyCodeLine{00107\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classEigen_1_1Ref}{Ref<ArrayXi>}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a4b5912a577f7d8dc771a1e1e4296b4d8}{IndicesRef}};}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00114\ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD_a39514816d38f9c418cf3f3514b511c2c}{BDCSVD}}()\ :\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a1e07b25c4a606cee8f34cdc75189a3b8}{m\_algoswap}}(16),\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a01ac6b6ddf81569780bf6449e8484a6c}{m\_isTranspose}}(false),\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a63dc95af59e08a68b11268e98feea7fa}{m\_compU}}(false),\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a707ea2d37a7024a6317f001a6971fbec}{m\_compV}}(false),\ \mbox{\hyperlink{classEigen_1_1BDCSVD_ade7ebb87b1735432218681831b1801cc}{m\_numIters}}(0)}
\DoxyCodeLine{00115\ \ \ \{\}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00124\ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD_a3e1fa48b3d042b7daf7392724a68bb60}{BDCSVD}}(\mbox{\hyperlink{classEigen_1_1SVDBase_aec692104f937d70a5252b3e5350bfb78}{Index}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_ab1a0d1fcc818a876c3cb2b32887604be}{rows}},\ \mbox{\hyperlink{classEigen_1_1SVDBase_aec692104f937d70a5252b3e5350bfb78}{Index}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a083d99e05949bab974bbff2966606b7f}{cols}},\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ computationOptions\ =\ 0)}
\DoxyCodeLine{00125\ \ \ \ \ :\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a1e07b25c4a606cee8f34cdc75189a3b8}{m\_algoswap}}(16),\ \mbox{\hyperlink{classEigen_1_1BDCSVD_ade7ebb87b1735432218681831b1801cc}{m\_numIters}}(0)}
\DoxyCodeLine{00126\ \ \ \{}
\DoxyCodeLine{00127\ \ \ \ \ allocate(\mbox{\hyperlink{classEigen_1_1BDCSVD_ab1a0d1fcc818a876c3cb2b32887604be}{rows}},\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a083d99e05949bab974bbff2966606b7f}{cols}},\ computationOptions);}
\DoxyCodeLine{00128\ \ \ \}}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00140\ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD_a302746d9c534cd513c1df87c7ae4850d}{BDCSVD}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a1b28eca73985365c0facc1edcc655cee}{MatrixType}}\&\ matrix,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ computationOptions\ =\ 0)}
\DoxyCodeLine{00141\ \ \ \ \ :\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a1e07b25c4a606cee8f34cdc75189a3b8}{m\_algoswap}}(16),\ \mbox{\hyperlink{classEigen_1_1BDCSVD_ade7ebb87b1735432218681831b1801cc}{m\_numIters}}(0)}
\DoxyCodeLine{00142\ \ \ \{}
\DoxyCodeLine{00143\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD_a52e3c627775010775c64d16a00cdb770}{compute}}(matrix,\ computationOptions);}
\DoxyCodeLine{00144\ \ \ \}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD_abdf2b178ad413766bc1b292fcef701e2}{\string~BDCSVD}}()\ }
\DoxyCodeLine{00147\ \ \ \{}
\DoxyCodeLine{00148\ \ \ \}}
\DoxyCodeLine{00149\ \ \ }
\DoxyCodeLine{00160\ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD}{BDCSVD}}\&\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a52e3c627775010775c64d16a00cdb770}{compute}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a1b28eca73985365c0facc1edcc655cee}{MatrixType}}\&\ matrix,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ computationOptions);}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00168\ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD}{BDCSVD}}\&\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a61880a5f6dbf7a14f91be80eaa3a22bc}{compute}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a1b28eca73985365c0facc1edcc655cee}{MatrixType}}\&\ matrix)}
\DoxyCodeLine{00169\ \ \ \{}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a52e3c627775010775c64d16a00cdb770}{compute}}(matrix,\ this-\/>\mbox{\hyperlink{classEigen_1_1SVDBase_a680646d2f3fa0de030cbf9b4815d6cda}{m\_computationOptions}});}
\DoxyCodeLine{00171\ \ \ \}}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_aa21c0cc5e99c861970bae45d94cae9ad}{setSwitchSize}}(\textcolor{keywordtype}{int}\ s)\ }
\DoxyCodeLine{00174\ \ \ \{}
\DoxyCodeLine{00175\ \ \ \ \ \mbox{\hyperlink{Macros_8h_acaa7ba89800cfe18d5fd6eed620aea9c}{eigen\_assert}}(s>3\ \&\&\ \textcolor{stringliteral}{"{}BDCSVD\ the\ size\ of\ the\ algo\ switch\ has\ to\ be\ greater\ than\ 3"{}});}
\DoxyCodeLine{00176\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD_a1e07b25c4a606cee8f34cdc75189a3b8}{m\_algoswap}}\ =\ s;}
\DoxyCodeLine{00177\ \ \ \}}
\DoxyCodeLine{00178\ \ }
\DoxyCodeLine{00179\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00180\ \ \ \textcolor{keywordtype}{void}\ allocate(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_ab1a0d1fcc818a876c3cb2b32887604be}{rows}},\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a083d99e05949bab974bbff2966606b7f}{cols}},\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ computationOptions);}
\DoxyCodeLine{00181\ \ \ \textcolor{keywordtype}{void}\ divide(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ firstCol,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ lastCol,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ firstRowW,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ firstColW,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ shift);}
\DoxyCodeLine{00182\ \ \ \textcolor{keywordtype}{void}\ computeSVDofM(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ firstCol,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{classEigen_1_1BDCSVD_af45905f717efda742faf4922bade2342}{MatrixXr}}\&\ U,\ \mbox{\hyperlink{classEigen_1_1BDCSVD_ae67a8cc131dc38aa4c5f9ce2766f1411}{VectorType}}\&\ singVals,\ \mbox{\hyperlink{classEigen_1_1BDCSVD_af45905f717efda742faf4922bade2342}{MatrixXr}}\&\ V);}
\DoxyCodeLine{00183\ \ \ \textcolor{keywordtype}{void}\ computeSingVals(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}}\&\ col0,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}}\&\ diag,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a4b5912a577f7d8dc771a1e1e4296b4d8}{IndicesRef}}\&\ perm,\ \mbox{\hyperlink{classEigen_1_1BDCSVD_ae67a8cc131dc38aa4c5f9ce2766f1411}{VectorType}}\&\ singVals,\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}}\ shifts,\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}}\ mus);}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordtype}{void}\ perturbCol0(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}}\&\ col0,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}}\&\ diag,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a4b5912a577f7d8dc771a1e1e4296b4d8}{IndicesRef}}\&\ perm,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_ae67a8cc131dc38aa4c5f9ce2766f1411}{VectorType}}\&\ singVals,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}}\&\ shifts,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}}\&\ mus,\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}}\ zhat);}
\DoxyCodeLine{00185\ \ \ \textcolor{keywordtype}{void}\ computeSingVecs(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}}\&\ zhat,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}}\&\ diag,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a4b5912a577f7d8dc771a1e1e4296b4d8}{IndicesRef}}\&\ perm,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_ae67a8cc131dc38aa4c5f9ce2766f1411}{VectorType}}\&\ singVals,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}}\&\ shifts,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}}\&\ mus,\ \mbox{\hyperlink{classEigen_1_1BDCSVD_af45905f717efda742faf4922bade2342}{MatrixXr}}\&\ U,\ \mbox{\hyperlink{classEigen_1_1BDCSVD_af45905f717efda742faf4922bade2342}{MatrixXr}}\&\ V);}
\DoxyCodeLine{00186\ \ \ \textcolor{keywordtype}{void}\ deflation43(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ firstCol,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ shift,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{structEigen_1_1EigenBase_a9f40726259520d7e9c5ce58d19d62e79}{size}});}
\DoxyCodeLine{00187\ \ \ \textcolor{keywordtype}{void}\ deflation44(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ firstColu\ ,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ firstColm,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ firstRowW,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ firstColW,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ j,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{structEigen_1_1EigenBase_a9f40726259520d7e9c5ce58d19d62e79}{size}});}
\DoxyCodeLine{00188\ \ \ \textcolor{keywordtype}{void}\ deflation(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ firstCol,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ lastCol,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ k,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ firstRowW,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ firstColW,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ shift);}
\DoxyCodeLine{00189\ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ HouseholderU,\ \textcolor{keyword}{typename}\ HouseholderV,\ \textcolor{keyword}{typename}\ NaiveU,\ \textcolor{keyword}{typename}\ NaiveV>}
\DoxyCodeLine{00190\ \ \ \textcolor{keywordtype}{void}\ copyUV(\textcolor{keyword}{const}\ HouseholderU\ \&householderU,\ \textcolor{keyword}{const}\ HouseholderV\ \&householderV,\ \textcolor{keyword}{const}\ NaiveU\ \&naiveU,\ \textcolor{keyword}{const}\ NaiveV\ \&naivev);}
\DoxyCodeLine{00191\ \ \ \textcolor{keywordtype}{void}\ structured\_update(\mbox{\hyperlink{classEigen_1_1Block}{Block<MatrixXr,Dynamic,Dynamic>}}\ A,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_af45905f717efda742faf4922bade2342}{MatrixXr}}\ \&B,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ n1);}
\DoxyCodeLine{00192\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a8ae322ae4a50070fbc9dcee8e3ad1d91}{RealScalar}}\ secularEq(\mbox{\hyperlink{classEigen_1_1BDCSVD_a8ae322ae4a50070fbc9dcee8e3ad1d91}{RealScalar}}\ x,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}}\&\ col0,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}}\&\ diag,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a4b5912a577f7d8dc771a1e1e4296b4d8}{IndicesRef}}\ \&perm,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a50553867e0c0cf906cf6e72903c91f09}{ArrayRef}}\&\ diagShifted,\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a8ae322ae4a50070fbc9dcee8e3ad1d91}{RealScalar}}\ shift);}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00195\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{MatrixXr}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a857bb0e5f633e0600ea6861f14da8a1b}{m\_naiveU}},\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a94b71ee8ecf0b6b621a1267cf136adc9}{m\_naiveV}};}
\DoxyCodeLine{00196\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{MatrixXr}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a76dcaed5bc2dd1c37832805fa8fed943}{m\_computed}};}
\DoxyCodeLine{00197\ \ \ \mbox{\hyperlink{classEigen_1_1SVDBase_aec692104f937d70a5252b3e5350bfb78}{Index}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a43bb7c5a142ebde4c38967c5c3d42910}{m\_nRec}};}
\DoxyCodeLine{00198\ \ \ \mbox{\hyperlink{classEigen_1_1Array}{ArrayXr}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_ad62998546febd86ba715a9eae4c47b4b}{m\_workspace}};}
\DoxyCodeLine{00199\ \ \ \mbox{\hyperlink{classEigen_1_1Array}{ArrayXi}}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a8bfc4be4bdc669038298ea29b940532f}{m\_workspaceI}};}
\DoxyCodeLine{00200\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a1e07b25c4a606cee8f34cdc75189a3b8}{m\_algoswap}};}
\DoxyCodeLine{00201\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a01ac6b6ddf81569780bf6449e8484a6c}{m\_isTranspose}},\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a63dc95af59e08a68b11268e98feea7fa}{m\_compU}},\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a707ea2d37a7024a6317f001a6971fbec}{m\_compV}};}
\DoxyCodeLine{00202\ \ \ }
\DoxyCodeLine{00203\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1SVDBase_ab71e31e61c33f68ff2f499ed9f30e718}{Base::m\_singularValues}};}
\DoxyCodeLine{00204\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1SVDBase_a6eca3829eb56684ca01c291c6630c8d8}{Base::m\_diagSize}};}
\DoxyCodeLine{00205\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1SVDBase_ad6f49fd8f826a41109f8eb68e2f48dc4}{Base::m\_computeFullU}};}
\DoxyCodeLine{00206\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1SVDBase_a1eec8ead08bc9cd1729ba9ba7beb6b41}{Base::m\_computeFullV}};}
\DoxyCodeLine{00207\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1SVDBase_a47b67c55d69ba645bb7ae32bb5466138}{Base::m\_computeThinU}};}
\DoxyCodeLine{00208\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1SVDBase_ac8321ff2cbf3b82f5c2638b9de6661af}{Base::m\_computeThinV}};}
\DoxyCodeLine{00209\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1SVDBase_af0e0b3833c1d49286c0fdcbc023c3bd8}{Base::m\_matrixU}};}
\DoxyCodeLine{00210\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1SVDBase_a69cf1cfb527ff5562156c13bdca45ca5}{Base::m\_matrixV}};}
\DoxyCodeLine{00211\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1SVDBase_a447d2789c6fda585482933f9f0cd02af}{Base::m\_info}};}
\DoxyCodeLine{00212\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1SVDBase_a633b92f4eb9c65911b943b93bb8b341c}{Base::m\_isInitialized}};}
\DoxyCodeLine{00213\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEigen_1_1SVDBase_aa41b395662650f2e10652f76365877c4}{Base::m\_nonzeroSingularValues}};}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \textcolor{keyword}{public}:\ \ }
\DoxyCodeLine{00216\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_ade7ebb87b1735432218681831b1801cc}{m\_numIters}};}
\DoxyCodeLine{00217\ \};\ \textcolor{comment}{//end\ class\ BDCSVD}}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \textcolor{comment}{//\ Method\ to\ allocate\ and\ initialize\ matrix\ and\ attributes}}
\DoxyCodeLine{00221\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00222\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1BDCSVD}{BDCSVD<MatrixType>::allocate}}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ rows,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ cols,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ computationOptions)}
\DoxyCodeLine{00223\ \{}
\DoxyCodeLine{00224\ \ \ m\_isTranspose\ =\ (cols\ >\ rows);}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \textcolor{keywordflow}{if}\ (Base::allocate(rows,\ cols,\ computationOptions))}
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00228\ \ \ }
\DoxyCodeLine{00229\ \ \ m\_computed\ =\ MatrixXr::Zero(m\_diagSize\ +\ 1,\ m\_diagSize\ );}
\DoxyCodeLine{00230\ \ \ m\_compU\ =\ computeV();}
\DoxyCodeLine{00231\ \ \ m\_compV\ =\ computeU();}
\DoxyCodeLine{00232\ \ \ \textcolor{keywordflow}{if}\ (m\_isTranspose)}
\DoxyCodeLine{00233\ \ \ \ \ std::swap(m\_compU,\ m\_compV);}
\DoxyCodeLine{00234\ \ \ }
\DoxyCodeLine{00235\ \ \ \textcolor{keywordflow}{if}\ (m\_compU)\ m\_naiveU\ =\ MatrixXr::Zero(m\_diagSize\ +\ 1,\ m\_diagSize\ +\ 1\ );}
\DoxyCodeLine{00236\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ m\_naiveU\ =\ MatrixXr::Zero(2,\ m\_diagSize\ +\ 1\ );}
\DoxyCodeLine{00237\ \ \ }
\DoxyCodeLine{00238\ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ m\_naiveV\ =\ MatrixXr::Zero(m\_diagSize,\ m\_diagSize);}
\DoxyCodeLine{00239\ \ \ }
\DoxyCodeLine{00240\ \ \ m\_workspace.resize((m\_diagSize+1)*(m\_diagSize+1)*3);}
\DoxyCodeLine{00241\ \ \ m\_workspaceI.resize(3*m\_diagSize);}
\DoxyCodeLine{00242\ \}\textcolor{comment}{//\ end\ allocate}}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00244\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00245\ \mbox{\hyperlink{classEigen_1_1BDCSVD}{BDCSVD<MatrixType>}}\&\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a52e3c627775010775c64d16a00cdb770}{BDCSVD<MatrixType>::compute}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a1b28eca73985365c0facc1edcc655cee}{MatrixType}}\&\ matrix,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ computationOptions)\ }
\DoxyCodeLine{00246\ \{}
\DoxyCodeLine{00247\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00248\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n\(\backslash\)n======================================================================================================================\(\backslash\)n\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00249\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00250\ \ \ allocate(matrix.rows(),\ matrix.cols(),\ computationOptions);}
\DoxyCodeLine{00251\ \ \ \textcolor{keyword}{using\ }std::abs;}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a8ae322ae4a50070fbc9dcee8e3ad1d91}{RealScalar}}\ considerZero\ =\ (std::numeric\_limits<RealScalar>::min)();}
\DoxyCodeLine{00254\ \ \ }
\DoxyCodeLine{00255\ \ \ \textcolor{comment}{//****\ step\ -\/1\ -\/\ If\ the\ problem\ is\ too\ small,\ directly\ falls\ back\ to\ JacobiSVD\ and\ return}}
\DoxyCodeLine{00256\ \ \ \textcolor{keywordflow}{if}(matrix.cols()\ <\ m\_algoswap)}
\DoxyCodeLine{00257\ \ \ \{}
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{comment}{//\ FIXME\ this\ line\ involves\ temporaries}}
\DoxyCodeLine{00259\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1JacobiSVD}{JacobiSVD<MatrixType>}}\ jsvd(matrix,computationOptions);}
\DoxyCodeLine{00260\ \ \ \ \ m\_isInitialized\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00261\ \ \ \ \ m\_info\ =\ jsvd.\mbox{\hyperlink{classEigen_1_1SVDBase_a569913a15fa2f327121f155682368602}{info}}();}
\DoxyCodeLine{00262\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_info\ ==\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea671a2aeb0f527802806a441d58a80fcf}{Success}}\ ||\ m\_info\ ==\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea6a68dfb88a8336108a30588bdf356c57}{NoConvergence}})\ \{}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(computeU())\ m\_matrixU\ =\ jsvd.\mbox{\hyperlink{classEigen_1_1SVDBase_accbc8e3f9baab3a57a6eba8e4cc3ea27}{matrixU}}();}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(computeV())\ m\_matrixV\ =\ jsvd.\mbox{\hyperlink{classEigen_1_1SVDBase_af09f06357d7d7442f7ca7343713756fe}{matrixV}}();}
\DoxyCodeLine{00265\ \ \ \ \ \ \ m\_singularValues\ =\ jsvd.\mbox{\hyperlink{classEigen_1_1SVDBase_ac44c307a70731003003faf3a9bdf14f6}{singularValues}}();}
\DoxyCodeLine{00266\ \ \ \ \ \ \ m\_nonzeroSingularValues\ =\ jsvd.\mbox{\hyperlink{classEigen_1_1SVDBase_afe8a555f38393a319a71ec0f0331c9ef}{nonzeroSingularValues}}();}
\DoxyCodeLine{00267\ \ \ \ \ \}}
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00269\ \ \ \}}
\DoxyCodeLine{00270\ \ \ }
\DoxyCodeLine{00271\ \ \ \textcolor{comment}{//****\ step\ 0\ -\/\ Copy\ the\ input\ matrix\ and\ apply\ scaling\ to\ reduce\ over/under-\/flows}}
\DoxyCodeLine{00272\ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD_a8ae322ae4a50070fbc9dcee8e3ad1d91}{RealScalar}}\ scale\ =\ matrix.cwiseAbs().template\ maxCoeff<PropagateNaN>();}
\DoxyCodeLine{00273\ \ \ \textcolor{keywordflow}{if}\ (!(\mbox{\hyperlink{namespaceEigen_1_1numext_a2453ca8f9a4be71354074d0f9bf734c8}{numext::isfinite}})(scale))\ \{}
\DoxyCodeLine{00274\ \ \ \ \ m\_isInitialized\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00275\ \ \ \ \ m\_info\ =\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea580b2a3cafe585691e789f768fb729bf}{InvalidInput}};}
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00277\ \ \ \}}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \ \ \textcolor{keywordflow}{if}(scale==\mbox{\hyperlink{classEigen_1_1BDCSVD_ab7eab3906206f386f12b7f8c94e643af}{Literal}}(0))\ scale\ =\ \mbox{\hyperlink{classEigen_1_1BDCSVD_ab7eab3906206f386f12b7f8c94e643af}{Literal}}(1);}
\DoxyCodeLine{00280\ \ \ \mbox{\hyperlink{classEigen_1_1Matrix}{MatrixX}}\ copy;}
\DoxyCodeLine{00281\ \ \ \textcolor{keywordflow}{if}\ (m\_isTranspose)\ copy\ =\ matrix.adjoint()/scale;}
\DoxyCodeLine{00282\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ copy\ =\ matrix/scale;}
\DoxyCodeLine{00283\ \ \ }
\DoxyCodeLine{00284\ \ \ \textcolor{comment}{//****\ step\ 1\ -\/\ Bidiagonalization}}
\DoxyCodeLine{00285\ \ \ \textcolor{comment}{//\ FIXME\ this\ line\ involves\ temporaries}}
\DoxyCodeLine{00286\ \ \ \mbox{\hyperlink{classEigen_1_1internal_1_1UpperBidiagonalization}{internal::UpperBidiagonalization<MatrixX>}}\ bid(copy);}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ \textcolor{comment}{//****\ step\ 2\ -\/\ Divide\ \&\ Conquer}}
\DoxyCodeLine{00289\ \ \ m\_naiveU.setZero();}
\DoxyCodeLine{00290\ \ \ m\_naiveV.setZero();}
\DoxyCodeLine{00291\ \ \ \textcolor{comment}{//\ FIXME\ this\ line\ involves\ a\ temporary\ matrix}}
\DoxyCodeLine{00292\ \ \ m\_computed.topRows(m\_diagSize)\ =\ bid.\mbox{\hyperlink{classEigen_1_1internal_1_1UpperBidiagonalization_ad02b11d2cc0e7510ede8fd992e082a08}{bidiagonal}}().\mbox{\hyperlink{classEigen_1_1internal_1_1BandMatrixBase_aacfa0b85201b8503376a9998987f81f7}{toDenseMatrix}}().transpose();}
\DoxyCodeLine{00293\ \ \ m\_computed.template\ \mbox{\hyperlink{BlockMethods_8h_a6b43c0285be531157456c197c213f624}{bottomRows<1>}}().\mbox{\hyperlink{classEigen_1_1PlainObjectBase_ac21ad5f989f320e46958b75ac8d9a1da}{setZero}}();}
\DoxyCodeLine{00294\ \ \ divide(0,\ m\_diagSize\ -\/\ 1,\ 0,\ 0,\ 0);}
\DoxyCodeLine{00295\ \ \ \textcolor{keywordflow}{if}\ (m\_info\ !=\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea671a2aeb0f527802806a441d58a80fcf}{Success}}\ \&\&\ m\_info\ !=\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea6a68dfb88a8336108a30588bdf356c57}{NoConvergence}})\ \{}
\DoxyCodeLine{00296\ \ \ \ \ m\_isInitialized\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00297\ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00298\ \ \ \}}
\DoxyCodeLine{00299\ \ \ \ \ }
\DoxyCodeLine{00300\ \ \ \textcolor{comment}{//****\ step\ 3\ -\/\ Copy\ singular\ values\ and\ vectors}}
\DoxyCodeLine{00301\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}=0;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}<m\_diagSize;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}++)}
\DoxyCodeLine{00302\ \ \ \{}
\DoxyCodeLine{00303\ \ \ \ \ \mbox{\hyperlink{classEigen_1_1BDCSVD_a8ae322ae4a50070fbc9dcee8e3ad1d91}{RealScalar}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2common__policy__traits__test_8cc_aa4c2a5552e9bc49b1816ff532f558c74}{a}}\ =\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(m\_computed.coeff(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}));}
\DoxyCodeLine{00304\ \ \ \ \ m\_singularValues.coeffRef(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2common__policy__traits__test_8cc_aa4c2a5552e9bc49b1816ff532f558c74}{a}}\ *\ scale;}
\DoxyCodeLine{00305\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2common__policy__traits__test_8cc_aa4c2a5552e9bc49b1816ff532f558c74}{a}}<considerZero)}
\DoxyCodeLine{00306\ \ \ \ \ \{}
\DoxyCodeLine{00307\ \ \ \ \ \ \ m\_nonzeroSingularValues\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}};}
\DoxyCodeLine{00308\ \ \ \ \ \ \ m\_singularValues.tail(m\_diagSize\ -\/\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ -\/\ 1).setZero();}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00310\ \ \ \ \ \}}
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ ==\ m\_diagSize\ -\/\ 1)}
\DoxyCodeLine{00312\ \ \ \ \ \{}
\DoxyCodeLine{00313\ \ \ \ \ \ \ m\_nonzeroSingularValues\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ +\ 1;}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00315\ \ \ \ \ \}}
\DoxyCodeLine{00316\ \ \ \}}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00318\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00319\ \textcolor{comment}{//\ \ \ std::cout\ <<\ "{}m\_naiveU\(\backslash\)n"{}\ <<\ m\_naiveU\ <<\ "{}\(\backslash\)n\(\backslash\)n"{};}}
\DoxyCodeLine{00320\ \textcolor{comment}{//\ \ \ std::cout\ <<\ "{}m\_naiveV\(\backslash\)n"{}\ <<\ m\_naiveV\ <<\ "{}\(\backslash\)n\(\backslash\)n"{};}}
\DoxyCodeLine{00321\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00322\ \ \ \textcolor{keywordflow}{if}(m\_isTranspose)\ copyUV(bid.\mbox{\hyperlink{classEigen_1_1internal_1_1UpperBidiagonalization_a6ab970ae51909e56ceb63a49e06fdc98}{householderV}}(),\ bid.\mbox{\hyperlink{classEigen_1_1internal_1_1UpperBidiagonalization_a39887f7712de5be5a0487e9f6357b9da}{householderU}}(),\ m\_naiveV,\ m\_naiveU);}
\DoxyCodeLine{00323\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ copyUV(bid.\mbox{\hyperlink{classEigen_1_1internal_1_1UpperBidiagonalization_a39887f7712de5be5a0487e9f6357b9da}{householderU}}(),\ bid.\mbox{\hyperlink{classEigen_1_1internal_1_1UpperBidiagonalization_a6ab970ae51909e56ceb63a49e06fdc98}{householderV}}(),\ m\_naiveU,\ m\_naiveV);}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ \ \ m\_isInitialized\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00326\ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00327\ \}\textcolor{comment}{//\ end\ compute}}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00330\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00331\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ HouseholderU,\ \textcolor{keyword}{typename}\ HouseholderV,\ \textcolor{keyword}{typename}\ NaiveU,\ \textcolor{keyword}{typename}\ NaiveV>}
\DoxyCodeLine{00332\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEigen_1_1BDCSVD}{BDCSVD<MatrixType>::copyUV}}(\textcolor{keyword}{const}\ HouseholderU\ \&householderU,\ \textcolor{keyword}{const}\ HouseholderV\ \&householderV,\ \textcolor{keyword}{const}\ NaiveU\ \&naiveU,\ \textcolor{keyword}{const}\ NaiveV\ \&naiveV)}
\DoxyCodeLine{00333\ \{}
\DoxyCodeLine{00334\ \ \ \textcolor{comment}{//\ Note\ exchange\ of\ U\ and\ V:\ m\_matrixU\ is\ set\ from\ m\_naiveV\ and\ vice\ versa}}
\DoxyCodeLine{00335\ \ \ \textcolor{keywordflow}{if}\ (computeU())}
\DoxyCodeLine{00336\ \ \ \{}
\DoxyCodeLine{00337\ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ Ucols\ =\ m\_computeThinU\ ?\ m\_diagSize\ :\ householderU.cols();}
\DoxyCodeLine{00338\ \ \ \ \ m\_matrixU\ =\ MatrixX::Identity(householderU.cols(),\ Ucols);}
\DoxyCodeLine{00339\ \ \ \ \ m\_matrixU.topLeftCorner(m\_diagSize,\ m\_diagSize)\ =\ naiveV.template\ \mbox{\hyperlink{CommonCwiseUnaryOps_8h_aa89d007196125d10fa7d6e19811aca05}{cast<Scalar>}}().topLeftCorner(m\_diagSize,\ m\_diagSize);}
\DoxyCodeLine{00340\ \ \ \ \ householderU.applyThisOnTheLeft(m\_matrixU);\ \textcolor{comment}{//\ FIXME\ this\ line\ involves\ a\ temporary\ buffer}}
\DoxyCodeLine{00341\ \ \ \}}
\DoxyCodeLine{00342\ \ \ \textcolor{keywordflow}{if}\ (computeV())}
\DoxyCodeLine{00343\ \ \ \{}
\DoxyCodeLine{00344\ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ Vcols\ =\ m\_computeThinV\ ?\ m\_diagSize\ :\ householderV.cols();}
\DoxyCodeLine{00345\ \ \ \ \ m\_matrixV\ =\ MatrixX::Identity(householderV.cols(),\ Vcols);}
\DoxyCodeLine{00346\ \ \ \ \ m\_matrixV.topLeftCorner(m\_diagSize,\ m\_diagSize)\ =\ naiveU.template\ \mbox{\hyperlink{CommonCwiseUnaryOps_8h_aa89d007196125d10fa7d6e19811aca05}{cast<Scalar>}}().topLeftCorner(m\_diagSize,\ m\_diagSize);}
\DoxyCodeLine{00347\ \ \ \ \ householderV.applyThisOnTheLeft(m\_matrixV);\ \textcolor{comment}{//\ FIXME\ this\ line\ involves\ a\ temporary\ buffer}}
\DoxyCodeLine{00348\ \ \ \}}
\DoxyCodeLine{00349\ \}}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00359\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00360\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::structured\_update(Block<MatrixXr,Dynamic,Dynamic>\ A,\ \textcolor{keyword}{const}\ MatrixXr\ \&B,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ n1)}
\DoxyCodeLine{00361\ \{}
\DoxyCodeLine{00362\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ =\ A.\mbox{\hyperlink{classEigen_1_1BDCSVD_ab1a0d1fcc818a876c3cb2b32887604be}{rows}}();}
\DoxyCodeLine{00363\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}>100)}
\DoxyCodeLine{00364\ \ \ \{}
\DoxyCodeLine{00365\ \ \ \ \ \textcolor{comment}{//\ If\ the\ matrices\ are\ large\ enough,\ let's\ exploit\ the\ sparse\ structure\ of\ A\ by}}
\DoxyCodeLine{00366\ \ \ \ \ \textcolor{comment}{//\ splitting\ it\ in\ half\ (wrt\ n1),\ and\ packing\ the\ non-\/zero\ columns.}}
\DoxyCodeLine{00367\ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ n2\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ -\/\ n1;}
\DoxyCodeLine{00368\ \ \ \ \ Map<MatrixXr>\ A1(m\_workspace.data()\ \ \ \ \ \ ,\ n1,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00369\ \ \ \ \ Map<MatrixXr>\ A2(m\_workspace.data()+\ n1*\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ n2,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00370\ \ \ \ \ Map<MatrixXr>\ B1(m\_workspace.data()+\ \ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}*\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00371\ \ \ \ \ Map<MatrixXr>\ B2(m\_workspace.data()+2*\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}*\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00372\ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ k1=0,\ k2=0;}
\DoxyCodeLine{00373\ \ \ \ \ \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ j=0;\ j<\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}};\ ++j)}
\DoxyCodeLine{00374\ \ \ \ \ \{}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ (A.col(j).head(n1).array()!=Literal(0)).any()\ )}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ A1.col(k1)\ =\ A.col(j).head(n1);}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ B1.row(k1)\ =\ B.row(j);}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ ++k1;}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ (A.col(j).tail(n2).array()!=Literal(0)).any()\ )}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ A2.col(k2)\ =\ A.col(j).tail(n2);}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ B2.row(k2)\ =\ B.row(j);}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ ++k2;}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00387\ \ \ \ \ \}}
\DoxyCodeLine{00388\ \ \ }
\DoxyCodeLine{00389\ \ \ \ \ A.topRows(n1).noalias()\ \ \ \ =\ A1.leftCols(k1)\ *\ B1.topRows(k1);}
\DoxyCodeLine{00390\ \ \ \ \ A.bottomRows(n2).noalias()\ =\ A2.leftCols(k2)\ *\ B2.topRows(k2);}
\DoxyCodeLine{00391\ \ \ \}}
\DoxyCodeLine{00392\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00393\ \ \ \{}
\DoxyCodeLine{00394\ \ \ \ \ Map<MatrixXr,Aligned>\ tmp(m\_workspace.data(),\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00395\ \ \ \ \ tmp.noalias()\ =\ A*B;}
\DoxyCodeLine{00396\ \ \ \ \ A\ =\ tmp;}
\DoxyCodeLine{00397\ \ \ \}}
\DoxyCodeLine{00398\ \}}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \textcolor{comment}{//\ The\ divide\ algorithm\ is\ done\ "{}in\ place"{},\ we\ are\ always\ working\ on\ subsets\ of\ the\ same\ matrix.\ The\ divide\ methods\ takes\ as\ argument\ the\ }}
\DoxyCodeLine{00401\ \textcolor{comment}{//\ place\ of\ the\ submatrix\ we\ are\ currently\ working\ on.}}
\DoxyCodeLine{00402\ }
\DoxyCodeLine{00403\ \textcolor{comment}{//@param\ firstCol\ :\ The\ Index\ of\ the\ first\ column\ of\ the\ submatrix\ of\ m\_computed\ and\ for\ m\_naiveU;}}
\DoxyCodeLine{00404\ \textcolor{comment}{//@param\ lastCol\ :\ The\ Index\ of\ the\ last\ column\ of\ the\ submatrix\ of\ m\_computed\ and\ for\ m\_naiveU;\ }}
\DoxyCodeLine{00405\ \textcolor{comment}{//\ lastCol\ +\ 1\ -\/\ firstCol\ is\ the\ size\ of\ the\ submatrix.}}
\DoxyCodeLine{00406\ \textcolor{comment}{//@param\ firstRowW\ :\ The\ Index\ of\ the\ first\ row\ of\ the\ matrix\ W\ that\ we\ are\ to\ change.\ (see\ the\ reference\ paper\ section\ 1\ for\ more\ information\ on\ W)}}
\DoxyCodeLine{00407\ \textcolor{comment}{//@param\ firstRowW\ :\ Same\ as\ firstRowW\ with\ the\ column.}}
\DoxyCodeLine{00408\ \textcolor{comment}{//@param\ shift\ :\ Each\ time\ one\ takes\ the\ left\ submatrix,\ one\ must\ add\ 1\ to\ the\ shift.\ Why?\ Because!\ We\ actually\ want\ the\ last\ column\ of\ the\ U\ submatrix\ }}
\DoxyCodeLine{00409\ \textcolor{comment}{//\ to\ become\ the\ first\ column\ (*coeff)\ and\ to\ shift\ all\ the\ other\ columns\ to\ the\ right.\ There\ are\ more\ details\ on\ the\ reference\ paper.}}
\DoxyCodeLine{00410\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00411\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::divide(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ firstCol,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ lastCol,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ firstRowW,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ firstColW,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ shift)}
\DoxyCodeLine{00412\ \{}
\DoxyCodeLine{00413\ \ \ \textcolor{comment}{//\ requires\ rows\ =\ cols\ +\ 1;}}
\DoxyCodeLine{00414\ \ \ \textcolor{keyword}{using\ }std::pow;}
\DoxyCodeLine{00415\ \ \ \textcolor{keyword}{using\ }std::sqrt;}
\DoxyCodeLine{00416\ \ \ \textcolor{keyword}{using\ }std::abs;}
\DoxyCodeLine{00417\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ =\ lastCol\ -\/\ firstCol\ +\ 1;}
\DoxyCodeLine{00418\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ k\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}/2;}
\DoxyCodeLine{00419\ \ \ \textcolor{keyword}{const}\ RealScalar\ considerZero\ =\ (std::numeric\_limits<RealScalar>::min)();}
\DoxyCodeLine{00420\ \ \ RealScalar\ alphaK;}
\DoxyCodeLine{00421\ \ \ RealScalar\ betaK;\ }
\DoxyCodeLine{00422\ \ \ RealScalar\ r0;\ }
\DoxyCodeLine{00423\ \ \ RealScalar\ lambda,\ phi,\ c0,\ s0;}
\DoxyCodeLine{00424\ \ \ VectorType\ \mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba2db95e8e1a9267b7a1188556b2013b33}{l}},\ \mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca8fa14cdd754f91cc6554c9e71929cce7}{f}};}
\DoxyCodeLine{00425\ \ \ \textcolor{comment}{//\ We\ use\ the\ other\ algorithm\ which\ is\ more\ efficient\ for\ small\ }}
\DoxyCodeLine{00426\ \ \ \textcolor{comment}{//\ matrices.}}
\DoxyCodeLine{00427\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ <\ m\_algoswap)}
\DoxyCodeLine{00428\ \ \ \{}
\DoxyCodeLine{00429\ \ \ \ \ \textcolor{comment}{//\ FIXME\ this\ line\ involves\ temporaries}}
\DoxyCodeLine{00430\ \ \ \ \ JacobiSVD<MatrixXr>\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2layout__test_8cc_ad66453096871179e6c6effe0df4b483b}{b}}(m\_computed.block(firstCol,\ firstCol,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ +\ 1,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}),\ \mbox{\hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a9fa9302d510cee20c26311154937e23f}{ComputeFullU}}\ |\ (m\_compV\ ?\ \mbox{\hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a36581f7c662f7def31efd500c284f930}{ComputeFullV}}\ :\ 0));}
\DoxyCodeLine{00431\ \ \ \ \ m\_info\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2layout__test_8cc_ad66453096871179e6c6effe0df4b483b}{b}}.info();}
\DoxyCodeLine{00432\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_info\ !=\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea671a2aeb0f527802806a441d58a80fcf}{Success}}\ \&\&\ m\_info\ !=\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea6a68dfb88a8336108a30588bdf356c57}{NoConvergence}})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00433\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_compU)}
\DoxyCodeLine{00434\ \ \ \ \ \ \ m\_naiveU.block(firstCol,\ firstCol,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ +\ 1,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ +\ 1).real()\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2layout__test_8cc_ad66453096871179e6c6effe0df4b483b}{b}}.matrixU();}
\DoxyCodeLine{00435\ \ \ \ \ \textcolor{keywordflow}{else}\ }
\DoxyCodeLine{00436\ \ \ \ \ \{}
\DoxyCodeLine{00437\ \ \ \ \ \ \ m\_naiveU.row(0).segment(firstCol,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ +\ 1).real()\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2layout__test_8cc_ad66453096871179e6c6effe0df4b483b}{b}}.matrixU().row(0);}
\DoxyCodeLine{00438\ \ \ \ \ \ \ m\_naiveU.row(1).segment(firstCol,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ +\ 1).real()\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2layout__test_8cc_ad66453096871179e6c6effe0df4b483b}{b}}.matrixU().row(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00439\ \ \ \ \ \}}
\DoxyCodeLine{00440\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ m\_naiveV.block(firstRowW,\ firstColW,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}).real()\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2layout__test_8cc_ad66453096871179e6c6effe0df4b483b}{b}}.matrixV();}
\DoxyCodeLine{00441\ \ \ \ \ m\_computed.block(firstCol\ +\ shift,\ firstCol\ +\ shift,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ +\ 1,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}).setZero();}
\DoxyCodeLine{00442\ \ \ \ \ m\_computed.diagonal().segment(firstCol\ +\ shift,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}})\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2layout__test_8cc_ad66453096871179e6c6effe0df4b483b}{b}}.singularValues().head(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00443\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00444\ \ \ \}}
\DoxyCodeLine{00445\ \ \ \textcolor{comment}{//\ We\ use\ the\ divide\ and\ conquer\ algorithm}}
\DoxyCodeLine{00446\ \ \ alphaK\ =\ \ m\_computed(firstCol\ +\ k,\ firstCol\ +\ k);}
\DoxyCodeLine{00447\ \ \ betaK\ =\ m\_computed(firstCol\ +\ k\ +\ 1,\ firstCol\ +\ k);}
\DoxyCodeLine{00448\ \ \ \textcolor{comment}{//\ The\ divide\ must\ be\ done\ in\ that\ order\ in\ order\ to\ have\ good\ results.\ Divide\ change\ the\ data\ inside\ the\ submatrices}}
\DoxyCodeLine{00449\ \ \ \textcolor{comment}{//\ and\ the\ divide\ of\ the\ right\ submatrice\ reads\ one\ column\ of\ the\ left\ submatrice.\ That's\ why\ we\ need\ to\ treat\ the\ }}
\DoxyCodeLine{00450\ \ \ \textcolor{comment}{//\ right\ submatrix\ before\ the\ left\ one.\ }}
\DoxyCodeLine{00451\ \ \ divide(k\ +\ 1\ +\ firstCol,\ lastCol,\ k\ +\ 1\ +\ firstRowW,\ k\ +\ 1\ +\ firstColW,\ shift);}
\DoxyCodeLine{00452\ \ \ \textcolor{keywordflow}{if}\ (m\_info\ !=\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea671a2aeb0f527802806a441d58a80fcf}{Success}}\ \&\&\ m\_info\ !=\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea6a68dfb88a8336108a30588bdf356c57}{NoConvergence}})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00453\ \ \ divide(firstCol,\ k\ -\/\ 1\ +\ firstCol,\ firstRowW,\ firstColW\ +\ 1,\ shift\ +\ 1);}
\DoxyCodeLine{00454\ \ \ \textcolor{keywordflow}{if}\ (m\_info\ !=\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea671a2aeb0f527802806a441d58a80fcf}{Success}}\ \&\&\ m\_info\ !=\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea6a68dfb88a8336108a30588bdf356c57}{NoConvergence}})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00455\ }
\DoxyCodeLine{00456\ \ \ \textcolor{keywordflow}{if}\ (m\_compU)}
\DoxyCodeLine{00457\ \ \ \{}
\DoxyCodeLine{00458\ \ \ \ \ lambda\ =\ m\_naiveU(firstCol\ +\ k,\ firstCol\ +\ k);}
\DoxyCodeLine{00459\ \ \ \ \ phi\ =\ m\_naiveU(firstCol\ +\ k\ +\ 1,\ lastCol\ +\ 1);}
\DoxyCodeLine{00460\ \ \ \}\ }
\DoxyCodeLine{00461\ \ \ \textcolor{keywordflow}{else}\ }
\DoxyCodeLine{00462\ \ \ \{}
\DoxyCodeLine{00463\ \ \ \ \ lambda\ =\ m\_naiveU(1,\ firstCol\ +\ k);}
\DoxyCodeLine{00464\ \ \ \ \ phi\ =\ m\_naiveU(0,\ lastCol\ +\ 1);}
\DoxyCodeLine{00465\ \ \ \}}
\DoxyCodeLine{00466\ \ \ r0\ =\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a656b9217a2fcb6de59dc8d1eb3079cc7}{sqrt}}((\mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(alphaK\ *\ lambda)\ *\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(alphaK\ *\ lambda))\ +\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(betaK\ *\ phi)\ *\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(betaK\ *\ phi));}
\DoxyCodeLine{00467\ \ \ \textcolor{keywordflow}{if}\ (m\_compU)}
\DoxyCodeLine{00468\ \ \ \{}
\DoxyCodeLine{00469\ \ \ \ \ \mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba2db95e8e1a9267b7a1188556b2013b33}{l}}\ =\ m\_naiveU.row(firstCol\ +\ k).segment(firstCol,\ k);}
\DoxyCodeLine{00470\ \ \ \ \ \mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca8fa14cdd754f91cc6554c9e71929cce7}{f}}\ =\ m\_naiveU.row(firstCol\ +\ k\ +\ 1).segment(firstCol\ +\ k\ +\ 1,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ -\/\ k\ -\/\ 1);}
\DoxyCodeLine{00471\ \ \ \}\ }
\DoxyCodeLine{00472\ \ \ \textcolor{keywordflow}{else}\ }
\DoxyCodeLine{00473\ \ \ \{}
\DoxyCodeLine{00474\ \ \ \ \ \mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba2db95e8e1a9267b7a1188556b2013b33}{l}}\ =\ m\_naiveU.row(1).segment(firstCol,\ k);}
\DoxyCodeLine{00475\ \ \ \ \ \mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca8fa14cdd754f91cc6554c9e71929cce7}{f}}\ =\ m\_naiveU.row(0).segment(firstCol\ +\ k\ +\ 1,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ -\/\ k\ -\/\ 1);}
\DoxyCodeLine{00476\ \ \ \}}
\DoxyCodeLine{00477\ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ m\_naiveV(firstRowW+k,\ firstColW)\ =\ Literal(1);}
\DoxyCodeLine{00478\ \ \ \textcolor{keywordflow}{if}\ (r0<considerZero)}
\DoxyCodeLine{00479\ \ \ \{}
\DoxyCodeLine{00480\ \ \ \ \ c0\ =\ Literal(1);}
\DoxyCodeLine{00481\ \ \ \ \ s0\ =\ Literal(0);}
\DoxyCodeLine{00482\ \ \ \}}
\DoxyCodeLine{00483\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00484\ \ \ \{}
\DoxyCodeLine{00485\ \ \ \ \ c0\ =\ alphaK\ *\ lambda\ /\ r0;}
\DoxyCodeLine{00486\ \ \ \ \ s0\ =\ betaK\ *\ phi\ /\ r0;}
\DoxyCodeLine{00487\ \ \ \}}
\DoxyCodeLine{00488\ \ \ }
\DoxyCodeLine{00489\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00490\ \ \ assert(m\_naiveU.allFinite());}
\DoxyCodeLine{00491\ \ \ assert(m\_naiveV.allFinite());}
\DoxyCodeLine{00492\ \ \ assert(m\_computed.allFinite());}
\DoxyCodeLine{00493\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00494\ \ \ }
\DoxyCodeLine{00495\ \ \ \textcolor{keywordflow}{if}\ (m\_compU)}
\DoxyCodeLine{00496\ \ \ \{}
\DoxyCodeLine{00497\ \ \ \ \ MatrixXr\ q1\ (m\_naiveU.col(firstCol\ +\ k).segment(firstCol,\ k\ +\ 1));\ \ \ \ \ }
\DoxyCodeLine{00498\ \ \ \ \ \textcolor{comment}{//\ we\ shiftW\ Q1\ to\ the\ right}}
\DoxyCodeLine{00499\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ =\ firstCol\ +\ k\ -\/\ 1;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ >=\ firstCol;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}-\/-\/)\ }
\DoxyCodeLine{00500\ \ \ \ \ \ \ m\_naiveU.col(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ +\ 1).segment(firstCol,\ k\ +\ 1)\ =\ m\_naiveU.col(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}).segment(firstCol,\ k\ +\ 1);}
\DoxyCodeLine{00501\ \ \ \ \ \textcolor{comment}{//\ we\ shift\ q1\ at\ the\ left\ with\ a\ factor\ c0}}
\DoxyCodeLine{00502\ \ \ \ \ m\_naiveU.col(firstCol).segment(\ firstCol,\ k\ +\ 1)\ =\ (q1\ *\ c0);}
\DoxyCodeLine{00503\ \ \ \ \ \textcolor{comment}{//\ last\ column\ =\ q1\ *\ -\/\ s0}}
\DoxyCodeLine{00504\ \ \ \ \ m\_naiveU.col(lastCol\ +\ 1).segment(firstCol,\ k\ +\ 1)\ =\ (q1\ *\ (\ -\/\ s0));}
\DoxyCodeLine{00505\ \ \ \ \ \textcolor{comment}{//\ first\ column\ =\ q2\ *\ s0}}
\DoxyCodeLine{00506\ \ \ \ \ m\_naiveU.col(firstCol).segment(firstCol\ +\ k\ +\ 1,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ -\/\ k)\ =\ m\_naiveU.col(lastCol\ +\ 1).segment(firstCol\ +\ k\ +\ 1,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ -\/\ k)\ *\ s0;\ }
\DoxyCodeLine{00507\ \ \ \ \ \textcolor{comment}{//\ q2\ *=\ c0}}
\DoxyCodeLine{00508\ \ \ \ \ m\_naiveU.col(lastCol\ +\ 1).segment(firstCol\ +\ k\ +\ 1,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ -\/\ k)\ *=\ c0;}
\DoxyCodeLine{00509\ \ \ \}\ }
\DoxyCodeLine{00510\ \ \ \textcolor{keywordflow}{else}\ }
\DoxyCodeLine{00511\ \ \ \{}
\DoxyCodeLine{00512\ \ \ \ \ RealScalar\ q1\ =\ m\_naiveU(0,\ firstCol\ +\ k);}
\DoxyCodeLine{00513\ \ \ \ \ \textcolor{comment}{//\ we\ shift\ Q1\ to\ the\ right}}
\DoxyCodeLine{00514\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ =\ firstCol\ +\ k\ -\/\ 1;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ >=\ firstCol;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}-\/-\/)\ }
\DoxyCodeLine{00515\ \ \ \ \ \ \ m\_naiveU(0,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ +\ 1)\ =\ m\_naiveU(0,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}});}
\DoxyCodeLine{00516\ \ \ \ \ \textcolor{comment}{//\ we\ shift\ q1\ at\ the\ left\ with\ a\ factor\ c0}}
\DoxyCodeLine{00517\ \ \ \ \ m\_naiveU(0,\ firstCol)\ =\ (q1\ *\ c0);}
\DoxyCodeLine{00518\ \ \ \ \ \textcolor{comment}{//\ last\ column\ =\ q1\ *\ -\/\ s0}}
\DoxyCodeLine{00519\ \ \ \ \ m\_naiveU(0,\ lastCol\ +\ 1)\ =\ (q1\ *\ (\ -\/\ s0));}
\DoxyCodeLine{00520\ \ \ \ \ \textcolor{comment}{//\ first\ column\ =\ q2\ *\ s0}}
\DoxyCodeLine{00521\ \ \ \ \ m\_naiveU(1,\ firstCol)\ =\ m\_naiveU(1,\ lastCol\ +\ 1)\ *s0;\ }
\DoxyCodeLine{00522\ \ \ \ \ \textcolor{comment}{//\ q2\ *=\ c0}}
\DoxyCodeLine{00523\ \ \ \ \ m\_naiveU(1,\ lastCol\ +\ 1)\ *=\ c0;}
\DoxyCodeLine{00524\ \ \ \ \ m\_naiveU.row(1).segment(firstCol\ +\ 1,\ k).setZero();}
\DoxyCodeLine{00525\ \ \ \ \ m\_naiveU.row(0).segment(firstCol\ +\ k\ +\ 1,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ -\/\ k\ -\/\ 1).setZero();}
\DoxyCodeLine{00526\ \ \ \}}
\DoxyCodeLine{00527\ \ \ }
\DoxyCodeLine{00528\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00529\ \ \ assert(m\_naiveU.allFinite());}
\DoxyCodeLine{00530\ \ \ assert(m\_naiveV.allFinite());}
\DoxyCodeLine{00531\ \ \ assert(m\_computed.allFinite());}
\DoxyCodeLine{00532\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00533\ \ \ }
\DoxyCodeLine{00534\ \ \ m\_computed(firstCol\ +\ shift,\ firstCol\ +\ shift)\ =\ r0;}
\DoxyCodeLine{00535\ \ \ m\_computed.col(firstCol\ +\ shift).segment(firstCol\ +\ shift\ +\ 1,\ k)\ =\ alphaK\ *\ \mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba2db95e8e1a9267b7a1188556b2013b33}{l}}.transpose().real();}
\DoxyCodeLine{00536\ \ \ m\_computed.col(firstCol\ +\ shift).segment(firstCol\ +\ shift\ +\ k\ +\ 1,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ -\/\ k\ -\/\ 1)\ =\ betaK\ *\ \mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca8fa14cdd754f91cc6554c9e71929cce7}{f}}.transpose().real();}
\DoxyCodeLine{00537\ }
\DoxyCodeLine{00538\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00539\ \ \ ArrayXr\ tmp1\ =\ (m\_computed.block(firstCol+shift,\ firstCol+shift,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}})).jacobiSvd().singularValues();}
\DoxyCodeLine{00540\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00541\ \ \ \textcolor{comment}{//\ Second\ part:\ try\ to\ deflate\ singular\ values\ in\ combined\ matrix}}
\DoxyCodeLine{00542\ \ \ deflation(firstCol,\ lastCol,\ k,\ firstRowW,\ firstColW,\ shift);}
\DoxyCodeLine{00543\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00544\ \ \ ArrayXr\ tmp2\ =\ (m\_computed.block(firstCol+shift,\ firstCol+shift,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}})).jacobiSvd().singularValues();}
\DoxyCodeLine{00545\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)nj1\ =\ "{}}\ <<\ tmp1.transpose().format(bdcsvdfmt)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00546\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}j2\ =\ "{}}\ <<\ tmp2.transpose().format(bdcsvdfmt)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00547\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}err:\ \ \ \ \ \ "{}}\ <<\ ((tmp1-\/tmp2).abs()>1e-\/12*tmp2.abs()).transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00548\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2raw__hash__set__test_8cc_ad43c3812e6d13e0518d9f8b8f463ffcf}{count}}\ =\ 0;}
\DoxyCodeLine{00549\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\#\ "{}}\ <<\ ++\mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2raw__hash__set__test_8cc_ad43c3812e6d13e0518d9f8b8f463ffcf}{count}}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00550\ \ \ assert((tmp1-\/tmp2).matrix().norm()\ <\ 1e-\/14*tmp2.matrix().norm());}
\DoxyCodeLine{00551\ \textcolor{comment}{//\ \ \ assert(count<681);}}
\DoxyCodeLine{00552\ \textcolor{comment}{//\ \ \ assert(((tmp1-\/tmp2).abs()<1e-\/13*tmp2.abs()).all());}}
\DoxyCodeLine{00553\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00554\ \ \ }
\DoxyCodeLine{00555\ \ \ \textcolor{comment}{//\ Third\ part:\ compute\ SVD\ of\ combined\ matrix}}
\DoxyCodeLine{00556\ \ \ MatrixXr\ UofSVD,\ VofSVD;}
\DoxyCodeLine{00557\ \ \ VectorType\ singVals;}
\DoxyCodeLine{00558\ \ \ computeSVDofM(firstCol\ +\ shift,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ UofSVD,\ singVals,\ VofSVD);}
\DoxyCodeLine{00559\ \ \ }
\DoxyCodeLine{00560\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00561\ \ \ assert(UofSVD.allFinite());}
\DoxyCodeLine{00562\ \ \ assert(VofSVD.allFinite());}
\DoxyCodeLine{00563\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00564\ \ \ }
\DoxyCodeLine{00565\ \ \ \textcolor{keywordflow}{if}\ (m\_compU)}
\DoxyCodeLine{00566\ \ \ \ \ structured\_update(m\_naiveU.block(firstCol,\ firstCol,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ +\ 1,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ +\ 1),\ UofSVD,\ (\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}+2)/2);}
\DoxyCodeLine{00567\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00568\ \ \ \{}
\DoxyCodeLine{00569\ \ \ \ \ Map<Matrix<RealScalar,2,Dynamic>,\mbox{\hyperlink{group__enums_gga45fe06e29902b7a2773de05ba27b47a1ae12d0f8f869c40c76128260af2242bc8}{Aligned}}>\ tmp(m\_workspace.data(),2,\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}+1);}
\DoxyCodeLine{00570\ \ \ \ \ tmp.noalias()\ =\ m\_naiveU.middleCols(firstCol,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}+1)\ *\ UofSVD;}
\DoxyCodeLine{00571\ \ \ \ \ m\_naiveU.middleCols(firstCol,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ +\ 1)\ =\ tmp;}
\DoxyCodeLine{00572\ \ \ \}}
\DoxyCodeLine{00573\ \ \ }
\DoxyCodeLine{00574\ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ \ structured\_update(m\_naiveV.block(firstRowW,\ firstColW,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}),\ VofSVD,\ (\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}+1)/2);}
\DoxyCodeLine{00575\ \ \ }
\DoxyCodeLine{00576\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00577\ \ \ assert(m\_naiveU.allFinite());}
\DoxyCodeLine{00578\ \ \ assert(m\_naiveV.allFinite());}
\DoxyCodeLine{00579\ \ \ assert(m\_computed.allFinite());}
\DoxyCodeLine{00580\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00581\ \ \ }
\DoxyCodeLine{00582\ \ \ m\_computed.block(firstCol\ +\ shift,\ firstCol\ +\ shift,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}).setZero();}
\DoxyCodeLine{00583\ \ \ m\_computed.block(firstCol\ +\ shift,\ firstCol\ +\ shift,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}).diagonal()\ =\ singVals;}
\DoxyCodeLine{00584\ \}\textcolor{comment}{//\ end\ divide}}
\DoxyCodeLine{00585\ }
\DoxyCodeLine{00586\ \textcolor{comment}{//\ Compute\ SVD\ of\ m\_computed.block(firstCol,\ firstCol,\ n\ +\ 1,\ n);\ this\ block\ only\ has\ non-\/zeros\ in}}
\DoxyCodeLine{00587\ \textcolor{comment}{//\ the\ first\ column\ and\ on\ the\ diagonal\ and\ has\ undergone\ deflation,\ so\ diagonal\ is\ in\ increasing}}
\DoxyCodeLine{00588\ \textcolor{comment}{//\ order\ except\ for\ possibly\ the\ (0,0)\ entry.\ The\ computed\ SVD\ is\ stored\ U,\ singVals\ and\ V,\ except}}
\DoxyCodeLine{00589\ \textcolor{comment}{//\ that\ if\ m\_compV\ is\ false,\ then\ V\ is\ not\ computed.\ Singular\ values\ are\ sorted\ in\ decreasing\ order.}}
\DoxyCodeLine{00590\ \textcolor{comment}{//}}
\DoxyCodeLine{00591\ \textcolor{comment}{//\ TODO\ Opportunities\ for\ optimization:\ better\ root\ finding\ algo,\ better\ stopping\ criterion,\ better}}
\DoxyCodeLine{00592\ \textcolor{comment}{//\ handling\ of\ round-\/off\ errors,\ be\ consistent\ in\ ordering}}
\DoxyCodeLine{00593\ \textcolor{comment}{//\ For\ instance,\ to\ solve\ the\ secular\ equation\ using\ FMM,\ see\ http://www.stat.uchicago.edu/\string~lekheng/courses/302/classics/greengard-\/rokhlin.pdf}}
\DoxyCodeLine{00594\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00595\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::computeSVDofM(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ firstCol,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ MatrixXr\&\ U,\ VectorType\&\ singVals,\ MatrixXr\&\ V)}
\DoxyCodeLine{00596\ \{}
\DoxyCodeLine{00597\ \ \ \textcolor{keyword}{const}\ RealScalar\ considerZero\ =\ (std::numeric\_limits<RealScalar>::min)();}
\DoxyCodeLine{00598\ \ \ \textcolor{keyword}{using\ }std::abs;}
\DoxyCodeLine{00599\ \ \ ArrayRef\ col0\ =\ m\_computed.col(firstCol).segment(firstCol,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00600\ \ \ m\_workspace.head(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}})\ =\ \ m\_computed.block(firstCol,\ firstCol,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}).diagonal();}
\DoxyCodeLine{00601\ \ \ ArrayRef\ diag\ =\ m\_workspace.head(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00602\ \ \ diag(0)\ =\ Literal(0);}
\DoxyCodeLine{00603\ }
\DoxyCodeLine{00604\ \ \ \textcolor{comment}{//\ Allocate\ space\ for\ singular\ values\ and\ vectors}}
\DoxyCodeLine{00605\ \ \ singVals.resize(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00606\ \ \ U.resize(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}+1,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}+1);}
\DoxyCodeLine{00607\ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ V.resize(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00608\ }
\DoxyCodeLine{00609\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00610\ \ \ \textcolor{keywordflow}{if}\ (col0.hasNaN()\ ||\ diag.hasNaN())}
\DoxyCodeLine{00611\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)nHAS\ NAN\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00612\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00613\ \ \ }
\DoxyCodeLine{00614\ \ \ \textcolor{comment}{//\ Many\ singular\ values\ might\ have\ been\ deflated,\ the\ zero\ ones\ have\ been\ moved\ to\ the\ end,}}
\DoxyCodeLine{00615\ \ \ \textcolor{comment}{//\ but\ others\ are\ interleaved\ and\ we\ must\ ignore\ them\ at\ this\ stage.}}
\DoxyCodeLine{00616\ \ \ \textcolor{comment}{//\ To\ this\ end,\ let's\ compute\ a\ permutation\ skipping\ them:}}
\DoxyCodeLine{00617\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ actual\_n\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}};}
\DoxyCodeLine{00618\ \ \ \textcolor{keywordflow}{while}(actual\_n>1\ \&\&\ diag(actual\_n-\/1)==Literal(0))\ \{-\/-\/actual\_n;\ \mbox{\hyperlink{Macros_8h_a4e742b5a08636a61784c0e173b61e710}{eigen\_internal\_assert}}(col0(actual\_n)==Literal(0));\ \}}
\DoxyCodeLine{00619\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ m\ =\ 0;\ \textcolor{comment}{//\ size\ of\ the\ deflated\ problem}}
\DoxyCodeLine{00620\ \ \ \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ k=0;k<actual\_n;++k)}
\DoxyCodeLine{00621\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(col0(k))>considerZero)}
\DoxyCodeLine{00622\ \ \ \ \ \ \ m\_workspaceI(m++)\ =\ k;}
\DoxyCodeLine{00623\ \ \ Map<ArrayXi>\ perm(m\_workspaceI.data(),m);}
\DoxyCodeLine{00624\ \ \ }
\DoxyCodeLine{00625\ \ \ Map<ArrayXr>\ shifts(m\_workspace.data()+1*\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00626\ \ \ Map<ArrayXr>\ mus(m\_workspace.data()+2*\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00627\ \ \ Map<ArrayXr>\ zhat(m\_workspace.data()+3*\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00628\ }
\DoxyCodeLine{00629\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00630\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}computeSVDofM\ using:\(\backslash\)n"{}};}
\DoxyCodeLine{00631\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ z:\ "{}}\ <<\ col0.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00632\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ d:\ "{}}\ <<\ diag.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00633\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00634\ \ \ }
\DoxyCodeLine{00635\ \ \ \textcolor{comment}{//\ Compute\ singVals,\ shifts,\ and\ mus}}
\DoxyCodeLine{00636\ \ \ computeSingVals(col0,\ diag,\ perm,\ singVals,\ shifts,\ mus);}
\DoxyCodeLine{00637\ \ \ }
\DoxyCodeLine{00638\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00639\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ j:\ \ \ \ \ \ \ \ "{}}\ <<\ (m\_computed.block(firstCol,\ firstCol,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}})).jacobiSvd().singularValues().transpose().reverse()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00640\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ sing-\/val:\ "{}}\ <<\ singVals.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00641\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ mu:\ \ \ \ \ \ \ "{}}\ <<\ mus.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00642\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ shift:\ \ \ \ "{}}\ <<\ shifts.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00643\ \ \ }
\DoxyCodeLine{00644\ \ \ \{}
\DoxyCodeLine{00645\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n\ \ \ \ mus:\ \ \ \ "{}}\ <<\ mus.head(actual\_n).transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00646\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ \ \ check1\ (expect0)\ :\ "{}}\ <<\ ((singVals.array()-\/(shifts+mus))\ /\ singVals.array()).head(actual\_n).transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00647\ \ \ \ \ assert((((singVals.array()-\/(shifts+mus))\ /\ singVals.array()).head(actual\_n)\ >=\ 0).all());}
\DoxyCodeLine{00648\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ \ \ check2\ (>0)\ \ \ \ \ \ :\ "{}}\ <<\ ((singVals.array()-\/diag)\ /\ singVals.array()).head(actual\_n).transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00649\ \ \ \ \ assert((((singVals.array()-\/diag)\ /\ singVals.array()).head(actual\_n)\ >=\ 0).all());}
\DoxyCodeLine{00650\ \ \ \}}
\DoxyCodeLine{00651\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00652\ \ \ }
\DoxyCodeLine{00653\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00654\ \ \ assert(singVals.allFinite());}
\DoxyCodeLine{00655\ \ \ assert(mus.allFinite());}
\DoxyCodeLine{00656\ \ \ assert(shifts.allFinite());}
\DoxyCodeLine{00657\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00658\ \ \ }
\DoxyCodeLine{00659\ \ \ \textcolor{comment}{//\ Compute\ zhat}}
\DoxyCodeLine{00660\ \ \ perturbCol0(col0,\ diag,\ perm,\ singVals,\ shifts,\ mus,\ zhat);}
\DoxyCodeLine{00661\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00662\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ zhat:\ "{}}\ <<\ zhat.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00663\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00664\ \ \ }
\DoxyCodeLine{00665\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00666\ \ \ assert(zhat.allFinite());}
\DoxyCodeLine{00667\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00668\ \ \ }
\DoxyCodeLine{00669\ \ \ computeSingVecs(zhat,\ diag,\ perm,\ singVals,\ shifts,\ mus,\ U,\ V);}
\DoxyCodeLine{00670\ \ \ }
\DoxyCodeLine{00671\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00672\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}U\string^T\ U:\ "{}}\ <<\ (U.transpose()\ *\ U\ -\/\ MatrixXr(MatrixXr::Identity(U.cols(),U.cols()))).norm()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00673\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}V\string^T\ V:\ "{}}\ <<\ (V.transpose()\ *\ V\ -\/\ MatrixXr(MatrixXr::Identity(V.cols(),V.cols()))).norm()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00674\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00675\ \ \ }
\DoxyCodeLine{00676\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00677\ \ \ assert(m\_naiveU.allFinite());}
\DoxyCodeLine{00678\ \ \ assert(m\_naiveV.allFinite());}
\DoxyCodeLine{00679\ \ \ assert(m\_computed.allFinite());}
\DoxyCodeLine{00680\ \ \ assert(U.allFinite());}
\DoxyCodeLine{00681\ \ \ assert(V.allFinite());}
\DoxyCodeLine{00682\ \textcolor{comment}{//\ \ \ assert((U.transpose()\ *\ U\ -\/\ MatrixXr(MatrixXr::Identity(U.cols(),U.cols()))).norm()\ <\ 100*NumTraits<RealScalar>::epsilon()\ *\ n);}}
\DoxyCodeLine{00683\ \textcolor{comment}{//\ \ \ assert((V.transpose()\ *\ V\ -\/\ MatrixXr(MatrixXr::Identity(V.cols(),V.cols()))).norm()\ <\ 100*NumTraits<RealScalar>::epsilon()\ *\ n);}}
\DoxyCodeLine{00684\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00685\ \ \ }
\DoxyCodeLine{00686\ \ \ \textcolor{comment}{//\ Because\ of\ deflation,\ the\ singular\ values\ might\ not\ be\ completely\ sorted.}}
\DoxyCodeLine{00687\ \ \ \textcolor{comment}{//\ Fortunately,\ reordering\ them\ is\ a\ O(n)\ problem}}
\DoxyCodeLine{00688\ \ \ \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}=0;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}<actual\_n-\/1;\ ++\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})}
\DoxyCodeLine{00689\ \ \ \{}
\DoxyCodeLine{00690\ \ \ \ \ \textcolor{keywordflow}{if}(singVals(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})>singVals(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}+1))}
\DoxyCodeLine{00691\ \ \ \ \ \{}
\DoxyCodeLine{00692\ \ \ \ \ \ \ \textcolor{keyword}{using\ }std::swap;}
\DoxyCodeLine{00693\ \ \ \ \ \ \ swap(singVals(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}),singVals(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}+1));}
\DoxyCodeLine{00694\ \ \ \ \ \ \ U.col(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}).swap(U.col(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}+1));}
\DoxyCodeLine{00695\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(m\_compV)\ V.col(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}).swap(V.col(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}+1));}
\DoxyCodeLine{00696\ \ \ \ \ \}}
\DoxyCodeLine{00697\ \ \ \}}
\DoxyCodeLine{00698\ }
\DoxyCodeLine{00699\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00700\ \ \ \{}
\DoxyCodeLine{00701\ \ \ \ \ \textcolor{keywordtype}{bool}\ singular\_values\_sorted\ =\ (((singVals.segment(1,actual\_n-\/1)-\/singVals.head(actual\_n-\/1))).array()\ >=\ 0).all();}
\DoxyCodeLine{00702\ \ \ \ \ \textcolor{keywordflow}{if}(!singular\_values\_sorted)}
\DoxyCodeLine{00703\ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Singular\ values\ are\ not\ sorted:\ "{}}\ <<\ singVals.segment(1,actual\_n).transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00704\ \ \ \ \ assert(singular\_values\_sorted);}
\DoxyCodeLine{00705\ \ \ \}}
\DoxyCodeLine{00706\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00707\ \ \ }
\DoxyCodeLine{00708\ \ \ \textcolor{comment}{//\ Reverse\ order\ so\ that\ singular\ values\ in\ increased\ order}}
\DoxyCodeLine{00709\ \ \ \textcolor{comment}{//\ Because\ of\ deflation,\ the\ zeros\ singular-\/values\ are\ already\ at\ the\ end}}
\DoxyCodeLine{00710\ \ \ singVals.head(actual\_n).reverseInPlace();}
\DoxyCodeLine{00711\ \ \ U.leftCols(actual\_n).rowwise().reverseInPlace();}
\DoxyCodeLine{00712\ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ V.leftCols(actual\_n).rowwise().reverseInPlace();}
\DoxyCodeLine{00713\ \ \ }
\DoxyCodeLine{00714\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00715\ \ \ JacobiSVD<MatrixXr>\ jsvd(m\_computed.block(firstCol,\ firstCol,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}})\ );}
\DoxyCodeLine{00716\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ *\ j:\ \ \ \ \ \ \ \ "{}}\ <<\ jsvd.singularValues().transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00717\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ *\ sing-\/val:\ "{}}\ <<\ singVals.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00718\ \textcolor{comment}{//\ \ \ std::cout\ <<\ "{}\ \ *\ err:\ \ \ \ \ \ "{}\ <<\ ((jsvd.singularValues()-\/singVals)>1e-\/13*singVals.norm()).transpose()\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00719\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00720\ \}}
\DoxyCodeLine{00721\ }
\DoxyCodeLine{00722\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00723\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{classEigen_1_1BDCSVD_a8ae322ae4a50070fbc9dcee8e3ad1d91}{BDCSVD<MatrixType>::RealScalar}}\ BDCSVD<MatrixType>::secularEq(RealScalar\ mu,\ \textcolor{keyword}{const}\ ArrayRef\&\ col0,\ \textcolor{keyword}{const}\ ArrayRef\&\ diag,\ \textcolor{keyword}{const}\ IndicesRef\ \&perm,\ \textcolor{keyword}{const}\ ArrayRef\&\ diagShifted,\ RealScalar\ shift)}
\DoxyCodeLine{00724\ \{}
\DoxyCodeLine{00725\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ m\ =\ perm.size();}
\DoxyCodeLine{00726\ \ \ RealScalar\ res\ =\ Literal(1);}
\DoxyCodeLine{00727\ \ \ \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}=0;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}<m;\ ++\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})}
\DoxyCodeLine{00728\ \ \ \{}
\DoxyCodeLine{00729\ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba363b122c528f54df4a0446b6bab05515}{j}}\ =\ perm(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}});}
\DoxyCodeLine{00730\ \ \ \ \ \textcolor{comment}{//\ The\ following\ expression\ could\ be\ rewritten\ to\ involve\ only\ a\ single\ division,}}
\DoxyCodeLine{00731\ \ \ \ \ \textcolor{comment}{//\ but\ this\ would\ make\ the\ expression\ more\ sensitive\ to\ overflow.}}
\DoxyCodeLine{00732\ \ \ \ \ res\ +=\ (col0(j)\ /\ (diagShifted(j)\ -\/\ mu))\ *\ (col0(j)\ /\ (diag(j)\ +\ shift\ +\ mu));}
\DoxyCodeLine{00733\ \ \ \}}
\DoxyCodeLine{00734\ \ \ \textcolor{keywordflow}{return}\ res;}
\DoxyCodeLine{00735\ }
\DoxyCodeLine{00736\ \}}
\DoxyCodeLine{00737\ }
\DoxyCodeLine{00738\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00739\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::computeSingVals(\textcolor{keyword}{const}\ ArrayRef\&\ col0,\ \textcolor{keyword}{const}\ ArrayRef\&\ diag,\ \textcolor{keyword}{const}\ IndicesRef\ \&perm,}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ VectorType\&\ singVals,\ ArrayRef\ shifts,\ ArrayRef\ mus)}
\DoxyCodeLine{00741\ \{}
\DoxyCodeLine{00742\ \ \ \textcolor{keyword}{using\ }std::abs;}
\DoxyCodeLine{00743\ \ \ \textcolor{keyword}{using\ }std::swap;}
\DoxyCodeLine{00744\ \ \ \textcolor{keyword}{using\ }std::sqrt;}
\DoxyCodeLine{00745\ }
\DoxyCodeLine{00746\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ =\ col0.size();}
\DoxyCodeLine{00747\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ actual\_n\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}};}
\DoxyCodeLine{00748\ \ \ \textcolor{comment}{//\ Note\ that\ here\ actual\_n\ is\ computed\ based\ on\ col0(i)==0\ instead\ of\ diag(i)==0\ as\ above}}
\DoxyCodeLine{00749\ \ \ \textcolor{comment}{//\ because\ 1)\ we\ have\ diag(i)==0\ =>\ col0(i)==0\ and\ 2)\ if\ col0(i)==0,\ then\ diag(i)\ is\ already\ a\ singular\ value.}}
\DoxyCodeLine{00750\ \ \ \textcolor{keywordflow}{while}(actual\_n>1\ \&\&\ col0(actual\_n-\/1)==Literal(0))\ -\/-\/actual\_n;}
\DoxyCodeLine{00751\ }
\DoxyCodeLine{00752\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ k\ =\ 0;\ k\ <\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}};\ ++k)}
\DoxyCodeLine{00753\ \ \ \{}
\DoxyCodeLine{00754\ \ \ \ \ \textcolor{keywordflow}{if}\ (col0(k)\ ==\ Literal(0)\ ||\ actual\_n==1)}
\DoxyCodeLine{00755\ \ \ \ \ \{}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \textcolor{comment}{//\ if\ col0(k)\ ==\ 0,\ then\ entry\ is\ deflated,\ so\ singular\ value\ is\ on\ diagonal}}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \textcolor{comment}{//\ if\ actual\_n==1,\ then\ the\ deflated\ problem\ is\ already\ diagonalized}}
\DoxyCodeLine{00758\ \ \ \ \ \ \ singVals(k)\ =\ k==0\ ?\ col0(0)\ :\ diag(k);}
\DoxyCodeLine{00759\ \ \ \ \ \ \ mus(k)\ =\ Literal(0);}
\DoxyCodeLine{00760\ \ \ \ \ \ \ shifts(k)\ =\ k==0\ ?\ col0(0)\ :\ diag(k);}
\DoxyCodeLine{00761\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00762\ \ \ \ \ \}\ }
\DoxyCodeLine{00763\ }
\DoxyCodeLine{00764\ \ \ \ \ \textcolor{comment}{//\ otherwise,\ use\ secular\ equation\ to\ find\ singular\ value}}
\DoxyCodeLine{00765\ \ \ \ \ RealScalar\ left\ =\ diag(k);}
\DoxyCodeLine{00766\ \ \ \ \ RealScalar\ right;\ \textcolor{comment}{//\ was:\ =\ (k\ !=\ actual\_n-\/1)\ ?\ diag(k+1)\ :\ (diag(actual\_n-\/1)\ +\ col0.matrix().norm());}}
\DoxyCodeLine{00767\ \ \ \ \ \textcolor{keywordflow}{if}(k==actual\_n-\/1)}
\DoxyCodeLine{00768\ \ \ \ \ \ \ right\ =\ (diag(actual\_n-\/1)\ +\ col0.matrix().norm());}
\DoxyCodeLine{00769\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00770\ \ \ \ \ \{}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ deflated\ singular\ values,}}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \textcolor{comment}{//\ recall\ that\ at\ this\ stage\ we\ assume\ that\ z[j]!=0\ and\ all\ entries\ for\ which\ z[j]==0\ have\ been\ put\ aside.}}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ should\ be\ equivalent\ to\ using\ perm[]}}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba2db95e8e1a9267b7a1188556b2013b33}{l}}\ =\ k+1;}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \textcolor{keywordflow}{while}(col0(l)==Literal(0))\ \{\ ++\mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba2db95e8e1a9267b7a1188556b2013b33}{l}};\ \mbox{\hyperlink{Macros_8h_a4e742b5a08636a61784c0e173b61e710}{eigen\_internal\_assert}}(l<actual\_n);\ \}}
\DoxyCodeLine{00776\ \ \ \ \ \ \ right\ =\ diag(l);}
\DoxyCodeLine{00777\ \ \ \ \ \}}
\DoxyCodeLine{00778\ }
\DoxyCodeLine{00779\ \ \ \ \ \textcolor{comment}{//\ first\ decide\ whether\ it's\ closer\ to\ the\ left\ end\ or\ the\ right\ end}}
\DoxyCodeLine{00780\ \ \ \ \ RealScalar\ mid\ =\ left\ +\ (right-\/left)\ /\ Literal(2);}
\DoxyCodeLine{00781\ \ \ \ \ RealScalar\ fMid\ =\ secularEq(mid,\ col0,\ diag,\ perm,\ diag,\ Literal(0));}
\DoxyCodeLine{00782\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00783\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}right-\/left\ =\ "{}}\ <<\ right-\/left\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00784\ \textcolor{comment}{//\ \ \ \ \ std::cout\ <<\ "{}fMid\ =\ "{}\ <<\ fMid\ <<\ "{}\ "{}\ <<\ secularEq(mid-\/left,\ col0,\ diag,\ perm,\ ArrayXr(diag-\/left),\ left)}}
\DoxyCodeLine{00785\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ "{}\ "{}\ <<\ secularEq(mid-\/right,\ col0,\ diag,\ perm,\ ArrayXr(diag-\/right),\ right)\ \ \ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00786\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ \ \ \ =\ "{}}\ <<\ secularEq(left+RealScalar(0.000001)*(right-\/left),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00787\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(left+RealScalar(0.1)\ \ \ \ \ *(right-\/left),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(left+RealScalar(0.2)\ \ \ \ \ *(right-\/left),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(left+RealScalar(0.3)\ \ \ \ \ *(right-\/left),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00790\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(left+RealScalar(0.4)\ \ \ \ \ *(right-\/left),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00791\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(left+RealScalar(0.49)\ \ \ \ *(right-\/left),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00792\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(left+RealScalar(0.5)\ \ \ \ \ *(right-\/left),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(left+RealScalar(0.51)\ \ \ \ *(right-\/left),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00794\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(left+RealScalar(0.6)\ \ \ \ \ *(right-\/left),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(left+RealScalar(0.7)\ \ \ \ \ *(right-\/left),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(left+RealScalar(0.8)\ \ \ \ \ *(right-\/left),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(left+RealScalar(0.9)\ \ \ \ \ *(right-\/left),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(left+RealScalar(0.999999)*(right-\/left),\ col0,\ diag,\ perm,\ diag,\ 0)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00799\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00800\ \ \ \ \ RealScalar\ shift\ =\ (k\ ==\ actual\_n-\/1\ ||\ fMid\ >\ Literal(0))\ ?\ left\ :\ right;}
\DoxyCodeLine{00801\ \ \ \ \ }
\DoxyCodeLine{00802\ \ \ \ \ \textcolor{comment}{//\ measure\ everything\ relative\ to\ shift}}
\DoxyCodeLine{00803\ \ \ \ \ Map<ArrayXr>\ diagShifted(m\_workspace.data()+4*\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{00804\ \ \ \ \ diagShifted\ =\ diag\ -\/\ shift;}
\DoxyCodeLine{00805\ }
\DoxyCodeLine{00806\ \ \ \ \ \textcolor{keywordflow}{if}(k!=actual\_n-\/1)}
\DoxyCodeLine{00807\ \ \ \ \ \{}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \textcolor{comment}{//\ check\ that\ after\ the\ shift,\ f(mid)\ is\ still\ negative:}}
\DoxyCodeLine{00809\ \ \ \ \ \ \ RealScalar\ midShifted\ =\ (right\ -\/\ left)\ /\ RealScalar(2);}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(shift==right)}
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ midShifted\ =\ -\/midShifted;}
\DoxyCodeLine{00812\ \ \ \ \ \ \ RealScalar\ fMidShifted\ =\ secularEq(midShifted,\ col0,\ diag,\ perm,\ diagShifted,\ shift);}
\DoxyCodeLine{00813\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(fMidShifted>0)}
\DoxyCodeLine{00814\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00815\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ fMid\ was\ erroneous,\ fix\ it:}}
\DoxyCodeLine{00816\ \ \ \ \ \ \ \ \ shift\ =\ \ fMidShifted\ >\ Literal(0)\ ?\ left\ :\ right;}
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ diagShifted\ =\ diag\ -\/\ shift;}
\DoxyCodeLine{00818\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00819\ \ \ \ \ \}}
\DoxyCodeLine{00820\ \ \ \ \ }
\DoxyCodeLine{00821\ \ \ \ \ \textcolor{comment}{//\ initial\ guess}}
\DoxyCodeLine{00822\ \ \ \ \ RealScalar\ muPrev,\ muCur;}
\DoxyCodeLine{00823\ \ \ \ \ \textcolor{keywordflow}{if}\ (shift\ ==\ left)}
\DoxyCodeLine{00824\ \ \ \ \ \{}
\DoxyCodeLine{00825\ \ \ \ \ \ \ muPrev\ =\ (right\ -\/\ left)\ *\ RealScalar(0.1);}
\DoxyCodeLine{00826\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (k\ ==\ actual\_n-\/1)\ muCur\ =\ right\ -\/\ left;}
\DoxyCodeLine{00827\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ muCur\ =\ (right\ -\/\ left)\ *\ RealScalar(0.5);}
\DoxyCodeLine{00828\ \ \ \ \ \}}
\DoxyCodeLine{00829\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00830\ \ \ \ \ \{}
\DoxyCodeLine{00831\ \ \ \ \ \ \ muPrev\ =\ -\/(right\ -\/\ left)\ *\ RealScalar(0.1);}
\DoxyCodeLine{00832\ \ \ \ \ \ \ muCur\ =\ -\/(right\ -\/\ left)\ *\ RealScalar(0.5);}
\DoxyCodeLine{00833\ \ \ \ \ \}}
\DoxyCodeLine{00834\ }
\DoxyCodeLine{00835\ \ \ \ \ RealScalar\ fPrev\ =\ secularEq(muPrev,\ col0,\ diag,\ perm,\ diagShifted,\ shift);}
\DoxyCodeLine{00836\ \ \ \ \ RealScalar\ fCur\ =\ secularEq(muCur,\ col0,\ diag,\ perm,\ diagShifted,\ shift);}
\DoxyCodeLine{00837\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(fPrev)\ <\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(fCur))}
\DoxyCodeLine{00838\ \ \ \ \ \{}
\DoxyCodeLine{00839\ \ \ \ \ \ \ swap(fPrev,\ fCur);}
\DoxyCodeLine{00840\ \ \ \ \ \ \ swap(muPrev,\ muCur);}
\DoxyCodeLine{00841\ \ \ \ \ \}}
\DoxyCodeLine{00842\ }
\DoxyCodeLine{00843\ \ \ \ \ \textcolor{comment}{//\ rational\ interpolation:\ fit\ a\ function\ of\ the\ form\ a\ /\ mu\ +\ b\ through\ the\ two\ previous}}
\DoxyCodeLine{00844\ \ \ \ \ \textcolor{comment}{//\ iterates\ and\ use\ its\ zero\ to\ compute\ the\ next\ iterate}}
\DoxyCodeLine{00845\ \ \ \ \ \textcolor{keywordtype}{bool}\ useBisection\ =\ fPrev*fCur>Literal(0);}
\DoxyCodeLine{00846\ \ \ \ \ \textcolor{keywordflow}{while}\ (fCur!=Literal(0)\ \&\&\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(muCur\ -\/\ muPrev)\ >\ Literal(8)\ *\ \mbox{\hyperlink{structEigen_1_1GenericNumTraits_a3a573c69713fbb143fb49af7db463cee}{NumTraits<RealScalar>::epsilon}}()\ *\ \mbox{\hyperlink{namespaceEigen_1_1numext_a29d502349f2ec9897c808e65e0f96eb4}{numext::maxi<RealScalar>}}(\mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(muCur),\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(muPrev))\ \&\&\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(fCur\ -\/\ fPrev)>\mbox{\hyperlink{structEigen_1_1GenericNumTraits_a3a573c69713fbb143fb49af7db463cee}{NumTraits<RealScalar>::epsilon}}()\ \&\&\ !useBisection)}
\DoxyCodeLine{00847\ \ \ \ \ \{}
\DoxyCodeLine{00848\ \ \ \ \ \ \ ++m\_numIters;}
\DoxyCodeLine{00849\ }
\DoxyCodeLine{00850\ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ a\ and\ b\ such\ that\ the\ function\ f(mu)\ =\ a\ /\ mu\ +\ b\ matches\ the\ current\ and\ previous\ samples.}}
\DoxyCodeLine{00851\ \ \ \ \ \ \ RealScalar\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2common__policy__traits__test_8cc_aa4c2a5552e9bc49b1816ff532f558c74}{a}}\ =\ (fCur\ -\/\ fPrev)\ /\ (Literal(1)/muCur\ -\/\ Literal(1)/muPrev);}
\DoxyCodeLine{00852\ \ \ \ \ \ \ RealScalar\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2layout__test_8cc_ad66453096871179e6c6effe0df4b483b}{b}}\ =\ fCur\ -\/\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2common__policy__traits__test_8cc_aa4c2a5552e9bc49b1816ff532f558c74}{a}}\ /\ muCur;}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \textcolor{comment}{//\ And\ find\ mu\ such\ that\ f(mu)==0:}}
\DoxyCodeLine{00854\ \ \ \ \ \ \ RealScalar\ muZero\ =\ -\/\mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2common__policy__traits__test_8cc_aa4c2a5552e9bc49b1816ff532f558c74}{a}}/\mbox{\hyperlink{abseil-cpp_2absl_2container_2internal_2layout__test_8cc_ad66453096871179e6c6effe0df4b483b}{b}};}
\DoxyCodeLine{00855\ \ \ \ \ \ \ RealScalar\ fZero\ =\ secularEq(muZero,\ col0,\ diag,\ perm,\ diagShifted,\ shift);}
\DoxyCodeLine{00856\ }
\DoxyCodeLine{00857\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00858\ \ \ \ \ \ \ assert((\mbox{\hyperlink{namespaceEigen_1_1numext_a2453ca8f9a4be71354074d0f9bf734c8}{numext::isfinite}})(fZero));}
\DoxyCodeLine{00859\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00860\ \ \ \ \ \ \ }
\DoxyCodeLine{00861\ \ \ \ \ \ \ muPrev\ =\ muCur;}
\DoxyCodeLine{00862\ \ \ \ \ \ \ fPrev\ =\ fCur;}
\DoxyCodeLine{00863\ \ \ \ \ \ \ muCur\ =\ muZero;}
\DoxyCodeLine{00864\ \ \ \ \ \ \ fCur\ =\ fZero;}
\DoxyCodeLine{00865\ \ \ \ \ \ \ }
\DoxyCodeLine{00866\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (shift\ ==\ left\ \ \&\&\ (muCur\ <\ Literal(0)\ ||\ muCur\ >\ right\ -\/\ left))\ useBisection\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00867\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (shift\ ==\ right\ \&\&\ (muCur\ <\ -\/(right\ -\/\ left)\ ||\ muCur\ >\ Literal(0)))\ useBisection\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00868\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(fCur)>\mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(fPrev))\ useBisection\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00869\ \ \ \ \ \}}
\DoxyCodeLine{00870\ }
\DoxyCodeLine{00871\ \ \ \ \ \textcolor{comment}{//\ fall\ back\ on\ bisection\ method\ if\ rational\ interpolation\ did\ not\ work}}
\DoxyCodeLine{00872\ \ \ \ \ \textcolor{keywordflow}{if}\ (useBisection)}
\DoxyCodeLine{00873\ \ \ \ \ \{}
\DoxyCodeLine{00874\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00875\ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}useBisection\ for\ k\ =\ "{}}\ <<\ k\ <<\ \textcolor{stringliteral}{"{},\ actual\_n\ =\ "{}}\ <<\ actual\_n\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00876\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00877\ \ \ \ \ \ \ RealScalar\ leftShifted,\ rightShifted;}
\DoxyCodeLine{00878\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (shift\ ==\ left)}
\DoxyCodeLine{00879\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00880\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ to\ avoid\ overflow,\ we\ must\ have\ mu\ >\ max(real\_min,\ |z(k)|/sqrt(real\_max)),}}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ factor\ 2\ is\ to\ be\ more\ conservative}}
\DoxyCodeLine{00882\ \ \ \ \ \ \ \ \ leftShifted\ =\ \mbox{\hyperlink{namespaceEigen_1_1numext_a29d502349f2ec9897c808e65e0f96eb4}{numext::maxi<RealScalar>}}(\ (std::numeric\_limits<RealScalar>::min)(),\ Literal(2)\ *\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(col0(k))\ /\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a656b9217a2fcb6de59dc8d1eb3079cc7}{sqrt}}((std::numeric\_limits<RealScalar>::max)())\ );}
\DoxyCodeLine{00883\ }
\DoxyCodeLine{00884\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ check\ that\ we\ did\ it\ right:}}
\DoxyCodeLine{00885\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{Macros_8h_a4e742b5a08636a61784c0e173b61e710}{eigen\_internal\_assert}}(\ (\mbox{\hyperlink{namespaceEigen_1_1numext_a2453ca8f9a4be71354074d0f9bf734c8}{numext::isfinite}})(\ (col0(k)/leftShifted)*(col0(k)/(diag(k)+shift+leftShifted))\ )\ );}
\DoxyCodeLine{00886\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ I\ don't\ understand\ why\ the\ case\ k==0\ would\ be\ special\ there:}}
\DoxyCodeLine{00887\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ (k\ ==\ 0)\ rightShifted\ =\ right\ -\/\ left;\ else}}
\DoxyCodeLine{00888\ \ \ \ \ \ \ \ \ rightShifted\ =\ (k==actual\_n-\/1)\ ?\ right\ :\ ((right\ -\/\ left)\ *\ RealScalar(0.51));\ \textcolor{comment}{//\ theoretically\ we\ can\ take\ 0.5,\ but\ let's\ be\ safe}}
\DoxyCodeLine{00889\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00890\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00891\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00892\ \ \ \ \ \ \ \ \ leftShifted\ =\ -\/(right\ -\/\ left)\ *\ RealScalar(0.51);}
\DoxyCodeLine{00893\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(k+1<\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}})}
\DoxyCodeLine{00894\ \ \ \ \ \ \ \ \ \ \ rightShifted\ =\ -\/\mbox{\hyperlink{namespaceEigen_1_1numext_a29d502349f2ec9897c808e65e0f96eb4}{numext::maxi<RealScalar>}}(\ (std::numeric\_limits<RealScalar>::min)(),\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(col0(k+1))\ /\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a656b9217a2fcb6de59dc8d1eb3079cc7}{sqrt}}((std::numeric\_limits<RealScalar>::max)())\ );}
\DoxyCodeLine{00895\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00896\ \ \ \ \ \ \ \ \ \ \ rightShifted\ =\ -\/(std::numeric\_limits<RealScalar>::min)();}
\DoxyCodeLine{00897\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00898\ }
\DoxyCodeLine{00899\ \ \ \ \ \ \ RealScalar\ fLeft\ =\ secularEq(leftShifted,\ col0,\ diag,\ perm,\ diagShifted,\ shift);}
\DoxyCodeLine{00900\ \ \ \ \ \ \ \mbox{\hyperlink{Macros_8h_a4e742b5a08636a61784c0e173b61e710}{eigen\_internal\_assert}}(fLeft<Literal(0));}
\DoxyCodeLine{00901\ }
\DoxyCodeLine{00902\ \textcolor{preprocessor}{\#if\ defined\ EIGEN\_INTERNAL\_DEBUGGING\ ||\ defined\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00903\ \ \ \ \ \ \ RealScalar\ fRight\ =\ secularEq(rightShifted,\ col0,\ diag,\ perm,\ diagShifted,\ shift);}
\DoxyCodeLine{00904\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00905\ }
\DoxyCodeLine{00906\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00907\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!(\mbox{\hyperlink{namespaceEigen_1_1numext_a2453ca8f9a4be71354074d0f9bf734c8}{numext::isfinite}})(fLeft))}
\DoxyCodeLine{00908\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}f("{}}\ <<\ leftShifted\ <<\ \textcolor{stringliteral}{"{})\ ="{}}\ <<\ fLeft\ <<\ \textcolor{stringliteral}{"{}\ ;\ "{}}\ <<\ left\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ shift\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ right\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00909\ \ \ \ \ \ \ assert((\mbox{\hyperlink{namespaceEigen_1_1numext_a2453ca8f9a4be71354074d0f9bf734c8}{numext::isfinite}})(fLeft));}
\DoxyCodeLine{00910\ }
\DoxyCodeLine{00911\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!(\mbox{\hyperlink{namespaceEigen_1_1numext_a2453ca8f9a4be71354074d0f9bf734c8}{numext::isfinite}})(fRight))}
\DoxyCodeLine{00912\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}f("{}}\ <<\ rightShifted\ <<\ \textcolor{stringliteral}{"{})\ ="{}}\ <<\ fRight\ <<\ \textcolor{stringliteral}{"{}\ ;\ "{}}\ <<\ left\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ shift\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ right\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00913\ \ \ \ \ \ \ \textcolor{comment}{//\ assert((numext::isfinite)(fRight));}}
\DoxyCodeLine{00914\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00915\ \ \ \ \ }
\DoxyCodeLine{00916\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00917\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!(fLeft\ *\ fRight<0))}
\DoxyCodeLine{00918\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00919\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}f(leftShifted)\ using\ \ leftShifted="{}}\ <<\ leftShifted\ <<\ \textcolor{stringliteral}{"{}\ ;\ \ diagShifted(1:10):"{}}\ <<\ diagShifted.head(10).transpose()\ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\ ;\ "{}}}
\DoxyCodeLine{00920\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}left==shift="{}}\ <<\ \mbox{\hyperlink{namespaceexport__hf_a3b79f4dc99a74534a694b2cd70b161bd}{bool}}(left==shift)\ <<\ \textcolor{stringliteral}{"{}\ ;\ left-\/shift\ =\ "{}}\ <<\ (left-\/shift)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00921\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}k="{}}\ <<\ k\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ \ fLeft\ <<\ \textcolor{stringliteral}{"{}\ *\ "{}}\ <<\ fRight\ <<\ \textcolor{stringliteral}{"{}\ ==\ "{}}\ <<\ fLeft\ *\ fRight\ <<\ \textcolor{stringliteral}{"{}\ \ ;\ \ "{}}}
\DoxyCodeLine{00922\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}["{}}\ <<\ left\ <<\ \textcolor{stringliteral}{"{}\ ..\ "{}}\ <<\ right\ <<\ \textcolor{stringliteral}{"{}]\ -\/>\ ["{}}\ <<\ leftShifted\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ rightShifted\ <<\ \textcolor{stringliteral}{"{}],\ shift="{}}\ <<\ shift}
\DoxyCodeLine{00923\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ ,\ \ f(right)="{}}\ <<\ secularEq(0,\ \ \ \ \ col0,\ diag,\ perm,\ diagShifted,\ shift)}
\DoxyCodeLine{00924\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ ==\ "{}}\ <<\ secularEq(right,\ col0,\ diag,\ perm,\ diag,\ 0)\ <<\ \textcolor{stringliteral}{"{}\ ==\ "{}}\ <<\ fRight\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00925\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00926\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00927\ \ \ \ \ \ \ \mbox{\hyperlink{Macros_8h_a4e742b5a08636a61784c0e173b61e710}{eigen\_internal\_assert}}(fLeft\ *\ fRight\ <\ Literal(0));}
\DoxyCodeLine{00928\ }
\DoxyCodeLine{00929\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(fLeft<Literal(0))}
\DoxyCodeLine{00930\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00931\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (rightShifted\ -\/\ leftShifted\ >\ Literal(2)\ *\ \mbox{\hyperlink{structEigen_1_1GenericNumTraits_a3a573c69713fbb143fb49af7db463cee}{NumTraits<RealScalar>::epsilon}}()\ *\ \mbox{\hyperlink{namespaceEigen_1_1numext_a29d502349f2ec9897c808e65e0f96eb4}{numext::maxi<RealScalar>}}(\mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(leftShifted),\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(rightShifted)))}
\DoxyCodeLine{00932\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00933\ \ \ \ \ \ \ \ \ \ \ RealScalar\ midShifted\ =\ (leftShifted\ +\ rightShifted)\ /\ Literal(2);}
\DoxyCodeLine{00934\ \ \ \ \ \ \ \ \ \ \ fMid\ =\ secularEq(midShifted,\ col0,\ diag,\ perm,\ diagShifted,\ shift);}
\DoxyCodeLine{00935\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{Macros_8h_a4e742b5a08636a61784c0e173b61e710}{eigen\_internal\_assert}}((\mbox{\hyperlink{namespaceEigen_1_1numext_a2453ca8f9a4be71354074d0f9bf734c8}{numext::isfinite}})(fMid));}
\DoxyCodeLine{00936\ }
\DoxyCodeLine{00937\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fLeft\ *\ fMid\ <\ Literal(0))}
\DoxyCodeLine{00938\ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00939\ \ \ \ \ \ \ \ \ \ \ \ \ rightShifted\ =\ midShifted;}
\DoxyCodeLine{00940\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00941\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00942\ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00943\ \ \ \ \ \ \ \ \ \ \ \ \ leftShifted\ =\ midShifted;}
\DoxyCodeLine{00944\ \ \ \ \ \ \ \ \ \ \ \ \ fLeft\ =\ fMid;}
\DoxyCodeLine{00945\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00946\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00947\ \ \ \ \ \ \ \ \ muCur\ =\ (leftShifted\ +\ rightShifted)\ /\ Literal(2);}
\DoxyCodeLine{00948\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00949\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ }
\DoxyCodeLine{00950\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00951\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ have\ a\ problem\ as\ shifting\ on\ the\ left\ or\ right\ give\ either\ a\ positive\ or\ negative\ value}}
\DoxyCodeLine{00952\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ at\ the\ middle\ of\ [left,right]...}}
\DoxyCodeLine{00953\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Instead\ fo\ abbording\ or\ entering\ an\ infinite\ loop,}}
\DoxyCodeLine{00954\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ let's\ just\ use\ the\ middle\ as\ the\ estimated\ zero-\/crossing:}}
\DoxyCodeLine{00955\ \ \ \ \ \ \ \ \ muCur\ =\ (right\ -\/\ left)\ *\ RealScalar(0.5);}
\DoxyCodeLine{00956\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(shift\ ==\ right)}
\DoxyCodeLine{00957\ \ \ \ \ \ \ \ \ \ \ muCur\ =\ -\/muCur;}
\DoxyCodeLine{00958\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00959\ \ \ \ \ \}}
\DoxyCodeLine{00960\ \ \ \ \ \ \ }
\DoxyCodeLine{00961\ \ \ \ \ singVals[k]\ =\ shift\ +\ muCur;}
\DoxyCodeLine{00962\ \ \ \ \ shifts[k]\ =\ shift;}
\DoxyCodeLine{00963\ \ \ \ \ mus[k]\ =\ muCur;}
\DoxyCodeLine{00964\ }
\DoxyCodeLine{00965\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00966\ \ \ \ \ \textcolor{keywordflow}{if}(k+1<\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}})}
\DoxyCodeLine{00967\ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}found\ "{}}\ <<\ singVals[k]\ <<\ \textcolor{stringliteral}{"{}\ ==\ "{}}\ <<\ shift\ <<\ \textcolor{stringliteral}{"{}\ +\ "{}}\ <<\ muCur\ <<\ \textcolor{stringliteral}{"{}\ from\ "{}}\ <<\ diag(k)\ <<\ \textcolor{stringliteral}{"{}\ ..\ "{}}\ \ <<\ diag(k+1)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00968\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00969\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00970\ \ \ \ \ assert(k==0\ ||\ singVals[k]>=singVals[k-\/1]);}
\DoxyCodeLine{00971\ \ \ \ \ assert(singVals[k]>=diag(k));}
\DoxyCodeLine{00972\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00973\ }
\DoxyCodeLine{00974\ \ \ \ \ \textcolor{comment}{//\ perturb\ singular\ value\ slightly\ if\ it\ equals\ diagonal\ entry\ to\ avoid\ division\ by\ zero\ later}}
\DoxyCodeLine{00975\ \ \ \ \ \textcolor{comment}{//\ (deflation\ is\ supposed\ to\ avoid\ this\ from\ happening)}}
\DoxyCodeLine{00976\ \ \ \ \ \textcolor{comment}{//\ -\/\ this\ does\ no\ seem\ to\ be\ necessary\ anymore\ -\/}}
\DoxyCodeLine{00977\ \textcolor{comment}{//\ \ \ \ \ if\ (singVals[k]\ ==\ left)\ singVals[k]\ *=\ 1\ +\ NumTraits<RealScalar>::epsilon();}}
\DoxyCodeLine{00978\ \textcolor{comment}{//\ \ \ \ \ if\ (singVals[k]\ ==\ right)\ singVals[k]\ *=\ 1\ -\/\ NumTraits<RealScalar>::epsilon();}}
\DoxyCodeLine{00979\ \ \ \}}
\DoxyCodeLine{00980\ \}}
\DoxyCodeLine{00981\ }
\DoxyCodeLine{00982\ }
\DoxyCodeLine{00983\ \textcolor{comment}{//\ zhat\ is\ perturbation\ of\ col0\ for\ which\ singular\ vectors\ can\ be\ computed\ stably\ (see\ Section\ 3.1)}}
\DoxyCodeLine{00984\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00985\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::perturbCol0}
\DoxyCodeLine{00986\ \ \ \ (\textcolor{keyword}{const}\ ArrayRef\&\ col0,\ \textcolor{keyword}{const}\ ArrayRef\&\ diag,\ \textcolor{keyword}{const}\ IndicesRef\ \&perm,\ \textcolor{keyword}{const}\ VectorType\&\ singVals,}
\DoxyCodeLine{00987\ \ \ \ \ \textcolor{keyword}{const}\ ArrayRef\&\ shifts,\ \textcolor{keyword}{const}\ ArrayRef\&\ mus,\ ArrayRef\ zhat)}
\DoxyCodeLine{00988\ \{}
\DoxyCodeLine{00989\ \ \ \textcolor{keyword}{using\ }std::sqrt;}
\DoxyCodeLine{00990\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ =\ col0.size();}
\DoxyCodeLine{00991\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ m\ =\ perm.size();}
\DoxyCodeLine{00992\ \ \ \textcolor{keywordflow}{if}(m==0)}
\DoxyCodeLine{00993\ \ \ \{}
\DoxyCodeLine{00994\ \ \ \ \ zhat.setZero();}
\DoxyCodeLine{00995\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00996\ \ \ \}}
\DoxyCodeLine{00997\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ lastIdx\ =\ perm(m-\/1);}
\DoxyCodeLine{00998\ \ \ \textcolor{comment}{//\ The\ offset\ permits\ to\ skip\ deflated\ entries\ while\ computing\ zhat}}
\DoxyCodeLine{00999\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ k\ =\ 0;\ k\ <\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}};\ ++k)}
\DoxyCodeLine{01000\ \ \ \{}
\DoxyCodeLine{01001\ \ \ \ \ \textcolor{keywordflow}{if}\ (col0(k)\ ==\ Literal(0))\ \textcolor{comment}{//\ deflated}}
\DoxyCodeLine{01002\ \ \ \ \ \ \ zhat(k)\ =\ Literal(0);}
\DoxyCodeLine{01003\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01004\ \ \ \ \ \{}
\DoxyCodeLine{01005\ \ \ \ \ \ \ \textcolor{comment}{//\ see\ equation\ (3.6)}}
\DoxyCodeLine{01006\ \ \ \ \ \ \ RealScalar\ dk\ =\ diag(k);}
\DoxyCodeLine{01007\ \ \ \ \ \ \ RealScalar\ prod\ =\ (singVals(lastIdx)\ +\ dk)\ *\ (mus(lastIdx)\ +\ (shifts(lastIdx)\ -\/\ dk));}
\DoxyCodeLine{01008\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{01009\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(prod<0)\ \{}
\DoxyCodeLine{01010\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}k\ =\ "{}}\ <<\ k\ <<\ \textcolor{stringliteral}{"{}\ ;\ \ z(k)="{}}\ <<\ col0(k)\ <<\ \textcolor{stringliteral}{"{},\ diag(k)="{}}\ <<\ dk\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01011\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}prod\ =\ "{}}\ <<\ \textcolor{stringliteral}{"{}("{}}\ <<\ singVals(lastIdx)\ <<\ \textcolor{stringliteral}{"{}\ +\ "{}}\ <<\ dk\ <<\ \textcolor{stringliteral}{"{})\ *\ ("{}}\ <<\ mus(lastIdx)\ <<\ \textcolor{stringliteral}{"{}\ +\ ("{}}\ <<\ shifts(lastIdx)\ <<\ \textcolor{stringliteral}{"{}\ -\/\ "{}}\ <<\ dk\ <<\ \textcolor{stringliteral}{"{}))"{}}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01012\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ \ \ \ =\ "{}}\ <<\ singVals(lastIdx)\ +\ dk\ <<\ \textcolor{stringliteral}{"{}\ *\ "{}}\ <<\ mus(lastIdx)\ +\ (shifts(lastIdx)\ -\/\ dk)\ <<\ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01013\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01014\ \ \ \ \ \ \ assert(prod>=0);}
\DoxyCodeLine{01015\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01016\ }
\DoxyCodeLine{01017\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ l\ =\ 0;\ \mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba2db95e8e1a9267b7a1188556b2013b33}{l}}<m;\ ++\mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba2db95e8e1a9267b7a1188556b2013b33}{l}})}
\DoxyCodeLine{01018\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01019\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ =\ perm(l);}
\DoxyCodeLine{01020\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}!=k)}
\DoxyCodeLine{01021\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01022\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{01023\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}>=k\ \&\&\ (l==0\ ||\ l-\/1>=m))}
\DoxyCodeLine{01024\ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01025\ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Error\ in\ perturbCol0\(\backslash\)n"{}};}
\DoxyCodeLine{01026\ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ "{}}\ <<\ k\ <<\ \textcolor{stringliteral}{"{}/"{}}\ <<\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ <<\ \mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba2db95e8e1a9267b7a1188556b2013b33}{l}}\ <<\ \textcolor{stringliteral}{"{}/"{}}\ <<\ m\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ <<\ \textcolor{stringliteral}{"{}/"{}}\ <<\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ <<\ \textcolor{stringliteral}{"{}\ ;\ "{}}\ <<\ col0(k)\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ diag(k)\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ <<\ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01027\ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ "{}}\ <<diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01028\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba363b122c528f54df4a0446b6bab05515}{j}}\ =\ (\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}<k\ \textcolor{comment}{/*||\ l==0*/})\ ?\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ :\ perm(\mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba2db95e8e1a9267b7a1188556b2013b33}{l}}-\/1);}
\DoxyCodeLine{01029\ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ "{}}\ <<\ \textcolor{stringliteral}{"{}j="{}}\ <<\ \mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba363b122c528f54df4a0446b6bab05515}{j}}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01030\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01031\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01032\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba363b122c528f54df4a0446b6bab05515}{j}}\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}<k\ ?\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ :\ perm(l-\/1);}
\DoxyCodeLine{01033\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{01034\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!(dk!=Literal(0)\ ||\ diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})!=Literal(0)))}
\DoxyCodeLine{01035\ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01036\ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}k="{}}\ <<\ k\ <<\ \textcolor{stringliteral}{"{},\ i="{}}\ <<\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ <<\ \textcolor{stringliteral}{"{},\ l="{}}\ <<\ \mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba2db95e8e1a9267b7a1188556b2013b33}{l}}\ <<\ \textcolor{stringliteral}{"{},\ perm.size()="{}}\ <<\ perm.size()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01037\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01038\ \ \ \ \ \ \ \ \ \ \ assert(dk!=Literal(0)\ ||\ diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})!=Literal(0));}
\DoxyCodeLine{01039\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01040\ \ \ \ \ \ \ \ \ \ \ prod\ *=\ ((singVals(j)+dk)\ /\ ((diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})+dk)))\ *\ ((mus(j)+(shifts(j)-\/dk))\ /\ ((diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})-\/dk)));}
\DoxyCodeLine{01041\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{01042\ \ \ \ \ \ \ \ \ \ \ assert(prod>=0);}
\DoxyCodeLine{01043\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01044\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{01045\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}!=k\ \&\&\ \mbox{\hyperlink{namespaceEigen_1_1numext_ac09cd9261a50a46dd4937868020c7c45}{numext::abs}}(((singVals(j)+dk)*(mus(j)+(shifts(j)-\/dk)))/((diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})+dk)*(diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})-\/dk))\ -\/\ 1)\ >\ 0.9\ )}
\DoxyCodeLine{01046\ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ \ \ \ "{}}\ <<\ ((singVals(j)+dk)*(mus(j)+(shifts(j)-\/dk)))/((diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})+dk)*(diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})-\/dk))\ <<\ \textcolor{stringliteral}{"{}\ ==\ ("{}}\ <<\ (singVals(j)+dk)\ <<\ \textcolor{stringliteral}{"{}\ *\ "{}}\ <<\ (mus(j)+(shifts(j)-\/dk))}
\DoxyCodeLine{01047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{})\ /\ ("{}}\ <<\ (diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})+dk)\ <<\ \textcolor{stringliteral}{"{}\ *\ "{}}\ <<\ (diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})-\/dk)\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}};}
\DoxyCodeLine{01048\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01049\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01050\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01051\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{01052\ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}zhat("{}}\ <<\ k\ <<\ \textcolor{stringliteral}{"{})\ =\ \ sqrt(\ "{}}\ <<\ prod\ <<\ \textcolor{stringliteral}{"{})\ \ ;\ \ "{}}\ <<\ (singVals(lastIdx)\ +\ dk)\ <<\ \textcolor{stringliteral}{"{}\ *\ "{}}\ <<\ mus(lastIdx)\ +\ shifts(lastIdx)\ <<\ \textcolor{stringliteral}{"{}\ -\/\ "{}}\ <<\ dk\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01053\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01054\ \ \ \ \ \ \ RealScalar\ tmp\ =\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a656b9217a2fcb6de59dc8d1eb3079cc7}{sqrt}}(prod);}
\DoxyCodeLine{01055\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{01056\ \ \ \ \ \ \ assert((\mbox{\hyperlink{namespaceEigen_1_1numext_a2453ca8f9a4be71354074d0f9bf734c8}{numext::isfinite}})(tmp));}
\DoxyCodeLine{01057\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01058\ \ \ \ \ \ \ zhat(k)\ =\ col0(k)\ >\ Literal(0)\ ?\ RealScalar(tmp)\ :\ RealScalar(-\/tmp);}
\DoxyCodeLine{01059\ \ \ \ \ \}}
\DoxyCodeLine{01060\ \ \ \}}
\DoxyCodeLine{01061\ \}}
\DoxyCodeLine{01062\ }
\DoxyCodeLine{01063\ \textcolor{comment}{//\ compute\ singular\ vectors}}
\DoxyCodeLine{01064\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{01065\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::computeSingVecs}
\DoxyCodeLine{01066\ \ \ \ (\textcolor{keyword}{const}\ ArrayRef\&\ zhat,\ \textcolor{keyword}{const}\ ArrayRef\&\ diag,\ \textcolor{keyword}{const}\ IndicesRef\ \&perm,\ \textcolor{keyword}{const}\ VectorType\&\ singVals,}
\DoxyCodeLine{01067\ \ \ \ \ \textcolor{keyword}{const}\ ArrayRef\&\ shifts,\ \textcolor{keyword}{const}\ ArrayRef\&\ mus,\ MatrixXr\&\ U,\ MatrixXr\&\ V)}
\DoxyCodeLine{01068\ \{}
\DoxyCodeLine{01069\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}\ =\ zhat.size();}
\DoxyCodeLine{01070\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ m\ =\ perm.size();}
\DoxyCodeLine{01071\ \ \ }
\DoxyCodeLine{01072\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ k\ =\ 0;\ k\ <\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}};\ ++k)}
\DoxyCodeLine{01073\ \ \ \{}
\DoxyCodeLine{01074\ \ \ \ \ \textcolor{keywordflow}{if}\ (zhat(k)\ ==\ Literal(0))}
\DoxyCodeLine{01075\ \ \ \ \ \{}
\DoxyCodeLine{01076\ \ \ \ \ \ \ U.col(k)\ =\ VectorType::Unit(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}+1,\ k);}
\DoxyCodeLine{01077\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ V.col(k)\ =\ VectorType::Unit(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},\ k);}
\DoxyCodeLine{01078\ \ \ \ \ \}}
\DoxyCodeLine{01079\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01080\ \ \ \ \ \{}
\DoxyCodeLine{01081\ \ \ \ \ \ \ U.col(k).setZero();}
\DoxyCodeLine{01082\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ l=0;\mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba2db95e8e1a9267b7a1188556b2013b33}{l}}<m;++\mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba2db95e8e1a9267b7a1188556b2013b33}{l}})}
\DoxyCodeLine{01083\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01084\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ =\ perm(l);}
\DoxyCodeLine{01085\ \ \ \ \ \ \ \ \ U(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},k)\ =\ zhat(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})/(((diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ -\/\ shifts(k))\ -\/\ mus(k))\ )/(\ (diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ +\ singVals[k]));}
\DoxyCodeLine{01086\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01087\ \ \ \ \ \ \ U(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}},k)\ =\ Literal(0);}
\DoxyCodeLine{01088\ \ \ \ \ \ \ U.col(k).normalize();}
\DoxyCodeLine{01089\ \ \ \ \ }
\DoxyCodeLine{01090\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_compV)}
\DoxyCodeLine{01091\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01092\ \ \ \ \ \ \ \ \ V.col(k).setZero();}
\DoxyCodeLine{01093\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ l=1;\mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba2db95e8e1a9267b7a1188556b2013b33}{l}}<m;++\mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba2db95e8e1a9267b7a1188556b2013b33}{l}})}
\DoxyCodeLine{01094\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01095\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ =\ perm(l);}
\DoxyCodeLine{01096\ \ \ \ \ \ \ \ \ \ \ V(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},k)\ =\ diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ *\ zhat(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ /\ (((diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ -\/\ shifts(k))\ -\/\ mus(k))\ )/(\ (diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ +\ singVals[k]));}
\DoxyCodeLine{01097\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01098\ \ \ \ \ \ \ \ \ V(0,k)\ =\ Literal(-\/1);}
\DoxyCodeLine{01099\ \ \ \ \ \ \ \ \ V.col(k).normalize();}
\DoxyCodeLine{01100\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01101\ \ \ \ \ \}}
\DoxyCodeLine{01102\ \ \ \}}
\DoxyCodeLine{01103\ \ \ U.col(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}})\ =\ VectorType::Unit(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}}+1,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__test_8cc_a76f11d9a0a47b94f72c2d0e77fb32240}{n}});}
\DoxyCodeLine{01104\ \}}
\DoxyCodeLine{01105\ }
\DoxyCodeLine{01106\ }
\DoxyCodeLine{01107\ \textcolor{comment}{//\ page\ 12\_13}}
\DoxyCodeLine{01108\ \textcolor{comment}{//\ i\ >=\ 1,\ di\ almost\ null\ and\ zi\ non\ null.}}
\DoxyCodeLine{01109\ \textcolor{comment}{//\ We\ use\ a\ rotation\ to\ zero\ out\ zi\ applied\ to\ the\ left\ of\ M}}
\DoxyCodeLine{01110\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{01111\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::deflation43(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ firstCol,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ shift,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2base_2internal_2low__level__alloc_8cc_aad9b71a31372d5c0ab9c23163efe9544}{size}})}
\DoxyCodeLine{01112\ \{}
\DoxyCodeLine{01113\ \ \ \textcolor{keyword}{using\ }std::abs;}
\DoxyCodeLine{01114\ \ \ \textcolor{keyword}{using\ }std::sqrt;}
\DoxyCodeLine{01115\ \ \ \textcolor{keyword}{using\ }std::pow;}
\DoxyCodeLine{01116\ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ start\ =\ firstCol\ +\ shift;}
\DoxyCodeLine{01117\ \ \ RealScalar\ \mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca4a8a08f09d37b73795649038408b5f33}{c}}\ =\ m\_computed(start,\ start);}
\DoxyCodeLine{01118\ \ \ RealScalar\ \mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca03c7c0ace395d80182db07ae2c30f034}{s}}\ =\ m\_computed(start+\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ start);}
\DoxyCodeLine{01119\ \ \ RealScalar\ r\ =\ numext::hypot(c,s);}
\DoxyCodeLine{01120\ \ \ \textcolor{keywordflow}{if}\ (r\ ==\ Literal(0))}
\DoxyCodeLine{01121\ \ \ \{}
\DoxyCodeLine{01122\ \ \ \ \ m\_computed(start+\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ start+\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ =\ Literal(0);}
\DoxyCodeLine{01123\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01124\ \ \ \}}
\DoxyCodeLine{01125\ \ \ m\_computed(start,start)\ =\ r;\ \ }
\DoxyCodeLine{01126\ \ \ m\_computed(start+\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ start)\ =\ Literal(0);}
\DoxyCodeLine{01127\ \ \ m\_computed(start+\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ start+\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ =\ Literal(0);}
\DoxyCodeLine{01128\ \ \ }
\DoxyCodeLine{01129\ \ \ JacobiRotation<RealScalar>\ J(c/r,-\/s/r);}
\DoxyCodeLine{01130\ \ \ \textcolor{keywordflow}{if}\ (m\_compU)\ \ m\_naiveU.middleRows(firstCol,\ \mbox{\hyperlink{abseil-cpp_2absl_2base_2internal_2low__level__alloc_8cc_aad9b71a31372d5c0ab9c23163efe9544}{size}}+1).applyOnTheRight(firstCol,\ firstCol+\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ J);}
\DoxyCodeLine{01131\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ m\_naiveU.applyOnTheRight(firstCol,\ firstCol+\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ J);}
\DoxyCodeLine{01132\ \}\textcolor{comment}{//\ end\ deflation\ 43}}
\DoxyCodeLine{01133\ }
\DoxyCodeLine{01134\ }
\DoxyCodeLine{01135\ \textcolor{comment}{//\ page\ 13}}
\DoxyCodeLine{01136\ \textcolor{comment}{//\ i,j\ >=\ 1,\ i!=j\ and\ |di\ -\/\ dj|\ <\ epsilon\ *\ norm2(M)}}
\DoxyCodeLine{01137\ \textcolor{comment}{//\ We\ apply\ two\ rotations\ to\ have\ zj\ =\ 0;}}
\DoxyCodeLine{01138\ \textcolor{comment}{//\ TODO\ deflation44\ is\ still\ broken\ and\ not\ properly\ tested}}
\DoxyCodeLine{01139\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{01140\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::deflation44(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ firstColu\ ,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ firstColm,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ firstRowW,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ firstColW,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ j,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2base_2internal_2low__level__alloc_8cc_aad9b71a31372d5c0ab9c23163efe9544}{size}})}
\DoxyCodeLine{01141\ \{}
\DoxyCodeLine{01142\ \ \ \textcolor{keyword}{using\ }std::abs;}
\DoxyCodeLine{01143\ \ \ \textcolor{keyword}{using\ }std::sqrt;}
\DoxyCodeLine{01144\ \ \ \textcolor{keyword}{using\ }std::conj;}
\DoxyCodeLine{01145\ \ \ \textcolor{keyword}{using\ }std::pow;}
\DoxyCodeLine{01146\ \ \ RealScalar\ \mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca4a8a08f09d37b73795649038408b5f33}{c}}\ =\ m\_computed(firstColm+\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ firstColm);}
\DoxyCodeLine{01147\ \ \ RealScalar\ \mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca03c7c0ace395d80182db07ae2c30f034}{s}}\ =\ m\_computed(firstColm+j,\ firstColm);}
\DoxyCodeLine{01148\ \ \ RealScalar\ r\ =\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a656b9217a2fcb6de59dc8d1eb3079cc7}{sqrt}}(\mbox{\hyperlink{namespaceEigen_1_1numext_ad59216129a430099e97b4c4b1e2f2984}{numext::abs2}}(c)\ +\ \mbox{\hyperlink{namespaceEigen_1_1numext_ad59216129a430099e97b4c4b1e2f2984}{numext::abs2}}(s));}
\DoxyCodeLine{01149\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{01150\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}deflation\ 4.4:\ "{}}\ <<\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ <<\ \textcolor{stringliteral}{"{},"{}}\ <<\ \mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba363b122c528f54df4a0446b6bab05515}{j}}\ <<\ \textcolor{stringliteral}{"{}\ -\/>\ "{}}\ <<\ \mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca4a8a08f09d37b73795649038408b5f33}{c}}\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ \mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca03c7c0ace395d80182db07ae2c30f034}{s}}\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ r\ <<\ \textcolor{stringliteral}{"{}\ ;\ "{}}}
\DoxyCodeLine{01151\ \ \ \ \ <<\ m\_computed(firstColm\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}-\/1,\ firstColm)\ \ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{01152\ \ \ \ \ <<\ m\_computed(firstColm\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ firstColm)\ \ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{01153\ \ \ \ \ <<\ m\_computed(firstColm\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}+1,\ firstColm)\ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{01154\ \ \ \ \ <<\ m\_computed(firstColm\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}+2,\ firstColm)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01155\ \ \ std::cout\ <<\ m\_computed(firstColm\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}-\/1,\ firstColm\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}-\/1)\ \ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{01156\ \ \ \ \ <<\ m\_computed(firstColm\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ firstColm+\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ \ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{01157\ \ \ \ \ <<\ m\_computed(firstColm\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}+1,\ firstColm+\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}+1)\ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{01158\ \ \ \ \ <<\ m\_computed(firstColm\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}+2,\ firstColm+\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}+2)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01159\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01160\ \ \ \textcolor{keywordflow}{if}\ (r==Literal(0))}
\DoxyCodeLine{01161\ \ \ \{}
\DoxyCodeLine{01162\ \ \ \ \ m\_computed(firstColm\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ firstColm\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ =\ m\_computed(firstColm\ +\ j,\ firstColm\ +\ j);}
\DoxyCodeLine{01163\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01164\ \ \ \}}
\DoxyCodeLine{01165\ \ \ \mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca4a8a08f09d37b73795649038408b5f33}{c}}/=r;}
\DoxyCodeLine{01166\ \ \ \mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca03c7c0ace395d80182db07ae2c30f034}{s}}/=r;}
\DoxyCodeLine{01167\ \ \ m\_computed(firstColm\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ firstColm)\ =\ r;}
\DoxyCodeLine{01168\ \ \ m\_computed(firstColm\ +\ j,\ firstColm\ +\ j)\ =\ m\_computed(firstColm\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ firstColm\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}});}
\DoxyCodeLine{01169\ \ \ m\_computed(firstColm\ +\ j,\ firstColm)\ =\ Literal(0);}
\DoxyCodeLine{01170\ }
\DoxyCodeLine{01171\ \ \ JacobiRotation<RealScalar>\ J(c,-\/s);}
\DoxyCodeLine{01172\ \ \ \textcolor{keywordflow}{if}\ (m\_compU)\ \ m\_naiveU.middleRows(firstColu,\ \mbox{\hyperlink{abseil-cpp_2absl_2base_2internal_2low__level__alloc_8cc_aad9b71a31372d5c0ab9c23163efe9544}{size}}+1).applyOnTheRight(firstColu\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ firstColu\ +\ j,\ J);}
\DoxyCodeLine{01173\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ m\_naiveU.applyOnTheRight(firstColu+\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ firstColu+j,\ J);}
\DoxyCodeLine{01174\ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ \ m\_naiveV.middleRows(firstRowW,\ \mbox{\hyperlink{abseil-cpp_2absl_2base_2internal_2low__level__alloc_8cc_aad9b71a31372d5c0ab9c23163efe9544}{size}}).applyOnTheRight(firstColW\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ firstColW\ +\ j,\ J);}
\DoxyCodeLine{01175\ \}\textcolor{comment}{//\ end\ deflation\ 44}}
\DoxyCodeLine{01176\ }
\DoxyCodeLine{01177\ }
\DoxyCodeLine{01178\ \textcolor{comment}{//\ acts\ on\ block\ from\ (firstCol+shift,\ firstCol+shift)\ to\ (lastCol+shift,\ lastCol+shift)\ [inclusive]}}
\DoxyCodeLine{01179\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{01180\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::deflation(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ firstCol,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ lastCol,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ k,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ firstRowW,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ firstColW,\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}}\ shift)}
\DoxyCodeLine{01181\ \{}
\DoxyCodeLine{01182\ \ \ \textcolor{keyword}{using\ }std::sqrt;}
\DoxyCodeLine{01183\ \ \ \textcolor{keyword}{using\ }std::abs;}
\DoxyCodeLine{01184\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ length\ =\ lastCol\ +\ 1\ -\/\ firstCol;}
\DoxyCodeLine{01185\ \ \ }
\DoxyCodeLine{01186\ \ \ Block<MatrixXr,Dynamic,1>\ col0(m\_computed,\ firstCol+shift,\ firstCol+shift,\ length,\ 1);}
\DoxyCodeLine{01187\ \ \ Diagonal<MatrixXr>\ fulldiag(m\_computed);}
\DoxyCodeLine{01188\ \ \ VectorBlock<Diagonal<MatrixXr>,Dynamic>\ diag(fulldiag,\ firstCol+shift,\ length);}
\DoxyCodeLine{01189\ \ \ }
\DoxyCodeLine{01190\ \ \ \textcolor{keyword}{const}\ RealScalar\ considerZero\ =\ (std::numeric\_limits<RealScalar>::min)();}
\DoxyCodeLine{01191\ \ \ RealScalar\ maxDiag\ =\ diag.tail((std::max)(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}(1),length-\/1)).cwiseAbs().maxCoeff();}
\DoxyCodeLine{01192\ \ \ RealScalar\ epsilon\_strict\ =\ \mbox{\hyperlink{namespaceEigen_1_1numext_a29d502349f2ec9897c808e65e0f96eb4}{numext::maxi<RealScalar>}}(considerZero,\mbox{\hyperlink{structEigen_1_1GenericNumTraits_a3a573c69713fbb143fb49af7db463cee}{NumTraits<RealScalar>::epsilon}}()\ *\ maxDiag);}
\DoxyCodeLine{01193\ \ \ RealScalar\ epsilon\_coarse\ =\ Literal(8)\ *\ \mbox{\hyperlink{structEigen_1_1GenericNumTraits_a3a573c69713fbb143fb49af7db463cee}{NumTraits<RealScalar>::epsilon}}()\ *\ \mbox{\hyperlink{namespaceEigen_1_1numext_a29d502349f2ec9897c808e65e0f96eb4}{numext::maxi<RealScalar>}}(col0.cwiseAbs().maxCoeff(),\ maxDiag);}
\DoxyCodeLine{01194\ \ \ }
\DoxyCodeLine{01195\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{01196\ \ \ assert(m\_naiveU.allFinite());}
\DoxyCodeLine{01197\ \ \ assert(m\_naiveV.allFinite());}
\DoxyCodeLine{01198\ \ \ assert(m\_computed.allFinite());}
\DoxyCodeLine{01199\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01200\ }
\DoxyCodeLine{01201\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE\ \ }}
\DoxyCodeLine{01202\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)ndeflate:"{}}\ <<\ diag.head(k+1).transpose()\ <<\ \textcolor{stringliteral}{"{}\ \ |\ \ "{}}\ <<\ diag.segment(k+1,length-\/k-\/1).transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01203\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01204\ \ \ }
\DoxyCodeLine{01205\ \ \ \textcolor{comment}{//condition\ 4.1}}
\DoxyCodeLine{01206\ \ \ \textcolor{keywordflow}{if}\ (diag(0)\ <\ epsilon\_coarse)}
\DoxyCodeLine{01207\ \ \ \{\ }
\DoxyCodeLine{01208\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{01209\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}deflation\ 4.1,\ because\ "{}}\ <<\ diag(0)\ <<\ \textcolor{stringliteral}{"{}\ <\ "{}}\ <<\ epsilon\_coarse\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01210\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01211\ \ \ \ \ diag(0)\ =\ epsilon\_coarse;}
\DoxyCodeLine{01212\ \ \ \}}
\DoxyCodeLine{01213\ }
\DoxyCodeLine{01214\ \ \ \textcolor{comment}{//condition\ 4.2}}
\DoxyCodeLine{01215\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}=1;\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}<length;++\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})}
\DoxyCodeLine{01216\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(col0(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}))\ <\ epsilon\_strict)}
\DoxyCodeLine{01217\ \ \ \ \ \{}
\DoxyCodeLine{01218\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{01219\ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}deflation\ 4.2,\ set\ z("{}}\ <<\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ <<\ \textcolor{stringliteral}{"{})\ to\ zero\ because\ "{}}\ <<\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(col0(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}))\ <<\ \textcolor{stringliteral}{"{}\ <\ "{}}\ <<\ epsilon\_strict\ <<\ \textcolor{stringliteral}{"{}\ \ (diag("{}}\ <<\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ <<\ \textcolor{stringliteral}{"{})="{}}\ <<\ diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}};}
\DoxyCodeLine{01220\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01221\ \ \ \ \ \ \ col0(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ =\ Literal(0);}
\DoxyCodeLine{01222\ \ \ \ \ \}}
\DoxyCodeLine{01223\ }
\DoxyCodeLine{01224\ \ \ \textcolor{comment}{//condition\ 4.3}}
\DoxyCodeLine{01225\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}=1;\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}<length;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}++)}
\DoxyCodeLine{01226\ \ \ \ \ \textcolor{keywordflow}{if}\ (diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ <\ epsilon\_coarse)}
\DoxyCodeLine{01227\ \ \ \ \ \{}
\DoxyCodeLine{01228\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{01229\ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}deflation\ 4.3,\ cancel\ z("{}}\ <<\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ <<\ \textcolor{stringliteral}{"{})="{}}\ <<\ col0(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ <<\ \textcolor{stringliteral}{"{}\ because\ diag("{}}\ <<\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ <<\ \textcolor{stringliteral}{"{})="{}}\ <<\ diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ <<\ \textcolor{stringliteral}{"{}\ <\ "{}}\ <<\ epsilon\_coarse\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01230\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01231\ \ \ \ \ \ \ deflation43(firstCol,\ shift,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ length);}
\DoxyCodeLine{01232\ \ \ \ \ \}}
\DoxyCodeLine{01233\ }
\DoxyCodeLine{01234\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{01235\ \ \ assert(m\_naiveU.allFinite());}
\DoxyCodeLine{01236\ \ \ assert(m\_naiveV.allFinite());}
\DoxyCodeLine{01237\ \ \ assert(m\_computed.allFinite());}
\DoxyCodeLine{01238\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01239\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{01240\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}to\ be\ sorted:\ "{}}\ <<\ diag.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{01241\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ \ \ \ \ \ \ \ \ \ \ :\ "{}}\ <<\ col0.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{01242\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01243\ \ \ \{}
\DoxyCodeLine{01244\ \ \ \ \ \textcolor{comment}{//\ Check\ for\ total\ deflation}}
\DoxyCodeLine{01245\ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ a\ total\ deflation,\ then\ we\ have\ to\ consider\ col0(0)==diag(0)\ as\ a\ singular\ value\ during\ sorting}}
\DoxyCodeLine{01246\ \ \ \ \ \textcolor{keywordtype}{bool}\ total\_deflation\ =\ (col0.tail(length-\/1).array()<considerZero).all();}
\DoxyCodeLine{01247\ \ \ \ \ }
\DoxyCodeLine{01248\ \ \ \ \ \textcolor{comment}{//\ Sort\ the\ diagonal\ entries,\ since\ diag(1:k-\/1)\ and\ diag(k:length)\ are\ already\ sorted,\ let's\ do\ a\ sorted\ merge.}}
\DoxyCodeLine{01249\ \ \ \ \ \textcolor{comment}{//\ First,\ compute\ the\ respective\ permutation.}}
\DoxyCodeLine{01250\ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ *permutation\ =\ m\_workspaceI.data();}
\DoxyCodeLine{01251\ \ \ \ \ \{}
\DoxyCodeLine{01252\ \ \ \ \ \ \ permutation[0]\ =\ 0;}
\DoxyCodeLine{01253\ \ \ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca83878c91171338902e0fe0fb97a8c47a}{p}}\ =\ 1;}
\DoxyCodeLine{01254\ \ \ \ \ \ \ }
\DoxyCodeLine{01255\ \ \ \ \ \ \ \textcolor{comment}{//\ Move\ deflated\ diagonal\ entries\ at\ the\ end.}}
\DoxyCodeLine{01256\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}=1;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}<length;\ ++\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})}
\DoxyCodeLine{01257\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}))<considerZero)}
\DoxyCodeLine{01258\ \ \ \ \ \ \ \ \ \ \ permutation[\mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca83878c91171338902e0fe0fb97a8c47a}{p}}++]\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}};}
\DoxyCodeLine{01259\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01260\ \ \ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}=1,\ \mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba363b122c528f54df4a0446b6bab05515}{j}}=k+1;}
\DoxyCodeLine{01261\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ ;\ \mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca83878c91171338902e0fe0fb97a8c47a}{p}}\ <\ length;\ ++\mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca83878c91171338902e0fe0fb97a8c47a}{p}})}
\DoxyCodeLine{01262\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01263\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ >\ k)\ \ \ \ \ \ \ \ \ \ \ \ \ permutation[\mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca83878c91171338902e0fe0fb97a8c47a}{p}}]\ =\ \mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba363b122c528f54df4a0446b6bab05515}{j}}++;}
\DoxyCodeLine{01264\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (j\ >=\ length)\ \ \ \ \ \ \ permutation[\mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca83878c91171338902e0fe0fb97a8c47a}{p}}]\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}++;}
\DoxyCodeLine{01265\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ <\ diag(j))\ permutation[\mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca83878c91171338902e0fe0fb97a8c47a}{p}}]\ =\ \mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba363b122c528f54df4a0446b6bab05515}{j}}++;}
\DoxyCodeLine{01266\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ permutation[\mbox{\hyperlink{namespaceabsl_a828e0f13fb3947cdf6406b7a4feec8aca83878c91171338902e0fe0fb97a8c47a}{p}}]\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}++;}
\DoxyCodeLine{01267\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01268\ \ \ \ \ \}}
\DoxyCodeLine{01269\ \ \ \ \ }
\DoxyCodeLine{01270\ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ a\ total\ deflation,\ then\ we\ have\ to\ insert\ diag(0)\ at\ the\ right\ place}}
\DoxyCodeLine{01271\ \ \ \ \ \textcolor{keywordflow}{if}(total\_deflation)}
\DoxyCodeLine{01272\ \ \ \ \ \{}
\DoxyCodeLine{01273\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}=1;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}<length;\ ++\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})}
\DoxyCodeLine{01274\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01275\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ pi\ =\ permutation[\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}];}
\DoxyCodeLine{01276\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(diag(pi))<considerZero\ ||\ diag(0)<diag(pi))}
\DoxyCodeLine{01277\ \ \ \ \ \ \ \ \ \ \ permutation[\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}-\/1]\ =\ permutation[\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}];}
\DoxyCodeLine{01278\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01279\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01280\ \ \ \ \ \ \ \ \ \ \ permutation[\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}-\/1]\ =\ 0;}
\DoxyCodeLine{01281\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01282\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01283\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01284\ \ \ \ \ \}}
\DoxyCodeLine{01285\ \ \ \ \ }
\DoxyCodeLine{01286\ \ \ \ \ \textcolor{comment}{//\ Current\ index\ of\ each\ col,\ and\ current\ column\ of\ each\ index}}
\DoxyCodeLine{01287\ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ *realInd\ =\ m\_workspaceI.data()+length;}
\DoxyCodeLine{01288\ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ *realCol\ =\ m\_workspaceI.data()+2*length;}
\DoxyCodeLine{01289\ \ \ \ \ }
\DoxyCodeLine{01290\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ pos\ =\ 0;\ pos<\ length;\ pos++)}
\DoxyCodeLine{01291\ \ \ \ \ \{}
\DoxyCodeLine{01292\ \ \ \ \ \ \ realCol[pos]\ =\ pos;}
\DoxyCodeLine{01293\ \ \ \ \ \ \ realInd[pos]\ =\ pos;}
\DoxyCodeLine{01294\ \ \ \ \ \}}
\DoxyCodeLine{01295\ \ \ \ \ }
\DoxyCodeLine{01296\ \ \ \ \ \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ =\ total\_deflation?0:1;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ <\ length;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}++)}
\DoxyCodeLine{01297\ \ \ \ \ \{}
\DoxyCodeLine{01298\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ pi\ =\ permutation[length\ -\/\ (total\_deflation\ ?\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}+1\ :\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})];}
\DoxyCodeLine{01299\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ J\ =\ realCol[pi];}
\DoxyCodeLine{01300\ \ \ \ \ \ \ }
\DoxyCodeLine{01301\ \ \ \ \ \ \ \textcolor{keyword}{using\ }std::swap;}
\DoxyCodeLine{01302\ \ \ \ \ \ \ \textcolor{comment}{//\ swap\ diagonal\ and\ first\ column\ entries:}}
\DoxyCodeLine{01303\ \ \ \ \ \ \ swap(diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}),\ diag(J));}
\DoxyCodeLine{01304\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}!=0\ \&\&\ J!=0)\ swap(col0(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}),\ col0(J));}
\DoxyCodeLine{01305\ }
\DoxyCodeLine{01306\ \ \ \ \ \ \ \textcolor{comment}{//\ change\ columns}}
\DoxyCodeLine{01307\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_compU)\ m\_naiveU.col(firstCol+\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}).segment(firstCol,\ length\ +\ 1).swap(m\_naiveU.col(firstCol+J).segment(firstCol,\ length\ +\ 1));}
\DoxyCodeLine{01308\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ m\_naiveU.col(firstCol+\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}).segment(0,\ 2)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .swap(m\_naiveU.col(firstCol+J).segment(0,\ 2));}
\DoxyCodeLine{01309\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ m\_naiveV.col(firstColW\ +\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}).segment(firstRowW,\ length).swap(m\_naiveV.col(firstColW\ +\ J).segment(firstRowW,\ length));}
\DoxyCodeLine{01310\ }
\DoxyCodeLine{01311\ \ \ \ \ \ \ \textcolor{comment}{//update\ real\ pos}}
\DoxyCodeLine{01312\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ realI\ =\ realInd[\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}];}
\DoxyCodeLine{01313\ \ \ \ \ \ \ realCol[realI]\ =\ J;}
\DoxyCodeLine{01314\ \ \ \ \ \ \ realCol[pi]\ =\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}};}
\DoxyCodeLine{01315\ \ \ \ \ \ \ realInd[J]\ =\ realI;}
\DoxyCodeLine{01316\ \ \ \ \ \ \ realInd[\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}]\ =\ pi;}
\DoxyCodeLine{01317\ \ \ \ \ \}}
\DoxyCodeLine{01318\ \ \ \}}
\DoxyCodeLine{01319\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{01320\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}sorted:\ "{}}\ <<\ diag.transpose().format(bdcsvdfmt)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01321\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ \ \ \ \ :\ "{}}\ <<\ col0.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{01322\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01323\ \ \ \ \ }
\DoxyCodeLine{01324\ \ \ \textcolor{comment}{//condition\ 4.4}}
\DoxyCodeLine{01325\ \ \ \{}
\DoxyCodeLine{01326\ \ \ \ \ \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ =\ length-\/1;}
\DoxyCodeLine{01327\ \ \ \ \ \textcolor{keywordflow}{while}(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}>0\ \&\&\ (\mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}))<considerZero\ ||\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(col0(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}))<considerZero))\ -\/-\/\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}};}
\DoxyCodeLine{01328\ \ \ \ \ \textcolor{keywordflow}{for}(;\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}>1;-\/-\/\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})}
\DoxyCodeLine{01329\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ (diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ -\/\ diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}-\/1))\ <\ \mbox{\hyperlink{structEigen_1_1GenericNumTraits_a3a573c69713fbb143fb49af7db463cee}{NumTraits<RealScalar>::epsilon}}()*maxDiag\ )}
\DoxyCodeLine{01330\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01331\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{01332\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}deflation\ 4.4\ with\ i\ =\ "{}}\ <<\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}\ <<\ \textcolor{stringliteral}{"{}\ because\ "{}}\ <<\ diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ <<\ \textcolor{stringliteral}{"{}\ -\/\ "{}}\ <<\ diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}-\/1)\ <<\ \textcolor{stringliteral}{"{}\ ==\ "{}}\ <<\ (diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ -\/\ diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}-\/1))\ <<\ \textcolor{stringliteral}{"{}\ <\ "{}}\ <<\ \mbox{\hyperlink{structEigen_1_1GenericNumTraits_a3a573c69713fbb143fb49af7db463cee}{NumTraits<RealScalar>::epsilon}}()*\textcolor{comment}{/*diag(i)*/}maxDiag\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01333\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01334\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{Macros_8h_a4e742b5a08636a61784c0e173b61e710}{eigen\_internal\_assert}}(\mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}})\ -\/\ diag(\mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}-\/1))<epsilon\_coarse\ \&\&\ \textcolor{stringliteral}{"{}\ diagonal\ entries\ are\ not\ properly\ sorted"{}});}
\DoxyCodeLine{01335\ \ \ \ \ \ \ \ \ deflation44(firstCol,\ firstCol\ +\ shift,\ firstRowW,\ firstColW,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}}-\/1,\ \mbox{\hyperlink{abseil-cpp_2absl_2container_2btree__benchmark_8cc_a717c50cfde3924051c279a89096afd3d}{i}},\ length);}
\DoxyCodeLine{01336\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01337\ \ \ \}}
\DoxyCodeLine{01338\ \ \ }
\DoxyCodeLine{01339\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{01340\ \ \ \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}\ j=2;\mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba363b122c528f54df4a0446b6bab05515}{j}}<length;++\mbox{\hyperlink{namespaceabsl_adb6bd4a9012b471ac01613aff8d4d81ba363b122c528f54df4a0446b6bab05515}{j}})}
\DoxyCodeLine{01341\ \ \ \ \ assert(diag(j-\/1)<=diag(j)\ ||\ \mbox{\hyperlink{ArrayCwiseUnaryOps_8h_a35560f7dbf19244fda7e463d14157c43}{abs}}(diag(j))<considerZero);}
\DoxyCodeLine{01342\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01343\ \ \ }
\DoxyCodeLine{01344\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{01345\ \ \ assert(m\_naiveU.allFinite());}
\DoxyCodeLine{01346\ \ \ assert(m\_naiveV.allFinite());}
\DoxyCodeLine{01347\ \ \ assert(m\_computed.allFinite());}
\DoxyCodeLine{01348\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01349\ \}\textcolor{comment}{//end\ deflation}}
\DoxyCodeLine{01350\ }
\DoxyCodeLine{01357\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Derived>}
\DoxyCodeLine{01358\ BDCSVD<typename\ MatrixBase<Derived>::PlainObject>}
\DoxyCodeLine{01359\ \mbox{\hyperlink{classEigen_1_1MatrixBase_ae171b74b5d530846ee0836135ffcf837}{MatrixBase<Derived>::bdcSvd}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ computationOptions)\textcolor{keyword}{\ const}}
\DoxyCodeLine{01360\ \textcolor{keyword}{}\{}
\DoxyCodeLine{01361\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classEigen_1_1BDCSVD}{BDCSVD<PlainObject>}}(*\textcolor{keyword}{this},\ computationOptions);}
\DoxyCodeLine{01362\ \}}
\DoxyCodeLine{01363\ }
\DoxyCodeLine{01364\ \}\ \textcolor{comment}{//\ end\ namespace\ Eigen}}
\DoxyCodeLine{01365\ }
\DoxyCodeLine{01366\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
