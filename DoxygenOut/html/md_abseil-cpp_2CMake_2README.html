<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Abseil CMake Build Instructions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Abseil CMake Build Instructions</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md4"></a></p>
<p>Abseil comes with a CMake build script (<a href="../CMakeLists.txt">CMakeLists.txt</a>) that can be used on a wide range of platforms ("C" stands for cross-platform.). If you don't have CMake installed already, you can download it for free from <a href="https://www.cmake.org/">https://www.cmake.org/</a>.</p>
<p>CMake works by generating native makefiles or build projects that can be used in the compiler environment of your choice.</p>
<p>For API/ABI compatibility reasons, we strongly recommend building Abseil in a subdirectory of your project or as an embedded dependency.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Incorporating Abseil Into a CMake Project</h1>
<p>The recommendations below are similar to those for using CMake within the googletest framework (<a href="https://github.com/google/googletest/blob/master/googletest/README.md#incorporating-into-an-existing-cmake-project">https://github.com/google/googletest/blob/master/googletest/README.md#incorporating-into-an-existing-cmake-project</a>)</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Step-by-Step Instructions</h2>
<ol type="1">
<li>If you want to build the Abseil tests, integrate the Abseil dependency <a href="https://github.com/google/googletest">Google Test</a> into your CMake project. To disable Abseil tests, you have to pass either <code>-DBUILD_TESTING=OFF</code> or <code>-DABSL_BUILD_TESTING=OFF</code> when configuring your project with CMake.</li>
<li>Download Abseil and copy it into a subdirectory in your CMake project or add Abseil as a <a href="https://git-scm.com/docs/git-submodule">git submodule</a> in your CMake project.</li>
<li>You can then use the CMake command <a href="https://cmake.org/cmake/help/latest/command/add_subdirectory.html"><code>add_subdirectory()</code></a> to include Abseil directly in your CMake project.</li>
<li>Add the <b>absl::</b> target you wish to use to the <a href="https://cmake.org/cmake/help/latest/command/target_link_libraries.html"><code>target_link_libraries()</code></a> section of your executable or of your library.<br  />
 Here is a short CMakeLists.txt example of an application project using Abseil.</li>
</ol>
<div class="fragment"><div class="line">cmake_minimum_required(VERSION 3.16)</div>
<div class="line">project(my_app_project)</div>
<div class="line"> </div>
<div class="line"># Pick the C++ standard to compile with.</div>
<div class="line"># Abseil currently supports C++14, C++17, and C++20.</div>
<div class="line">set(CMAKE_CXX_STANDARD 14)</div>
<div class="line">set(CMAKE_CXX_STANDARD_REQUIRED ON)</div>
<div class="line"> </div>
<div class="line">add_subdirectory(abseil-cpp)</div>
<div class="line"> </div>
<div class="line">add_executable(my_exe source.cpp)</div>
<div class="line">target_link_libraries(my_exe absl::base absl::synchronization absl::strings)</div>
</div><!-- fragment --><p>Note that if you are developing a library designed for use by other clients, you should instead leave <code>CMAKE_CXX_STANDARD</code> unset (or only set if being built as the current top-level CMake project) and configure the minimum required C++ standard at the target level. If you require a later minimum C++ standard than Abseil does, it's a good idea to also enforce that <code>CMAKE_CXX_STANDARD</code> (which will control Abseil library targets) is set to at least that minimum. For example:</p>
<div class="fragment"><div class="line">cmake_minimum_required(VERSION 3.16)</div>
<div class="line">project(my_lib_project)</div>
<div class="line"> </div>
<div class="line"># Leave C++ standard up to the root application, so set it only if this is the</div>
<div class="line"># current top-level CMake project.</div>
<div class="line">if(CMAKE_SOURCE_DIR STREQUAL my_lib_project_SOURCE_DIR)</div>
<div class="line">  set(CMAKE_CXX_STANDARD 17)</div>
<div class="line">  set(CMAKE_CXX_STANDARD_REQUIRED ON)</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line">add_subdirectory(abseil-cpp)</div>
<div class="line"> </div>
<div class="line">add_library(my_lib source.cpp)</div>
<div class="line">target_link_libraries(my_lib absl::base absl::synchronization absl::strings)</div>
<div class="line"> </div>
<div class="line"># Enforce that my_lib requires C++17. Important to document for clients that they</div>
<div class="line"># must set CMAKE_CXX_STANDARD to 17 or higher for proper Abseil ABI compatibility</div>
<div class="line"># (since otherwise, Abseil library targets could be compiled with a lower C++</div>
<div class="line"># standard than my_lib).</div>
<div class="line">target_compile_features(my_lib PUBLIC cxx_std_17)</div>
<div class="line">if(CMAKE_CXX_STANDARD LESS 17)</div>
<div class="line">  message(FATAL_ERROR</div>
<div class="line">      &quot;my_lib_project requires CMAKE_CXX_STANDARD &gt;= 17 (got: ${CMAKE_CXX_STANDARD})&quot;)</div>
<div class="line">endif()</div>
</div><!-- fragment --><p>Then the top-level application project that uses your library is responsible for setting a consistent <code>CMAKE_CXX_STANDARD</code> that is sufficiently high.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Running Abseil Tests with CMake</h2>
<p>Use the <code>-DABSL_BUILD_TESTING=ON</code> flag to run Abseil tests. Note that BUILD_TESTING must also be on (the default).</p>
<p>You will need to provide Abseil with a Googletest dependency. There are two options for how to do this:</p>
<ul>
<li>Use <code>-DABSL_USE_GOOGLETEST_HEAD</code>. This will automatically download the latest Googletest source into the build directory at configure time. Googletest will then be compiled directly alongside Abseil's tests.</li>
<li>Manually integrate Googletest with your build. See <a href="https://github.com/google/googletest/blob/master/googletest/README.md#using-cmake">https://github.com/google/googletest/blob/master/googletest/README.md#using-cmake</a> for more information on using Googletest in a CMake project.</li>
</ul>
<p>For example, to run just the Abseil tests, you could use this script:</p>
<div class="fragment"><div class="line">cd path/to/abseil-cpp</div>
<div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake -DABSL_BUILD_TESTING=ON -DABSL_USE_GOOGLETEST_HEAD=ON ..</div>
<div class="line">make -j</div>
<div class="line">ctest</div>
</div><!-- fragment --><p>Currently, we only run our tests with CMake in a Linux environment, but we are working on the rest of our supported platforms. See <a href="https://github.com/abseil/abseil-cpp/projects/1">https://github.com/abseil/abseil-cpp/projects/1</a> and <a href="https://github.com/abseil/abseil-cpp/issues/109">https://github.com/abseil/abseil-cpp/issues/109</a> for more information.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Available Abseil CMake Public Targets</h2>
<p>Here's a non-exhaustive list of Abseil CMake public targets:</p>
<div class="fragment"><div class="line">absl::algorithm</div>
<div class="line">absl::base</div>
<div class="line">absl::debugging</div>
<div class="line">absl::flat_hash_map</div>
<div class="line">absl::flags</div>
<div class="line">absl::memory</div>
<div class="line">absl::meta</div>
<div class="line">absl::numeric</div>
<div class="line">absl::random_random</div>
<div class="line">absl::strings</div>
<div class="line">absl::synchronization</div>
<div class="line">absl::time</div>
<div class="line">absl::utility</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md9"></a>
Traditional CMake Set-Up</h1>
<p>For larger projects, it may make sense to use the traditional CMake set-up where you build and install projects separately.</p>
<p>First, you'd need to build and install Google Test: </p><div class="fragment"><div class="line">cmake -S /source/googletest -B /build/googletest -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/installation/dir -DBUILD_GMOCK=ON</div>
<div class="line">cmake --build /build/googletest --target install</div>
</div><!-- fragment --><p>Then you need to configure and build Abseil. Make sure you enable <code>ABSL_USE_EXTERNAL_GOOGLETEST</code> and <code>ABSL_FIND_GOOGLETEST</code>. You also need to enable <code>ABSL_ENABLE_INSTALL</code> so that you can install Abseil itself. </p><div class="fragment"><div class="line">cmake -S /source/abseil-cpp -B /build/abseil-cpp -DCMAKE_PREFIX_PATH=/installation/dir -DCMAKE_INSTALL_PREFIX=/installation/dir -DABSL_ENABLE_INSTALL=ON -DABSL_USE_EXTERNAL_GOOGLETEST=ON -DABSL_FIND_GOOGLETEST=ON</div>
<div class="line">cmake --build /temporary/build/abseil-cpp</div>
</div><!-- fragment --><p>(<code>CMAKE_PREFIX_PATH</code> is where you already have Google Test installed; <code>CMAKE_INSTALL_PREFIX</code> is where you want to have Abseil installed; they can be different.)</p>
<p>Run the tests: </p><div class="fragment"><div class="line">ctest --test-dir /temporary/build/abseil-cpp</div>
</div><!-- fragment --><p>And finally install: </p><div class="fragment"><div class="line">cmake --build /temporary/build/abseil-cpp --target install</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md10"></a>
CMake Option Synopsis</h1>
<h2><a class="anchor" id="autotoc_md11"></a>
Enable Standard CMake Installation</h2>
<p><code>-DABSL_ENABLE_INSTALL=ON</code></p>
<h2><a class="anchor" id="autotoc_md12"></a>
Google Test Options</h2>
<p><code>-DABSL_BUILD_TESTING=ON</code> must be set to enable testing</p>
<ul>
<li>Have Abseil download and build Google Test for you: <code>-DABSL_USE_EXTERNAL_GOOGLETEST=OFF</code> (default)<ul>
<li>Download and build latest Google Test: <code>-DABSL_USE_GOOGLETEST_HEAD=ON</code></li>
<li>Download specific Google Test version (ZIP archive): <code>-DABSL_GOOGLETEST_DOWNLOAD_URL=<a href="https://.../version.zip">https://.../version.zip</a></code></li>
<li>Use Google Test from specific local directory: <code>-DABSL_LOCAL_GOOGLETEST_DIR=/path/to/googletest</code></li>
</ul>
</li>
<li>Use Google Test included elsewhere in your project: <code>-DABSL_USE_EXTERNAL_GOOGLETEST=ON</code></li>
<li>Use standard CMake <code>find_package(CTest)</code> to find installed Google Test: <code>-DABSL_USE_EXTERNAL_GOOGLETEST=ON -DABSL_FIND_GOOGLETEST=ON</code> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
